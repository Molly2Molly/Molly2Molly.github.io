<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>XMLHttpRequest | Hexo</title><meta name="description" content="XMLHttpRequest (XHR) objects are used to interact with servers. You can retrieve data from a URL without having to do a full page refresh. This enables a Web page to update just part of a page without"><meta property="og:type" content="article"><meta property="og:title" content="XMLHttpRequest"><meta property="og:url" content="https://molly2molly.github.io/XMLHttpRequest/index.html"><meta property="og:site_name" content="张英姿的博客"><meta property="og:description" content="XMLHttpRequest (XHR) objects are used to interact with servers. You can retrieve data from a URL without having to do a full page refresh. This enables a Web page to update just part of a page without"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2021-01-05T09:27:39.123Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="XMLHttpRequest"><meta name="twitter:description" content="XMLHttpRequest (XHR) objects are used to interact with servers. You can retrieve data from a URL without having to do a full page refresh. This enables a Web page to update just part of a page without"><link rel="canonical" href="https://molly2molly.github.io/XMLHttpRequest/index.html"><link rel="alternate" href="/atom.xml" title="张英姿的博客" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"></head><body class="main-center theme-green" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/molly2molly" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">张英姿</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">前端工程师</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> 苏州, 中国</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech=""> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">Categories</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">Tags</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">Repository</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">Books</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">Links</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">About</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Board</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">Categories</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/D3-js/">D3.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tags</h3><div class="widget-body"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/">Webpack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6-javascript/">es6 javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tag Cloud</h3><div class="widget-body tagcloud"><a href="/tags/React/" style="font-size:13px">React</a> <a href="/tags/TCP/" style="font-size:13px">TCP</a> <a href="/tags/Webpack/" style="font-size:13px">Webpack</a> <a href="/tags/es6-javascript/" style="font-size:13px">es6 javascript</a> <a href="/tags/javascript/" style="font-size:14px">javascript</a> <a href="/tags/markdown/" style="font-size:13px">markdown</a> <a href="/tags/数据结构/" style="font-size:14px">数据结构</a></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/Babel/" class="title">Babel</a></p><p class="item-date"><time datetime="2021-03-26T07:05:01.000Z" itemprop="datePublished">2021-03-26</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/Yeoman/" class="title">Yeoman</a></p><p class="item-date"><time datetime="2021-03-23T06:56:23.000Z" itemprop="datePublished">2021-03-23</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/FreeOnlineProgrammingCSCourses/" class="title">FreeOnlineProgrammingCSCourses</a></p><p class="item-date"><time datetime="2021-01-13T01:18:08.000Z" itemprop="datePublished">2021-01-13</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/Question/" class="title">Question</a></p><p class="item-date"><time datetime="2021-01-12T05:38:46.000Z" itemprop="datePublished">2021-01-12</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/URL/" class="title">URL</a></p><p class="item-date"><time datetime="2021-01-11T06:39:46.000Z" itemprop="datePublished">2021-01-11</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-XMLHttpRequest" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">XMLHttpRequest</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/XMLHttpRequest/" class="article-date"><time datetime="2018-12-14T02:15:43.000Z" itemprop="datePublished">2018-12-14</time></a></span> <span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/javascript/">javascript</a></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/XMLHttpRequest/#comments" class="article-comment-link">Comments</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><p><code>XMLHttpRequest</code> (XHR) objects are used to interact with servers. You can retrieve data from a URL without having to do a full page refresh. This enables a Web page to update just part of a page without disrupting what the user is doing. <code>XMLHttpRequest</code> is used heavily in <a href="https://developer.mozilla.org/en-US/docs/Glossary/AJAX" target="_blank" rel="noopener">AJAX</a> programming.</p><p>Despite its name, <code>XMLHttpRequest</code> can be used to retrieve any type of data, not just XML.</p><p>If your communication needs to involve receiving event data or message data from a server, consider using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events" target="_blank" rel="noopener">server-sent events</a> through the <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource" target="_blank" rel="noopener"><code>EventSource</code></a> interface. For full-duplex communication, <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" target="_blank" rel="noopener">WebSockets</a> may be a better choice.</p><p>This feature is available in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API" target="_blank" rel="noopener">Web Workers</a>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"># Constructor</span><br><span class="line">XMLHttpRequest()</span><br><span class="line"></span><br><span class="line"># Properties</span><br><span class="line">XMLHttpRequest.onreadystatechange</span><br><span class="line"></span><br><span class="line">XMLHttpRequest.readyState - Read only</span><br><span class="line"></span><br><span class="line">XMLHttpRequest.response - Read only</span><br><span class="line"># Returns an ArrayBuffer, Blob, Document, JavaScript object, or a DOMString, depending on the value of XMLHttpRequest.responseType, that contains the response entity body.</span><br><span class="line"></span><br><span class="line">XMLHttpRequest.responseText - Read only</span><br><span class="line"># Returns a DOMString that contains the response to the request as text, or null if the request was unsuccessful or has not yet been sent.</span><br><span class="line"></span><br><span class="line">XMLHttpRequest.responseType</span><br><span class="line"># Is an enumerated value that defines the response type.</span><br><span class="line"># Possible values are the empty string (default), "arraybuffer", "blob", "document", "json", and "text".</span><br><span class="line">     </span><br><span class="line">XMLHttpRequest.responseURL - Read only</span><br><span class="line"># Returns the serialized URL of the response or the empty string if the URL is null.    </span><br><span class="line"></span><br><span class="line">XMLHttpRequest.responseXML - Read only</span><br><span class="line"># Returns a Document containing the response to the request, or null if the request was unsuccessful, has not yet been sent, or cannot be parsed as XML or HTML. Not available in workers.</span><br><span class="line"></span><br><span class="line">XMLHttpRequest.status - Read only</span><br><span class="line"># Returns an unsigned short with the status of the response of the request.</span><br><span class="line"></span><br><span class="line">XMLHttpRequest.statusText - Read only</span><br><span class="line"># Returns a DOMString containing the response string returned by the HTTP server. Unlike XMLHttpRequest.status, this includes the entire text of the response message ("200 OK", for example).</span><br><span class="line"></span><br><span class="line">XMLHttpRequest.timeout</span><br><span class="line"># Is an unsigned long representing the number of milliseconds a request can take before automatically being terminated.</span><br><span class="line"></span><br><span class="line">XMLHttpRequestEventTarget.ontimeout</span><br><span class="line"># Is an EventHandler that is called whenever the request times out.</span><br><span class="line"></span><br><span class="line">XMLHttpRequest.upload - Read only</span><br><span class="line"># Is an XMLHttpRequestUpload, representing the upload process.</span><br><span class="line"></span><br><span class="line">XMLHttpRequest.withCredentials</span><br><span class="line"># Is a Boolean that indicates whether or not cross-site Access-Control requests should be made using credentials such as cookies or authorization headers.</span><br><span class="line"></span><br><span class="line"># Event handlers</span><br><span class="line">onreadystatechange </span><br><span class="line">onload</span><br><span class="line">onerror</span><br><span class="line">onprogress</span><br><span class="line">etc</span><br><span class="line"></span><br><span class="line">More recent browsers, including Firefox, also support listening to the XMLHttpRequest events via standard addEventListener() APIs <span class="keyword">in</span> addition to setting on* properties to a handler <span class="function"><span class="keyword">function</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># <span class="title">Methods</span></span></span><br><span class="line"><span class="function"><span class="title">XMLHttpRequest</span>.<span class="title">abort</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"># <span class="title">Aborts</span> <span class="title">the</span> <span class="title">request</span> <span class="title">if</span> <span class="title">it</span> <span class="title">has</span> <span class="title">already</span> <span class="title">been</span> <span class="title">sent</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">XMLHttpRequest</span>.<span class="title">getAllResponseHeaders</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"># <span class="title">Returns</span> <span class="title">all</span> <span class="title">the</span> <span class="title">response</span> <span class="title">headers</span>, <span class="title">separated</span> <span class="title">by</span> <span class="title">CRLF</span>, <span class="title">as</span> <span class="title">a</span> <span class="title">string</span>, <span class="title">or</span> <span class="title">null</span> <span class="title">if</span> <span class="title">no</span> <span class="title">response</span> <span class="title">has</span> <span class="title">been</span> <span class="title">received</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">XMLHttpRequest</span>.<span class="title">getResponseHeader</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"># <span class="title">Returns</span> <span class="title">the</span> <span class="title">string</span> <span class="title">containing</span> <span class="title">the</span> <span class="title">text</span> <span class="title">of</span> <span class="title">the</span> <span class="title">specified</span> <span class="title">header</span>, <span class="title">or</span> <span class="title">null</span> <span class="title">if</span> <span class="title">either</span> <span class="title">the</span> <span class="title">response</span> <span class="title">has</span> <span class="title">not</span> <span class="title">yet</span> <span class="title">been</span> <span class="title">received</span> <span class="title">or</span> <span class="title">the</span> <span class="title">header</span> <span class="title">doesn</span>'<span class="title">t</span> <span class="title">exist</span> <span class="title">in</span> <span class="title">the</span> <span class="title">response</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">XMLHttpRequest</span>.<span class="title">open</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"># <span class="title">Initializes</span> <span class="title">a</span> <span class="title">request</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">XMLHttpRequest</span>.<span class="title">overrideMimeType</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"># <span class="title">Overrides</span> <span class="title">the</span> <span class="title">MIME</span> <span class="title">type</span> <span class="title">returned</span> <span class="title">by</span> <span class="title">the</span> <span class="title">server</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">XMLHttpRequest</span>.<span class="title">send</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"># <span class="title">Sends</span> <span class="title">the</span> <span class="title">request</span>. <span class="title">If</span> <span class="title">the</span> <span class="title">request</span> <span class="title">is</span> <span class="title">asynchronous</span> (<span class="params">which is the default</span>), <span class="title">this</span> <span class="title">method</span> <span class="title">returns</span> <span class="title">as</span> <span class="title">soon</span> <span class="title">as</span> <span class="title">the</span> <span class="title">request</span> <span class="title">is</span> <span class="title">sent</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">XMLHttpRequest</span>.<span class="title">setRequestHeader</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"># <span class="title">Sets</span> <span class="title">the</span> <span class="title">value</span> <span class="title">of</span> <span class="title">an</span> <span class="title">HTTP</span> <span class="title">request</span> <span class="title">header</span>. <span class="title">You</span> <span class="title">must</span> <span class="title">call</span> <span class="title">setRequestHeader</span>(<span class="params"></span>)<span class="title">after</span> <span class="title">open</span>(<span class="params"></span>), <span class="title">but</span> <span class="title">before</span> <span class="title">send</span>(<span class="params"></span>).</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># <span class="title">Events</span></span></span><br><span class="line"><span class="function"><span class="title">abort</span></span></span><br><span class="line"><span class="function"># <span class="title">Fired</span> <span class="title">when</span> <span class="title">a</span> <span class="title">request</span> <span class="title">has</span> <span class="title">been</span> <span class="title">aborted</span>, <span class="title">for</span> <span class="title">example</span> <span class="title">because</span> <span class="title">the</span> <span class="title">program</span> <span class="title">called</span> <span class="title">XMLHttpRequest</span>.<span class="title">abort</span>(<span class="params"></span>).</span></span><br><span class="line"><span class="function"># <span class="title">Also</span> <span class="title">available</span> <span class="title">via</span> <span class="title">the</span> <span class="title">onabort</span> <span class="title">property</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">error</span></span></span><br><span class="line"><span class="function"># <span class="title">Fired</span> <span class="title">when</span> <span class="title">the</span> <span class="title">request</span> <span class="title">encountered</span> <span class="title">an</span> <span class="title">error</span>.</span></span><br><span class="line"><span class="function"># <span class="title">Also</span> <span class="title">available</span> <span class="title">via</span> <span class="title">the</span> <span class="title">onerror</span> <span class="title">property</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">load</span></span></span><br><span class="line"><span class="function"># <span class="title">Fired</span> <span class="title">when</span> <span class="title">an</span> <span class="title">XMLHttpRequest</span> <span class="title">transaction</span> <span class="title">completes</span> <span class="title">successfully</span>.</span></span><br><span class="line"><span class="function"># <span class="title">Also</span> <span class="title">available</span> <span class="title">via</span> <span class="title">the</span> <span class="title">onload</span> <span class="title">property</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">loadend</span></span></span><br><span class="line"><span class="function"># <span class="title">Fired</span> <span class="title">when</span> <span class="title">a</span> <span class="title">request</span> <span class="title">has</span> <span class="title">completed</span>, <span class="title">whether</span> <span class="title">successfully</span> (<span class="params">after load</span>) <span class="title">or</span> <span class="title">unsuccessfully</span> (<span class="params">after abort or error</span>).</span></span><br><span class="line"><span class="function"># <span class="title">Also</span> <span class="title">available</span> <span class="title">via</span> <span class="title">the</span> <span class="title">onloadend</span> <span class="title">property</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">loadstart</span></span></span><br><span class="line"><span class="function"># <span class="title">Fired</span> <span class="title">when</span> <span class="title">a</span> <span class="title">request</span> <span class="title">has</span> <span class="title">started</span> <span class="title">to</span> <span class="title">load</span> <span class="title">data</span>.</span></span><br><span class="line"><span class="function"># <span class="title">Also</span> <span class="title">available</span> <span class="title">via</span> <span class="title">the</span> <span class="title">onloadstart</span> <span class="title">property</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">progress</span></span></span><br><span class="line"><span class="function"># <span class="title">Fired</span> <span class="title">periodically</span> <span class="title">when</span> <span class="title">a</span> <span class="title">request</span> <span class="title">receives</span> <span class="title">more</span> <span class="title">data</span>.</span></span><br><span class="line"><span class="function"># <span class="title">Also</span> <span class="title">available</span> <span class="title">via</span> <span class="title">the</span> <span class="title">onprogress</span> <span class="title">property</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">timeout</span></span></span><br><span class="line"><span class="function"># <span class="title">Fired</span> <span class="title">when</span> <span class="title">progress</span> <span class="title">is</span> <span class="title">terminated</span> <span class="title">due</span> <span class="title">to</span> <span class="title">preset</span> <span class="title">time</span> <span class="title">expiring</span>.</span></span><br><span class="line"><span class="function"># <span class="title">Also</span> <span class="title">available</span> <span class="title">via</span> <span class="title">the</span> <span class="title">ontimeout</span> <span class="title">property</span>.</span></span><br></pre></td></tr></table></figure><h3 id="Using-XMLHttpRequest"><a href="#Using-XMLHttpRequest" class="headerlink" title="Using XMLHttpRequest"></a>Using XMLHttpRequest</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reqListener</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">oReq.addEventListener(<span class="string">"load"</span>, reqListener);</span><br><span class="line">oReq.open(<span class="string">"GET"</span>, <span class="string">"http://www.example.org/example.txt"</span>);</span><br><span class="line">oReq.send();</span><br></pre></td></tr></table></figure><p>通过XMLHttpRequest生成的请求可以有两种方式来获取数据，异步模式或同步模式。</p><p>请求的类型是由这个XMLHttpRequest对象的open()方法的第三个参数async的值决定的。如果该参数的值为false，则该XMLHttpRequest请求以同步模式进行，否则该过程将以异步模式完成。<br>也就是说，默认是同步模式。</p><p>Do not use synchronous requests outside Web Workers.</p><h4 id="Analyzing-and-manipulating-the-responseXML-property"><a href="#Analyzing-and-manipulating-the-responseXML-property" class="headerlink" title="Analyzing and manipulating the responseXML property"></a>Analyzing and manipulating the responseXML property</h4><p>If you use <code>XMLHttpRequest</code> to get the content of a remote XML document, the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseXML" target="_blank" rel="noopener"><code>responseXML</code></a> property will be a DOM object containing a parsed XML document. This could prove difficult to manipulate and analyze. There are four primary ways of analyzing this XML document:</p><ol><li>Using <a href="https://developer.mozilla.org/en-US/docs/Web/XPath" target="_blank" rel="noopener">XPath</a> to address (or point to) parts of it.</li><li>Manually <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Parsing_and_serializing_XML" target="_blank" rel="noopener">Parsing and serializing XML</a> to strings or objects.</li><li>Using <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLSerializer" target="_blank" rel="noopener"><code>XMLSerializer</code></a> to serialize <strong>DOM trees to strings or to files</strong>.</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp" target="_blank" rel="noopener"><code>RegExp</code></a> can be used if you always know the content of the XML document beforehand. You might want to remove line breaks, if you use <code>RegExp</code> to scan with regard to line breaks. However, this method is a “last resort” since if the XML code changes slightly, the method will likely fail.</li></ol><h4 id="Processing-a-responseText-property-containing-an-HTML-document"><a href="#Processing-a-responseText-property-containing-an-HTML-document" class="headerlink" title="Processing a responseText property containing an HTML document"></a>Processing a responseText property containing an HTML document</h4><p>If you use <code>XMLHttpRequest</code> to get the content of a remote HTML webpage, the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText" target="_blank" rel="noopener"><code>responseText</code></a> property is a string containing the raw HTML. This could prove difficult to manipulate and analyze. There are three primary ways to analyze and parse this raw HTML string:</p><ol><li>Use the <code>XMLHttpRequest.responseXML</code> property as covered in the article <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/HTML_in_XMLHttpRequest" target="_blank" rel="noopener">HTML in XMLHttpRequest</a>.</li><li>Inject the content into the body of a <a href="https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment" target="_blank" rel="noopener">document fragment</a> via <code>fragment.body.innerHTML</code> and traverse the DOM of the fragment.</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp" target="_blank" rel="noopener"><code>RegExp</code></a> can be used if you always know the content of the HTML <code>responseText</code> beforehand. You might want to remove line breaks, if you use RegExp to scan with regard to linebreaks. However, this method is a “last resort” since if the HTML code changes slightly, the method will likely fail.</li></ol><h4 id="Handling-binary-data"><a href="#Handling-binary-data" class="headerlink" title="Handling binary data"></a>Handling binary data</h4><p>Although <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener"><code>XMLHttpRequest</code></a> is most commonly used to send and receive textual data, it can be used to send and receive binary content. There are several well tested methods for coercing the response of an <code>XMLHttpRequest</code> into sending binary data. These involve utilizing the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/overrideMimeType" target="_blank" rel="noopener"><code>overrideMimeType()</code></a> method on the <code>XMLHttpRequest</code> object and is a workable solution.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">oReq.open(<span class="string">"GET"</span>, url);</span><br><span class="line"><span class="comment">// retrieve data unprocessed as a binary string</span></span><br><span class="line">oReq.overrideMimeType(<span class="string">"text/plain; charset=x-user-defined"</span>);</span><br><span class="line"><span class="comment">/* ... */</span></span><br></pre></td></tr></table></figure><p>However, more modern techniques are available, since the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType" target="_blank" rel="noopener"><code>responseType</code></a> attribute now supports a number of additional content types, which makes sending and receiving binary data much easier.</p><p>For example, consider this snippet, which uses the <code>responseType</code> of “<code>arraybuffer</code>“ to fetch the remote content into a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="noopener"><code>ArrayBuffer</code></a> object, which stores the raw binary data.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">oReq.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> arraybuffer = oReq.response; <span class="comment">// not responseText</span></span><br><span class="line">  <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br><span class="line">oReq.open(<span class="string">"GET"</span>, url);</span><br><span class="line">oReq.responseType = <span class="string">"arraybuffer"</span>;</span><br><span class="line">oReq.send();</span><br></pre></td></tr></table></figure><h4 id="Monitoring-progress"><a href="#Monitoring-progress" class="headerlink" title="Monitoring progress"></a>Monitoring progress</h4><p><code>XMLHttpRequest</code> provides the ability to listen to various events that can occur while the request is being processed. This includes periodic progress notifications, error notifications, and so forth.</p><p>Support for DOM <code>progress</code> event monitoring of <code>XMLHttpRequest</code> transfers follows the <a href="https://xhr.spec.whatwg.org/#interface-progressevent" target="_blank" rel="noopener">specification for progress events</a>: these events implement the <a href="https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent" target="_blank" rel="noopener"><code>ProgressEvent</code></a> interface. The actual events you can monitor to determine the state of an ongoing transfer are:</p><ul><li><p><code>progress</code></p><p>The amount of data that has been retrieved has changed.</p></li><li><p><code>load</code></p><p>The transfer is complete; all data is now in the <code>response</code></p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">oReq.addEventListener(<span class="string">"progress"</span>, updateProgress);</span><br><span class="line">oReq.addEventListener(<span class="string">"load"</span>, transferComplete);</span><br><span class="line">oReq.addEventListener(<span class="string">"error"</span>, transferFailed);</span><br><span class="line">oReq.addEventListener(<span class="string">"abort"</span>, transferCanceled);</span><br><span class="line">oReq.addEventListener(<span class="string">"loadend"</span>, loadEnd);</span><br><span class="line"></span><br><span class="line">oReq.open();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// progress on transfers from the server to the client (downloads)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateProgress</span> (<span class="params">oEvent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (oEvent.lengthComputable) &#123;</span><br><span class="line">    <span class="keyword">var</span> percentComplete = oEvent.loaded / oEvent.total * <span class="number">100</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Unable to compute progress information since the total size is unknown</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transferComplete</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"The transfer is complete."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transferFailed</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"An error occurred while transferring the file."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transferCanceled</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"The transfer has been canceled by the user."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadEnd</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"The transfer finished (although we don't know if it succeeded or not)."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Submitting-forms-and-uploading-files"><a href="#Submitting-forms-and-uploading-files" class="headerlink" title="Submitting forms and uploading files"></a>Submitting forms and uploading files</h3><p>Instances of <code>XMLHttpRequest</code> can be used to submit forms in two ways:</p><ul><li>using only AJAX</li><li>using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" target="_blank" rel="noopener"><code>FormData</code></a> API</li></ul><p>Using the <code>FormData</code> API is the simplest and fastest, but has the disadvantage that data collected can not be <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify" target="_blank" rel="noopener">stringified</a>.<br>Using only AJAX is more complex, but typically more flexible and powerful.</p><h4 id="Using-nothing-but-XMLHttpRequest"><a href="#Using-nothing-but-XMLHttpRequest" class="headerlink" title="Using nothing but XMLHttpRequest"></a>Using nothing but XMLHttpRequest</h4><p>Submitting forms without the <code>FormData</code> API does not require other APIs for most use cases. The only case where you need an additional API is <strong>if you want to upload one or more files</strong>, where you use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader" target="_blank" rel="noopener"><code>FileReader</code></a> API.</p><h5 id="A-brief-introduction-to-the-submit-methods"><a href="#A-brief-introduction-to-the-submit-methods" class="headerlink" title="A brief introduction to the submit methods"></a>A brief introduction to the submit methods</h5><p>An html <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form" target="_blank" rel="noopener"><form></form></a>can be sent in four ways:</p><ul><li><p>using the <code>POST</code> method and setting the <code>enctype</code> attribute to <code>application/x-www-form-urlencoded</code> (default);</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">foo=bar&amp;baz=The+first+line.%0D%0AThe+second+line.%0D%0A</span><br></pre></td></tr></table></figure></li><li><p>using the <code>POST</code> method and setting the <code>enctype</code> attribute to <code>text/plain</code>;</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">foo=bar</span><br><span class="line">baz=The first line.</span><br><span class="line">The second line.</span><br></pre></td></tr></table></figure></li><li><p>using the <code>POST</code> method and setting the <code>enctype</code> attribute to <code>multipart/form-data</code>;</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: multipart/form-data; boundary=---------------------------314911788813839</span><br><span class="line"></span><br><span class="line">-----------------------------314911788813839</span><br><span class="line">Content-Disposition: form-data; name="foo"</span><br><span class="line"></span><br><span class="line">bar</span><br><span class="line">-----------------------------314911788813839</span><br><span class="line">Content-Disposition: form-data; name="baz"</span><br><span class="line"></span><br><span class="line">The first line.</span><br><span class="line">The second line.</span><br><span class="line"></span><br><span class="line">-----------------------------314911788813839--</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"upload-form"</span> <span class="attr">action</span>=<span class="string">"yyy"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span> &gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"upload"</span> <span class="attr">name</span>=<span class="string">"upload"</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Upload"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>using the <code>GET</code> method (in this case the <code>enctype</code> attribute will be ignored).</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># a string like the following will be added to the URL</span><br><span class="line">?foo=bar&amp;baz=The%20first%20line.%0AThe%20second%20line.</span><br></pre></td></tr></table></figure></li></ul><h4 id="Using-FormData-objects"><a href="#Using-FormData-objects" class="headerlink" title="Using FormData objects"></a>Using FormData objects</h4><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" target="_blank" rel="noopener"><code>FormData</code></a> constructor lets you compile a set of key/value pairs to send using <code>XMLHttpRequest</code>. Its primary use is in sending form data, but can also be used independently from a form in order to transmit user keyed data. The transmitted data is in the same format the form’s <code>submit()</code> method uses to send data, if the form’s encoding type were set to “multipart/form-data”. FormData objects can be utilized in a number of ways with an <code>XMLHttpRequest</code>. For examples, and explanations of how one can utilize FormData with XMLHttpRequests, see the <a href="https://developer.mozilla.org/en-US/docs/DOM/XMLHttpRequest/FormData/Using_FormData_Objects" target="_blank" rel="noopener">Using FormData Objects</a> page. For didactic purposes here is <strong>a *translation* of <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#A_little_vanilla_framework" target="_blank" rel="noopener">the previous example</a> transformed to use the <code>FormData</code> API</strong>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;progress id=<span class="string">"uploadprogress"</span> min=<span class="string">"0"</span> max=<span class="string">"100"</span> value=<span class="string">"0"</span>&gt;<span class="number">0</span>&lt;<span class="regexp">/progress&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">form.on('submit',function() &#123;</span></span><br><span class="line"><span class="regexp">　　</span></span><br><span class="line"><span class="regexp">	/</span><span class="regexp">/ 检查是否支持FormData</span></span><br><span class="line"><span class="regexp">	if(window.FormData) &#123;　</span></span><br><span class="line"><span class="regexp">	　　var formData = new FormData();</span></span><br><span class="line"><span class="regexp">	</span></span><br><span class="line"><span class="regexp">	　　/</span><span class="regexp">/ 建立一个upload表单项，值为上传的文件</span></span><br><span class="line"><span class="regexp">	　　formData.append('upload', document.getElementById('upload').files[0]);</span></span><br><span class="line"><span class="regexp">	　　var xhr = new XMLHttpRequest();</span></span><br><span class="line"><span class="regexp">	　　xhr.open('POST', $(this).attr('action'));</span></span><br><span class="line"><span class="regexp">	　　/</span><span class="regexp">/ 定义上传完成后的回调函数</span></span><br><span class="line"><span class="regexp">	　　xhr.onload = function () &#123;</span></span><br><span class="line"><span class="regexp">	　　　　if (xhr.status === 200) &#123;</span></span><br><span class="line"><span class="regexp">	　　　　　　console.log('上传成功');</span></span><br><span class="line"><span class="regexp">	　　　　&#125; else &#123;</span></span><br><span class="line"><span class="regexp">	　　　　　　console.log('出错了');</span></span><br><span class="line"><span class="regexp">	　　　　&#125;</span></span><br><span class="line"><span class="regexp">	　　&#125;;</span></span><br><span class="line"><span class="regexp">	　　xhr.send(formData);</span></span><br><span class="line"><span class="regexp">	　　</span></span><br><span class="line"><span class="regexp">	　　xhr.upload.onprogress = function (event) &#123;</span></span><br><span class="line"><span class="regexp">		　　if (event.lengthComputable) &#123;</span></span><br><span class="line"><span class="regexp">		　　　　var complete = (event.loaded /</span> event.total * <span class="number">100</span> | <span class="number">0</span>);</span><br><span class="line">		　　　　<span class="keyword">var</span> progress = <span class="built_in">document</span>.getElementById(<span class="string">'uploadprogress'</span>);</span><br><span class="line">		　　　　progress.value = progress.innerHTML = complete;</span><br><span class="line">		　　&#125;</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 检查浏览器是否支持拖放上传</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">'draggable'</span> <span class="keyword">in</span> <span class="built_in">document</span>.createElement(<span class="string">'span'</span>))&#123;</span><br><span class="line">　　<span class="keyword">var</span> holder = <span class="built_in">document</span>.getElementById(<span class="string">'holder'</span>);</span><br><span class="line">　　holder.ondragover = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.className = <span class="string">'hover'</span>; <span class="keyword">return</span> <span class="literal">false</span>; &#125;;</span><br><span class="line">　　holder.ondragend = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">this</span>.className = <span class="string">''</span>; <span class="keyword">return</span> <span class="literal">false</span>; &#125;;</span><br><span class="line">　　holder.ondrop = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">　　　　event.preventDefault();</span><br><span class="line">　　　　<span class="keyword">this</span>.className = <span class="string">''</span>;</span><br><span class="line">　　　　<span class="keyword">var</span> files = event.dataTransfer.files;</span><br><span class="line">　　　　<span class="comment">// do something with files</span></span><br><span class="line">　　&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadListener</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseText);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> arrayBuffer = e.response;</span><br><span class="line">  <span class="keyword">if</span> (arrayBuffer) &#123;</span><br><span class="line">    <span class="keyword">var</span> byteArray = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arrayBuffer);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; byteArray.byteLength; i++) &#123;</span><br><span class="line">      <span class="comment">// 对数组中的每个字节进行操作</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">   <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([e.response], &#123;<span class="attr">type</span>: <span class="string">"image/png"</span>&#125;);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span>(oReq.status === <span class="number">200</span>) &#123;</span><br><span class="line">   		</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">oReq.addEventListener(<span class="string">"load"</span>, loadListener);</span><br><span class="line">oReq.open(<span class="string">"GET"</span>, <span class="string">"http://www.example.org/example.txt"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 空字符串（默认）, arraybuffer, blob, document, json, text</span></span><br><span class="line">oReq.responseType = <span class="string">"arraybuffer"</span>; </span><br><span class="line"></span><br><span class="line">oReq.addEventListener(<span class="string">"progress"</span>, updateProgress);</span><br><span class="line">oReq.addEventListener(<span class="string">"load"</span> , transferComplete);</span><br><span class="line">oReq.addEventListener(<span class="string">"error"</span>, transferFailed  );</span><br><span class="line">oReq.addEventListener(<span class="string">"abort"</span>, transferCanceled);</span><br><span class="line"></span><br><span class="line">oReq.send();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务端到客户端的传输进程（下载）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateProgress</span> (<span class="params">oEvent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (oEvent.lengthComputable) &#123;</span><br><span class="line">    <span class="keyword">var</span> percentComplete = oEvent.loaded / oEvent.total * <span class="number">100</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 总大小未知时不能计算进程信息</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transferComplete</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"The transfer is complete."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transferFailed</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"An error occurred while transferring the file."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">transferCanceled</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"The transfer has been canceled by the user."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Get-last-modified-date"><a href="#Get-last-modified-date" class="headerlink" title="Get last modified date"></a>Get last modified date</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHeaderTime</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.getResponseHeader(<span class="string">"Last-Modified"</span>));  <span class="comment">/* A valid GMTString date or null */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">oReq.open(<span class="string">"HEAD"</span> <span class="comment">/* use HEAD if you only need the headers! */</span>, <span class="string">"yourpage.html"</span>);</span><br><span class="line">oReq.onload = getHeaderTime;</span><br><span class="line">oReq.send();</span><br></pre></td></tr></table></figure><h4 id="Do-something-when-last-modified-date-changes"><a href="#Do-something-when-last-modified-date-changes" class="headerlink" title="Do something when last modified date changes"></a>Do something when last modified date changes</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHeaderTime</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> nLastVisit = <span class="built_in">parseFloat</span>(<span class="built_in">window</span>.localStorage.getItem(<span class="string">'lm_'</span> + <span class="keyword">this</span>.filepath));</span><br><span class="line">  <span class="keyword">var</span> nLastModif = <span class="built_in">Date</span>.parse(<span class="keyword">this</span>.getResponseHeader(<span class="string">"Last-Modified"</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">isNaN</span>(nLastVisit) || nLastModif &gt; nLastVisit) &#123;</span><br><span class="line">    <span class="built_in">window</span>.localStorage.setItem(<span class="string">'lm_'</span> + <span class="keyword">this</span>.filepath, <span class="built_in">Date</span>.now());</span><br><span class="line">    <span class="built_in">isFinite</span>(nLastVisit) &amp;&amp; <span class="keyword">this</span>.callback(nLastModif, nLastVisit);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ifHasChanged</span>(<span class="params">sURL, fCallback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  oReq.open(<span class="string">"HEAD"</span> <span class="comment">/* use HEAD - we only need the headers! */</span>, sURL);</span><br><span class="line">  oReq.callback = fCallback;</span><br><span class="line">  oReq.filepath = sURL;</span><br><span class="line">  oReq.onload = getHeaderTime;</span><br><span class="line">  oReq.send();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Let's test the file "yourpage.html"... */</span></span><br><span class="line">ifHasChanged(<span class="string">"yourpage.html"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">nModif, nVisit</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"The page '"</span> + <span class="keyword">this</span>.filepath + <span class="string">"' has been changed on "</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>(nModif)).toLocaleString() + <span class="string">"!"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="Cross-site-XMLHttpRequest"><a href="#Cross-site-XMLHttpRequest" class="headerlink" title="Cross-site XMLHttpRequest"></a>Cross-site XMLHttpRequest</h4><p>Modern browsers support cross-site requests by implementing the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener">Cross-Origin Resource Sharing</a> (CORS) standard. As long as the server is configured to allow requests from your web application’s origin, <code>XMLHttpRequest</code> will work. Otherwise, an <code>INVALID_ACCESS_ERR</code> exception is thrown.</p><h4 id="Bypassing-the-cache"><a href="#Bypassing-the-cache" class="headerlink" title="Bypassing the cache"></a>Bypassing the cache</h4><p>A cross-browser compatible approach to bypassing the cache is appending a timestamp to the URL, being sure to include a “?” or “&amp;” as appropriate.</p><p>As the local cache is indexed by URL, this causes every request to be unique, thereby bypassing the cache.</p><p>You can automatically adjust URLs using the following code:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">oReq.open(<span class="string">"GET"</span>, url + ((<span class="regexp">/\?/</span>).test(url) ? <span class="string">"&amp;"</span> : <span class="string">"?"</span>) + (<span class="keyword">new</span> <span class="built_in">Date</span>()).getTime());</span><br><span class="line">oReq.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h3 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h3><p>The recommended way to enable cross-site scripting is to use the <code>Access-Control-Allow-Origin</code> HTTP header in the response to the XMLHttpRequest.</p><h3 id="HTML-in-XMLHttpRequest"><a href="#HTML-in-XMLHttpRequest" class="headerlink" title="HTML in XMLHttpRequest"></a>HTML in XMLHttpRequest</h3><p>To discourage the synchronous use of <code>XMLHttpRequest</code>, HTML support is not available in the synchronous mode. Also, HTML support is only available if the <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType" target="_blank" rel="noopener"><code>responseType</code></a> property has been set to <code>&quot;document&quot;</code>. This limitation avoids wasting time parsing HTML uselessly when legacy code uses <code>XMLHttpRequest</code> in the default mode to retrieve <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseText" target="_blank" rel="noopener"><code>responseText</code></a> for <code>text/html</code> resources. Also, this limitation avoids problems with legacy code that assumes that <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseXML" target="_blank" rel="noopener"><code>responseXML</code></a> is <code>null</code> for HTTP error pages (which often have a <code>text/html</code> response body).</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.responseXML.title);</span><br><span class="line">&#125;</span><br><span class="line">xhr.open(<span class="string">"GET"</span>, <span class="string">"file.html"</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.responseType = <span class="string">"document"</span>;</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Handling HTML on older browsers</span><br><span class="line"># Note: This solution is very expensive for the interpreter. Use it only when it is really necessary.</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHTML</span> (<span class="params">oXHR, sTargetId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span>  rOpen = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"&lt;(?!\!)\\s*([^\\s&gt;]+)[^&gt;]*\\s+id\\=[\"\']"</span> + sTargetId + <span class="string">"[\"\'][^&gt;]*&gt;"</span> ,<span class="string">"i"</span>),</span><br><span class="line">       sSrc = oXHR.responseText, aExec = rOpen.exec(sSrc);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> aExec ? (<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"(?:(?:.(?!&lt;\\s*"</span> + aExec[<span class="number">1</span>] + <span class="string">"[^&gt;]*[&gt;]))*.?&lt;\\s*"</span> + aExec[<span class="number">1</span>] + <span class="string">"[^&gt;]*[&gt;](?:.(?!&lt;\\s*\/\\s*"</span> + aExec[<span class="number">1</span>] + <span class="string">"\\s*&gt;))*.?&lt;\\s*\/\\s*"</span> + aExec[<span class="number">1</span>] + <span class="string">"\\s*&gt;)*(?:.(?!&lt;\\s*\/\\s*"</span> + aExec[<span class="number">1</span>] + <span class="string">"\\s*&gt;))*.?"</span>, <span class="string">"i"</span>)).exec(sSrc.slice(sSrc.indexOf(aExec[<span class="number">0</span>]) + aExec[<span class="number">0</span>].length)) || <span class="string">""</span> : <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">oReq.open(<span class="string">"GET"</span>, <span class="string">"yourPage.html"</span>, <span class="literal">true</span>);</span><br><span class="line">oReq.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="built_in">console</span>.log(getHTML(<span class="keyword">this</span>, <span class="string">"intro"</span>)); &#125;;</span><br><span class="line">oReq.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h3 id="Example-using-a-timeout"><a href="#Example-using-a-timeout" class="headerlink" title="Example: using a timeout"></a>Example: using a timeout</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadFile</span>(<span class="params">url, timeout, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.ontimeout = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.error(<span class="string">"The request for "</span> + url + <span class="string">" timed out."</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">                callback.apply(xhr, args);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.error(xhr.statusText);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.open(<span class="string">"GET"</span>, url, <span class="literal">true</span>);</span><br><span class="line">    xhr.timeout = timeout;</span><br><span class="line">    xhr.send(<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># usage:</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showMessage</span> (<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(message + <span class="keyword">this</span>.responseText);</span><br><span class="line">&#125;</span><br><span class="line">loadFile(<span class="string">"message.txt"</span>, <span class="number">2000</span>, showMessage, <span class="string">"New message!\n"</span>);</span><br></pre></td></tr></table></figure><p>参考链接:</p><ol><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Synchronous_and_Asynchronous_Requests" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Synchronous_and_Asynchronous_Requests</a></li></ol></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://molly2molly.github.io/XMLHttpRequest/" title="XMLHttpRequest" target="_blank" rel="external">https://molly2molly.github.io/XMLHttpRequest/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/molly2molly" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/molly2molly" target="_blank"><span class="text-dark">张英姿</span><small class="ml-1x">前端工程师</small></a></h3><div>梦里寻他千百度 蓦然回首 那人却在灯火阑珊处</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom=""><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/Webpack/" title="Webpack"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a></li><li class="next"><a href="/Hexo 操作手册/" title="Hexo 操作手册"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>Maybe you could buy me a cup of coffee.</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script></body></html>