<!-- build time:Tue Jan 29 2019 11:25:58 GMT+0800 (CST) --><!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>d3.js | Hexo</title><meta name="description" content="d3.js data-driven document如果我们用函数式风格创建对象，并且该对象所有的方法都没有用this，（并且这个对象不包含外部可见的成员数据），那么这个对象就是持久的（durable）。持久对象就是许多功能行为的集合了。— Crockfort D.var i = document.querySelectAll(&amp;quot;p&amp;quot;).iterator(); var e; w"><meta property="og:type" content="article"><meta property="og:title" content="d3.js"><meta property="og:url" content="https://molly2molly.github.io/2018/05/09/d3-js/index.html"><meta property="og:site_name" content="张英姿的博客"><meta property="og:description" content="d3.js data-driven document如果我们用函数式风格创建对象，并且该对象所有的方法都没有用this，（并且这个对象不包含外部可见的成员数据），那么这个对象就是持久的（durable）。持久对象就是许多功能行为的集合了。— Crockfort D.var i = document.querySelectAll(&amp;quot;p&amp;quot;).iterator(); var e; w"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2018-11-22T01:46:16.641Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="d3.js"><meta name="twitter:description" content="d3.js data-driven document如果我们用函数式风格创建对象，并且该对象所有的方法都没有用this，（并且这个对象不包含外部可见的成员数据），那么这个对象就是持久的（durable）。持久对象就是许多功能行为的集合了。— Crockfort D.var i = document.querySelectAll(&amp;quot;p&amp;quot;).iterator(); var e; w"><link rel="canonical" href="https://molly2molly.github.io/2018/05/09/d3-js/index.html"><link rel="alternate" href="/atom.xml" title="张英姿的博客" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"></head><body class="main-center theme-green" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/molly2molly" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">张英姿</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">前端工程师</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> 苏州, 中国</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech=""> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">Categories</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">Tags</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">Repository</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">Books</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">Links</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">About</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Board</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">Categories</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/D3-js/">D3.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据可视化/">数据可视化</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tags</h3><div class="widget-body"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/d3/">d3</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6-javascript/">es6 javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tag Cloud</h3><div class="widget-body tagcloud"><a href="/tags/TCP/" style="font-size:13px">TCP</a> <a href="/tags/d3/" style="font-size:13px">d3</a> <a href="/tags/es6-javascript/" style="font-size:13px">es6 javascript</a> <a href="/tags/javascript/" style="font-size:14px">javascript</a> <a href="/tags/markdown/" style="font-size:13px">markdown</a> <a href="/tags/webpack/" style="font-size:13px">webpack</a></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/others/">others</a></p><p class="item-title"><a href="/2018/12/27/Markdown语法简介/" class="title">Markdown语法简介</a></p><p class="item-date"><time datetime="2018-12-27T07:24:16.000Z" itemprop="datePublished">2018-12-27</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/javascript/">javascript</a></p><p class="item-title"><a href="/2018/12/27/MIME类型/" class="title">MIME类型</a></p><p class="item-date"><time datetime="2018-12-27T06:29:33.000Z" itemprop="datePublished">2018-12-27</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/javascript/">javascript</a></p><p class="item-title"><a href="/2018/12/27/文件的上传与下载/" class="title">文件的上传与下载</a></p><p class="item-date"><time datetime="2018-12-27T05:26:18.000Z" itemprop="datePublished">2018-12-27</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/javascript/">javascript</a></p><p class="item-title"><a href="/2018/12/21/ES6读书笔记/" class="title">ES6读书笔记</a></p><p class="item-date"><time datetime="2018-12-21T01:41:53.000Z" itemprop="datePublished">2018-12-21</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/http/">http</a></p><p class="item-title"><a href="/2018/12/19/图解TCP-IP阅读理解/" class="title">图解TCP_IP阅读理解</a></p><p class="item-date"><time datetime="2018-12-19T06:06:31.000Z" itemprop="datePublished">2018-12-19</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-d3-js" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">d3.js</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2018/05/09/d3-js/" class="article-date"><time datetime="2018-05-09T01:20:29.000Z" itemprop="datePublished">2018-05-09</time></a></span> <span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/D3-js/">D3.js</a></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2018/05/09/d3-js/#comments" class="article-comment-link">Comments</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><p>d3.js data-driven document</p><p>如果我们用函数式风格创建对象，并且该对象所有的方法都没有用this，（并且这个对象不包含外部可见的成员数据），那么这个对象就是持久的（durable）。持久对象就是许多功能行为的集合了。<br>— Crockfort D.</p><pre><code>var i = document.querySelectAll(&quot;p&quot;).iterator();
var e;
while( e = i.next() ) {
    //对每个选中的元素操作
    console.log(e);
}
</code></pre><p>####选取单个元素</p><pre><code>d3.select(&quot;p&quot;).attr(&quot;foo&quot;,&quot;goo&quot;);
d3.select(&quot;p&quot;).attr(&quot;foo&quot;);

// 检测P元素是否有名为goo的class
d3.select(&quot;p&quot;).classed(&quot;goo&quot;);
// 为p元素添加 goo class
d3.select(&quot;p&quot;).classed(&quot;goo&quot;,true);
// 移除p元素上的goo class
d3.select(&quot;p&quot;).classed(&quot;goo&quot;,function(){return false;});

d3.select(&quot;p&quot;).style(&quot;font-size&quot;);
d3.select(&quot;p&quot;).style(&quot;font-size&quot;,&quot;10px&quot;);
d3.select(&quot;p&quot;).style(&quot;font-size&quot;,function(){return normalFontSize + 10;});

d3.select(&quot;.d3&quot;).text();
d3.select(&quot;.d3&quot;).text(&quot;Hello World&quot;);
d3.select(&quot;.d3&quot;).text(function(){
    var model = retrieveModel();
    return model.message;
});

d3.select(&quot;.d3&quot;).html();
d3.select(&quot;.d3&quot;).html(&quot;&lt;b&gt;Hello&lt;/b&gt;&quot;);
d3.select(&quot;.d3&quot;).html(function(){
    var template = compileTemplate();
    return template;
});
</code></pre><p>####选取多个元素</p><pre><code>d3.selectAll(&quot;p&quot;).attr(&quot;class&quot;,&quot;red&quot;);
</code></pre><p>####迭代选集中元素</p><pre><code>d3.selectAll(&quot;div&quot;)
  .attr(&quot;class&quot;, &quot;red box&quot;)
  .each(function(d, i){
      d3.select(this).append(&quot;h1&quot;).text(i);
  });
</code></pre><p>####子选择器</p><pre><code>d3.select(&quot;#section1 &gt; div&quot;).attr(&quot;class&quot;,&quot;blue box&quot;);
d3.select(&quot;#section2&quot;).select(&quot;div&quot;).attr(&quot;class&quot;,&quot;red box&quot;);
</code></pre><p>####函数级联调用</p><pre><code>var body = d3.select(&quot;body&quot;);
body.append(&quot;section&quot;)
     .attr(&quot;id&quot;,&quot;section1&quot;)
     .append(&quot;div&quot;)
     .attr(&quot;class&quot;,&quot;blue box&quot;)
     .append(&quot;p&quot;)
     .attr(&quot;class&quot;,&quot;dynamic blue box&quot;);
</code></pre><p>####原始选集</p><pre><code>&lt;table class=&quot;table&quot;&gt;
    &lt;thead&gt;
    &lt;tr&gt;
        &lt;th&gt;Time&lt;/th&gt;
        &lt;th&gt;Type&lt;/th&gt;
        &lt;th&gt;Amount&lt;/th&gt;
    &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
    &lt;tr&gt;
        &lt;td&gt;10:22&lt;/td&gt;
        &lt;td&gt;Purchase&lt;/td&gt;
        &lt;td&gt;$10.00&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;12:12&lt;/td&gt;
        &lt;td&gt;Purchase&lt;/td&gt;
        &lt;td&gt;$12.50&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
        &lt;td&gt;14:11&lt;/td&gt;
        &lt;td&gt;Expense&lt;/td&gt;
        &lt;td&gt;$9.70&lt;/td&gt;
    &lt;/tr&gt;
    &lt;/tbody&gt;
&lt;/table&gt;

var rows = d3.selectAll(&quot;tr&quot;); ∂
   var headerElement = rows._groups[0][0];
d3.select(headerElement).attr(&quot;class&quot;, &quot;table-header&quot;); 
d3.select(rows._groups[0][1]).attr(&quot;class&quot;, &quot;table-row-odd&quot;); 
d3.select(rows._groups[0][2]).attr(&quot;class&quot;, &quot;table-row-even&quot;); 
d3.select(rows._groups[0][3]).attr(&quot;class&quot;, &quot;table-row-odd&quot;);
</code></pre><p>####进入-更新-退出模式（enter-update-exit）</p><p>#####将数组绑定为数据</p><pre><code>var data = [10,15,30,50,80,65,55,30,20,10,9];
function render(data) {
    //进入 enter
    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;)
        .data(data)
        .enter()
        .append(&quot;div&quot;)
            .attr(&quot;class&quot;,&quot;h-bar&quot;)
                .append(&quot;span&quot;);
    //更新 update
    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;)
    .data(data)
    .style(&quot;width&quot;,function(d){
        return d*3 + &quot;px&quot;;
    })
    .select(&quot;span&quot;)
        .text(function(d){
            return d;
        });
    //退出 exit
    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;)
        .data(data)
        .exit()
            .remove();
}
setInterval(function(){
    data.shift();
    data.push(Math.round(Math.random()*100));
    render(data);
},1500);
render(data);
</code></pre><p>#####将对象字面量绑定为数据</p><pre><code>var data2 = [
    {width:10,color:23},
    {width:15,color:33},
    {width:30,color:40},
    {width:50,color:60},
    {width:80,color:22},
    {width:65,color:10},
    {width:55,color:5},
    {width:30,color:30},
    {width:20,color:60},
    {width:10,color:90},
    {width:8,color:10},
];

var colorScale = d3.scaleLinear().domain([10,100]).range([&apos;#add8e6&apos;,&quot;blue&quot;]);
function render(data) {
    //进入 enter
    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;)
        .data(data)
        .enter()
        .append(&quot;div&quot;)
            .attr(&quot;class&quot;,&quot;h-bar&quot;)
                .append(&quot;span&quot;);
    //更新 update
    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;)
    .data(data)
    .style(&quot;width&quot;,function(d){
        return d.width*3 + &quot;px&quot;;
    })
    .style(&quot;background-color&quot;,function(d){
        return colorScale(d.color);
    })
    .select(&quot;span&quot;)
        .text(function(d){
            return d.width;
        });
    //退出 exit
    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;)
        .data(data)
        .exit()
            .remove();
}
function randomValue() {
    return Math.round(Math.random() * 100);
}
setInterval(function(){
    data2.shift();
    data2.push({width:randomValue(), color:randomValue()});
    render(data2);
},1500);
render(data2);
</code></pre><p>#####将函数绑定为数据</p><pre><code>    d3.select(&quot;body&quot;).append(&quot;div&quot;).attr(&quot;id&quot;,&quot;container3&quot;);
var data3 = [];
var next = function(x) {
    return 15+x*x;
};
var newData = function() {
    if(data3.length &gt; 8) data3.shift();
    data3.push(next);
    return data3;
}
function render3() {
    var selection = d3.select(&quot;#container3&quot;).selectAll(&quot;div&quot;).data(newData);
    selection.enter().append(&quot;div&quot;).append(&quot;span&quot;);
    selection.exit().remove();
    selection.attr(&quot;class&quot;,&quot;v-bar&quot;)
                     .style(&quot;height&quot;,function(d,i){
                             return d(i) + &quot;px&quot;;
                     })
                     .select(&quot;span&quot;)
                         .text(function(d,i){
                             return d(i);
                         });
}
setInterval(function(){
    render3();
},1500);
render3();
</code></pre><p>作为数据的函数一般情况下需要时幂等的。幂等函数是指同一个函数，对于相同输入的多次运算结果和一次的运算结果是相同的。</p><p>####处理数组</p><pre><code>var array = [3,2,11,7,6,4,10,7,15];
d3.select(&quot;#min&quot;).text(d3.min(array));
d3.select(&quot;#max&quot;).text(d3.max(array));
d3.select(&quot;#extent&quot;).text(d3.extent(array));
d3.select(&quot;#sum&quot;).text(d3.sum(array));
d3.select(&quot;#median&quot;).text(d3.median(array));
d3.select(&quot;#mean&quot;).text(d3.mean(array));
d3.select(&quot;#asc&quot;).text(array.sort(d3.ascending));
d3.select(&quot;#desc&quot;).text(array.sort(d3.descending));
//分位数
d3.select(&quot;#quantile&quot;).text(
    d3.quantile(array.sort(d3.ascending), 0.25)
);
//返回插入点，插入点左边的元素都小于等于指定的元素，插入点右边的元素大于指定的元素
d3.select(&quot;#bisect&quot;).text(
    d3.bisect(array.sort(d3.ascending), 6)
);

var records = [
    {quantity: 2, total: 190, tip: 100, type: &quot;tab&quot;},
    {quantity: 2, total: 190, tip: 100, type: &quot;tab&quot;},
    {quantity: 1, total: 300, tip: 200, type: &quot;visa&quot;},
    {quantity: 2, total: 90, tip: 0, type: &quot;tab&quot;},
    {quantity: 2, total: 90, tip: 0, type: &quot;tab&quot;},
    {quantity: 2, total: 90, tip: 0, type: &quot;tab&quot;},
    {quantity: 1, total: 100, tip: 0, type: &quot;cash&quot;},
    {quantity: 2, total: 90, tip: 0, type: &quot;tab&quot;},
    {quantity: 2, total: 90, tip: 0, type: &quot;tab&quot;},
    {quantity: 2, total: 90, tip: 0, type: &quot;tab&quot;},
    {quantity: 2, total: 200, tip: 0, type: &quot;cash&quot;},
    {quantity: 1, total: 200, tip: 100, type: &quot;visa&quot;}
];
//将一维数据结构的数据转换为树状嵌套结构的数据
var nest = d3.nest()
        .key(function (d) { // &lt;- A
            return d.type;
        })
        .key(function (d) { // &lt;- B
            return d.tip;
        })
        .entries(records); // &lt;- C

d3.select(&quot;body&quot;).append(&quot;div&quot;).html(printNest(nest, &quot;&quot;));

function printNest(nest, out, i) {
    if(i === undefined) i = 0;

    var tab = &quot;&quot;; for(var j = 0; j &lt; i; ++j) tab += &quot;&amp;nbsp;&quot;;

    nest.forEach(function (e) {
        if (e.key)
            out += tab + e.key + &quot;&lt;br&gt;&quot;;
        else
            out += tab + printObject(e) + &quot;&lt;br&gt;&quot;;

        if (e.values)
            out = printNest(e.values, out, ++i);
        else
            return out;
    });

    return out;
}

function printObject(obj) {
    var s = &quot;{&quot;;
    for (var f in obj) {
        s += f + &quot;: &quot; + obj[f] + &quot;, &quot;;
    }
    s += &quot;}&quot;;
    return s;
}
</code></pre><p>#<br>d3.ascending = function(a,b){return a<b ?="" -1="" :="" a="">b ? 1 : 0;}<br>d3.descending = function(a,b){return a&gt;b ? -1 : a&lt;b ? 1 : 0;}</b></p><p>####数据的过滤<br>var data = [ // &lt;-A<br>{expense: 10, category: “Retail”},<br>{expense: 15, category: “Gas”},<br>{expense: 30, category: “Retail”},<br>{expense: 50, category: “Dining”},<br>{expense: 80, category: “Gas”},<br>{expense: 65, category: “Retail”},<br>{expense: 55, category: “Gas”},<br>{expense: 30, category: “Dining”},<br>{expense: 20, category: “Retail”},<br>{expense: 10, category: “Dining”},<br>{expense: 8, category: “Gas”}<br>];</p><pre><code>function render(data, category) {
    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;) // &lt;-B
            .data(data)
    .enter()
        .append(&quot;div&quot;)
            .attr(&quot;class&quot;, &quot;h-bar&quot;)
    .append(&quot;span&quot;);

    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;) // &lt;-C
            .data(data)
        .exit().remove();

    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;) // &lt;-D
            .data(data)
        .attr(&quot;class&quot;, &quot;h-bar&quot;)
        .style(&quot;width&quot;, function (d) {
            return (d.expense * 5) + &quot;px&quot;;}
        )
        .select(&quot;span&quot;)
            .text(function (d) {
                return d.category;
            });

    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;)
            .filter(function (d, i) { // &lt;-E
                return d.category == category;
            })
            .classed(&quot;selected&quot;, true);
}

render(data);

function select(category) {
    render(data, category);
}

&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;select(&apos;Retail&apos;)&quot;&gt;
        Retail
    &lt;/button&gt;
    &lt;button onclick=&quot;select(&apos;Gas&apos;)&quot;&gt;
        Gas
    &lt;/button&gt;
    &lt;button onclick=&quot;select(&apos;Dining&apos;)&quot;&gt;
        Dining
    &lt;/button&gt;
    &lt;button onclick=&quot;select()&quot;&gt;
        Clear
    &lt;/button&gt;
&lt;/div&gt;
</code></pre><p>####基于数据的图形排序<br>var data = [ // &lt;-A<br>{expense: 10, category: “Retail”},<br>{expense: 15, category: “Gas”},<br>{expense: 30, category: “Retail”},<br>{expense: 50, category: “Dining”},<br>{expense: 80, category: “Gas”},<br>{expense: 65, category: “Retail”},<br>{expense: 55, category: “Gas”},<br>{expense: 30, category: “Dining”},<br>{expense: 20, category: “Retail”},<br>{expense: 10, category: “Dining”},<br>{expense: 8, category: “Gas”}<br>];</p><pre><code>function render(data, comparator) {
    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;) // &lt;-B
            .data(data)
        .enter().append(&quot;div&quot;)
            .attr(&quot;class&quot;, &quot;h-bar&quot;)
            .append(&quot;span&quot;);

    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;) // &lt;-C
            .data(data)
        .exit().remove();

    d3.select(&quot;body&quot;).selectAll(&quot;div.h-bar&quot;) // &lt;-D
            .data(data)
        .attr(&quot;class&quot;, &quot;h-bar&quot;)
        .style(&quot;width&quot;, function (d) {
            return (d.expense * 5) + &quot;px&quot;;
        })
        .select(&quot;span&quot;)
            .text(function (d) {
                return d.category;
            });

    if(comparator)
        d3.select(&quot;body&quot;)
            .selectAll(&quot;div.h-bar&quot;) 
            .sort(comparator); // &lt;-E
}

var compareByExpense = function (a, b) {  // &lt;-F
    return a.expense &lt; b.expense?-1:1;
};
var compareByCategory = function (a, b) {  // &lt;-G
    return a.category &lt; b.category?-1:1;
};

render(data);

function sort(comparator) {
    render(data, comparator);
}

&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;sort(compareByExpense)&quot;&gt;
        Sort by Width
    &lt;/button&gt;
    &lt;button onclick=&quot;sort(compareByCategory)&quot;&gt;
        Sort by Category
    &lt;/button&gt;
    &lt;button onclick=&quot;sort()&quot;&gt;
        Clear
    &lt;/button&gt;
&lt;/div&gt;
</code></pre><p>####从服务器加载数据</p><pre><code>function load(){
    d3.json(&quot;data.json&quot;, function(error, json){
        data = data.concat(json);  
        render(data);
    });
}

json,csv,tsv,txt,html,xml
d3.xhr
</code></pre><p>假设A和B是两个非空集合，函数f是A到B的一个映射，使得B中的每个元素与A中的元素一一对应。当b中每个元素都可以通过函数f映射到a中的相应元素时，记做f(a)=b</p><p>#####数值尺度</p><pre><code>&lt;div id=&quot;linear&quot; class=&quot;clear&quot;&gt;&lt;span&gt;n&lt;/span&gt;&lt;/div&gt;
&lt;div id=&quot;linear-capped&quot; class=&quot;clear&quot;&gt;
    &lt;span&gt;1 &amp;lt;= a*n + b &amp;lt;= 20&lt;/span&gt;
&lt;/div&gt;
&lt;div id=&quot;pow&quot; class=&quot;clear&quot;&gt;&lt;span&gt;n^2&lt;/span&gt;&lt;/div&gt;
&lt;div id=&quot;pow-capped&quot; class=&quot;clear&quot;&gt;
    &lt;span&gt;1 &amp;lt;= a*n^2 + b &amp;lt;= 10&lt;/span&gt;
&lt;/div&gt;
&lt;div id=&quot;log&quot; class=&quot;clear&quot;&gt;&lt;span&gt;log(n)&lt;/span&gt;&lt;/div&gt;
&lt;div id=&quot;log-capped&quot; class=&quot;clear&quot;&gt;
    &lt;span&gt;1 &amp;lt;= a*log(n) + b &amp;lt;= 10&lt;/span&gt;
&lt;/div&gt;

var max = 11, data = [];
for (var i = 1; i &lt; max; ++i) data.push(i);

// 线性尺度 f(n) = a*n + b
var linear = d3.scaleLinear() // &lt;-A
    .domain([1, 10]) // &lt;-B
    .range([1, 10]); // &lt;-C        
var linearCapped = d3.scaleLinear()
    .domain([1, 10])        
    .range([1, 20]); // &lt;-D

// 幂级尺度 f(n) = a*n^2 + b
var pow = d3.scalePow().exponent(2); // &lt;-E
var powCapped = d3.scalePow() // &lt;-F
    .exponent(2)
    .domain([1, 10])
    .rangeRound([1, 10]); // &lt;-G

// 对数尺度 f(n) = a*log(n) + b
var log = d3.scaleLog(); // &lt;-H
var logCapped = d3.scaleLog() // &lt;-I
    .domain([1, 10])
    .rangeRound([1, 10]);


function render(data, scale, selector) {
    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
            .enter().append(&quot;div&quot;).classed(&quot;cell&quot;, true);

    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
            .exit().remove();

    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
            .style(&quot;display&quot;, &quot;inline-block&quot;)
            .text(function (d) {
                return Math.round(scale(d) * 100 ) / 100;
            });
}

render(data, linear, &quot;#linear&quot;);
render(data, linearCapped, &quot;#linear-capped&quot;);
render(data, pow, &quot;#pow&quot;);
render(data, powCapped, &quot;#pow-capped&quot;);
render(data, log, &quot;#log&quot;);
render(data, logCapped, &quot;#log-capped&quot;);
</code></pre><p>除了上述尺度外，D3还提供多种数值尺度，例如 quantize(一种线性离散尺度)，threshold(阈值尺度)，quantile(分位尺度)，identity(等价尺度)</p><p>#####时间尺度<br>var start = new Date(2013, 0, 1),<br>end = new Date(2013, 11, 31),<br>range = [0, 1200],<br>time = d3.scaleTime().domain([start, end])<br>.rangeRound(range),<br>max = 12,<br>data = [];</p><pre><code>for (var i = 0; i &lt; max; ++i){ 
    var date = new Date(start.getTime());
    date.setMonth(start.getMonth() + i);
    data.push(date);
}

function render(data, scale, selector) { 
    d3.select(selector).selectAll(&quot;div.fixed-cell&quot;)
                .data(data)
            .enter()
                .append(&quot;div&quot;).classed(&quot;fixed-cell&quot;, true);

    d3.select(selector).selectAll(&quot;div.fixed-cell&quot;)
                .data(data)
            .exit().remove();

    d3.select(selector).selectAll(&quot;div.fixed-cell&quot;)
                .data(data)
            .style(&quot;margin-left&quot;, function(d){ 
                return scale(d) + &quot;px&quot;;
            })
            .html(function (d) { 
                var format = d3.timeFormat(&quot;%x&quot;); 
                return format(d) + &quot;&lt;br&gt;&quot; + scale(d) + &quot;px&quot;;
            });
}

render(data, time, &quot;#time&quot;);
</code></pre><p>#####有序尺度</p><pre><code>var max = 10, data = [];

for (var i = 0; i &lt; max; ++i) data.push(i); 

var alphabet = d3.scaleOrdinal()
    .domain(data)
    .range([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;, &quot;f&quot;, &quot;g&quot;, &quot;h&quot;, &quot;i&quot;, &quot;j&quot;]);

function render(data, scale, selector) { 
    d3.select(selector).selectAll(&quot;div.cell&quot;)
                .data(data)
            .enter().append(&quot;div&quot;).classed(&quot;cell&quot;, true);

    d3.select(selector).selectAll(&quot;div.cell&quot;)
                .data(data)
            .exit().remove();

    d3.select(selector).selectAll(&quot;div.cell&quot;)
                .data(data)
            .style(&quot;display&quot;, &quot;inline-block&quot;)
            .style(&quot;background-color&quot;, function(d){ 
                return scale(d).indexOf(&quot;#&quot;)&gt;=0?scale(d):&quot;white&quot;;
            })
            .text(function (d) { 
                return scale(d);
            });
}

render(data, alphabet, &quot;#alphabet&quot;);
render(data, d3.scaleOrdinal(d3.schemeCategory10), &quot;#category10&quot;);
</code></pre><p>#####插值器</p><pre><code>var interpolate = d3.interpolateNumber(0,100);
interpolate(0.1);//10
interpolate(0.99);//99

function interpolate(t){
    return a*(1-t)+b*t;
}
</code></pre><p>#####字符串插值</p><pre><code>d3.select(&quot;body&quot;).append(&quot;div&quot;).attr(&quot;id&quot;,&quot;font&quot;);
var max = 11, data = [];

var sizeScale = d3.scaleLinear() 
    .domain([0, max])
    .range([  
        &quot;italic bold 12px/30px Georgia, serif&quot;, 
        &quot;italic bold 120px/180px Georgia, serif&quot;
    ]);

for (var i = 0; i &lt; max; ++i) data.push(i);

function render(data, scale, selector) { 
    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
        .enter().append(&quot;div&quot;).classed(&quot;cell&quot;, true)
            .append(&quot;span&quot;);

    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
        .exit().remove();

    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
        .style(&quot;display&quot;, &quot;inline-block&quot;)
        .select(&quot;span&quot;)
            .style(&quot;font&quot;, function(d,i){ 
                return scale(d); 
            })
            .text(function(d,i){return i;}); 
}

render(data, sizeScale, &quot;#font&quot;);
</code></pre><p>#####颜色插值</p><pre><code>    d3.select(&quot;body&quot;).append(&quot;div&quot;).attr(&quot;id&quot;,&quot;color&quot;).attr(&quot;class&quot;,&quot;clear&quot;);
    d3.select(&quot;body&quot;).append(&quot;div&quot;).attr(&quot;id&quot;,&quot;color-diverge&quot;).attr(&quot;class&quot;,&quot;clear&quot;);
    var max = 21, data = [];

var colorScale = d3.scaleLinear() 
    .domain([0, max])
    .range([&quot;white&quot;, &quot;#4169e1&quot;]);

//分段线性尺度
function divergingScale(pivot) { 
    var divergingColorScale = d3.scaleLinear()
        .domain([0, pivot, max]) 
        .range([&quot;white&quot;, &quot;#4169e1&quot;, &quot;white&quot;]);
    return divergingColorScale;
}

for (var i = 0; i &lt; max; ++i) data.push(i);

function render(data, scale, selector) { 
    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
        .enter()
            .append(&quot;div&quot;)
                .classed(&quot;cell&quot;, true)
            .append(&quot;span&quot;);

    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
        .exit().remove();

    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
        .style(&quot;display&quot;, &quot;inline-block&quot;)
        .style(&quot;background-color&quot;, function(d){
            return scale(d);
        })
        .select(&quot;span&quot;)
            .text(function(d,i){return i;});
}

render(data, colorScale, &quot;#color&quot;);
render(data, divergingScale(5), &quot;#color-diverge&quot;);
</code></pre><p>#####复合对象插值</p><pre><code>d3.select(&quot;body&quot;).append(&quot;div&quot;).attr(&quot;id&quot;,&quot;compound&quot;);
    var max = 21, data = [];

var compoundScale = d3.scalePow()
        .exponent(2)
        .domain([0, max])
        .range([
            {color:&quot;#add8e6&quot;, height:&quot;15px&quot;}, 
            {color:&quot;#4169e1&quot;, height:&quot;150px&quot;} 
        ]);

for (var i = 0; i &lt;= max; ++i) data.push(i);

function render(data, scale, selector) { 
    d3.select(selector).selectAll(&quot;div.v-bar&quot;)
            .data(data)
            .enter().append(&quot;div&quot;).classed(&quot;v-bar&quot;, true)
            .append(&quot;span&quot;);

    d3.select(selector).selectAll(&quot;div.v-bar&quot;)
            .data(data)
            .exit().remove();

    d3.select(selector).selectAll(&quot;div.v-bar&quot;)
            .data(data)
            .classed(&quot;v-bar&quot;, true)
            .style(&quot;height&quot;, function(d){ 
                return scale(d).height;
            }) 
            .style(&quot;background-color&quot;, function(d){ 
                return scale(d).color;
            })
            .select(&quot;span&quot;)
            .text(function(d,i){return i;});
}

render(data, compoundScale, &quot;#compound&quot;);
</code></pre><p>#####自定义插值器</p><pre><code>d3.select(&quot;body&quot;).append(&quot;div&quot;).attr(&quot;id&quot;,&quot;dollar&quot;);
d3.select(&quot;body&quot;).append(&quot;div&quot;).attr(&quot;id&quot;,&quot;alphabet&quot;);

var dollarScale = d3.scaleLinear()
        .domain([0, 13])
        .range([&quot;$0&quot;, &quot;$300&quot;])
        .interpolate(
                    function(a, b) {
                        var re = /^\$([0-9,.]+)$/;
                        var ma, mb;
                        var f = d3.format(&quot;,.02f&quot;);

                        if ((ma = re.exec(a)) &amp;&amp; (mb = re.exec(b))) {
                            a = parseFloat(ma[1]);
                            b = parseFloat(mb[1]) - a;
                            return function(t) {
                                return &quot;$&quot; + f(a + b * t);
                            }
                        }
                    }
                );

var alphabetScale = d3.scaleLinear()
        .domain([0, 27])
        .range([&quot;a&quot;, &quot;z&quot;])
        .interpolate(
            function(a, b) { 
                      var re = /^([a-z])$/, ma, mb; 
                      if ((ma = re.exec(a)) &amp;&amp; (mb = re.exec(b))) { 
                        a = a.charCodeAt(0);
                        var delta = a - b.charCodeAt(0); 
                        return function(t) { 
                          return String.fromCharCode(Math.ceil(a - delta * t));
                        };
                      }
                    }
        );

function render(scale, selector) {        
    var data = [];
    var max = scale.domain()[1];

    for (var i = 0; i &lt;= max; ++i) data.push(i);      

    d3.select(selector).selectAll(&quot;div.cell&quot;)
                .data(data)
            .enter()
                .append(&quot;div&quot;)
                    .classed(&quot;cell&quot;, true)
                .append(&quot;span&quot;);

    d3.select(selector).selectAll(&quot;div.cell&quot;)
                .data(data)
            .exit().remove();

    d3.select(selector).selectAll(&quot;div.cell&quot;)
            .data(data)
            .style(&quot;display&quot;, &quot;inline-block&quot;)
            .select(&quot;span&quot;)
                .text(function(d,i){return scale(d);}); 
}

render(dollarScale, &quot;#dollar&quot;);
render(alphabetScale, &quot;#alphabet&quot;);
</code></pre><p>#####坐标轴基础</p><pre><code>&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;renderAll(&apos;bottom&apos;)&quot;&gt;
        horizontal bottom
    &lt;/button&gt;
    &lt;button onclick=&quot;renderAll(&apos;top&apos;)&quot;&gt;
        horizontal top
    &lt;/button&gt;
    &lt;button onclick=&quot;renderAll(&apos;left&apos;)&quot;&gt;
        vertical left
    &lt;/button&gt;
    &lt;button onclick=&quot;renderAll(&apos;right&apos;)&quot;&gt;
        vertical right
    &lt;/button&gt;
&lt;/div&gt;
String.prototype.firstUpperCase = function(){  
     return this.replace(/\b(\w)/g, function($1){  
         return $1.toUpperCase();  
     });  
     } 

var height = 500, 
    width = 500, 
    margin = 25,
    offset = 50,
    axisWidth = width - 2 * margin,
    svg;

function createSvg(){
     svg = d3.select(&quot;body&quot;).insert(&quot;svg&quot;,&quot;.control-group&quot;) 
        .attr(&quot;class&quot;, &quot;axis&quot;) 
        .attr(&quot;width&quot;, width)
        .attr(&quot;height&quot;, height);

}

function renderAxis(scale, i, orient){
    var axis = d3[&apos;axis&apos;+orient.firstUpperCase()]()
        .scale(scale) 
        .ticks(5); 

    svg.append(&quot;g&quot;)        
        .attr(&quot;transform&quot;, function(){ 
            if([&quot;top&quot;, &quot;bottom&quot;].indexOf(orient) &gt;= 0)
                return &quot;translate(&quot; + margin + &quot;,&quot; + i * offset + &quot;)&quot;;
            else
                return &quot;translate(&quot; + i * offset + &quot;, &quot; + margin + &quot;)&quot;;
        })
        .call(axis); 
}

function renderAll(orient){
    if(svg) svg.remove();

    createSvg();

    renderAxis(d3.scaleLinear()
                .domain([0, 1000])
                .range([0, axisWidth]), 1, orient);
    renderAxis(d3.scalePow()
                .exponent(2)
                .domain([0, 1000])
                .range([0, axisWidth]), 2, orient);
    renderAxis(d3.scaleTime()
                .domain([new Date(2012, 0, 1), new Date()])
                .range([0, axisWidth]), 3, orient);
}
window.renderAll = renderAll;
</code></pre><p>#####自定义刻度</p><pre><code>var height = 500, 
    width = 500, 
    margin = 25,
    axisWidth = width - 2 * margin;

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;width&quot;, width)
        .attr(&quot;height&quot;, height);

var scale = d3.scaleLinear().domain([0, 100]).range([0, axisWidth]);

var axis = d3.axisBottom()
        .scale(scale)
        .ticks(5)
        //.tickSubdivide(5) 
        .tickPadding(10) 
        .tickFormat(function(v){ 
            return v + &quot;%&quot;;
        });

svg.append(&quot;g&quot;)        
    .attr(&quot;transform&quot;, function(){
        return &quot;translate(&quot; + margin + &quot;,&quot; + margin + &quot;)&quot;;
    })
    .call(axis);
</code></pre><p>#####绘制表格线</p><pre><code>var height = 500, 
    width = 500, 
    margin = 25;       

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;width&quot;, width)
        .attr(&quot;height&quot;, height);

function renderXAxis(){
    var axisLength = width - 2 * margin;

    var scale = d3.scaleLinear()
                    .domain([0, 100])
                    .range([0, axisLength]);

    var xAxis = d3.axisBottom()
            .scale(scale);

    svg.append(&quot;g&quot;)       
        .attr(&quot;class&quot;, &quot;x-axis&quot;)
        .attr(&quot;transform&quot;, function(){ 
            return &quot;translate(&quot; + margin + &quot;,&quot; + (height - margin) + &quot;)&quot;;
        })
        .call(xAxis);

    d3.selectAll(&quot;g.x-axis g.tick&quot;) 
        .append(&quot;line&quot;) 
            .classed(&quot;grid-line&quot;, true)
            .attr(&quot;x1&quot;, 0) 
            .attr(&quot;y1&quot;, 0)
            .attr(&quot;x2&quot;, 0)
            .attr(&quot;y2&quot;, - (height - 2 * margin)); 
}

function renderYAxis(){        
    var axisLength = height - 2 * margin;

    var scale = d3.scaleLinear()
                    .domain([100, 0])
                    .range([0, axisLength]);

    var yAxis = d3.axisLeft()
            .scale(scale);

    svg.append(&quot;g&quot;)       
        .attr(&quot;class&quot;, &quot;y-axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + margin + &quot;,&quot; + margin + &quot;)&quot;;
        })
        .call(yAxis);

    d3.selectAll(&quot;g.y-axis g.tick&quot;)
        .append(&quot;line&quot;)
            .classed(&quot;grid-line&quot;, true)
            .attr(&quot;x1&quot;, 0)
            .attr(&quot;y1&quot;, 0)
            .attr(&quot;x2&quot;, axisLength) 
            .attr(&quot;y2&quot;, 0);
}   

renderYAxis();
renderXAxis();
</code></pre><p>#####动态调节坐标轴尺度</p><pre><code>&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;rescale()&quot;&gt;ReScale&lt;/button&gt;
&lt;/div&gt;
var height = 500, 
    width = 500, 
    margin = 25,
    xAxis, yAxis, xAxisLength, yAxisLength;

var svg = d3.select(&quot;body&quot;).insert(&quot;svg&quot;,&quot;.control-group&quot;)     
        .attr(&quot;class&quot;, &quot;axis&quot;)    
        .attr(&quot;width&quot;, width)
        .attr(&quot;height&quot;, height);

function renderXAxis(){
    xAxisLength = width - 2 * margin;

    var scale = d3.scaleLinear()
                    .domain([0, 100])
                    .range([0, xAxisLength]);

    xAxis = d3.axisBottom()
            .scale(scale);

    svg.append(&quot;g&quot;)       
        .attr(&quot;class&quot;, &quot;x-axis&quot;)
        .attr(&quot;transform&quot;, function(){ 
            return &quot;translate(&quot; + margin + &quot;,&quot; + (height - margin) + &quot;)&quot;;
        })
        .call(xAxis);
}

function renderYAxis(){        
    yAxisLength = height - 2 * margin;

    var scale = d3.scaleLinear()
                    .domain([100, 0])
                    .range([0, yAxisLength]);

    yAxis = d3.axisLeft()
            .scale(scale);

    svg.append(&quot;g&quot;)       
        .attr(&quot;class&quot;, &quot;y-axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + margin + &quot;,&quot; + margin + &quot;)&quot;;
        })
        .call(yAxis);
}   

function rescale(){ 
    var max = Math.round(Math.random() * 100);

    xAxis.scale().domain([0, max]); 
    svg.select(&quot;g.x-axis&quot;)
        .transition()
        .call(xAxis); 

    yAxis.scale().domain([max, 0]);
    svg.select(&quot;g.y-axis&quot;)
        .transition()
        .call(yAxis);

    renderXGridlines();
    renderYGridlines();
}       

function renderXGridlines(){
    var lines = d3.selectAll(&quot;g.x-axis g.tick&quot;)
            .select(&quot;line.grid-line&quot;)
            .remove(); 

    lines = d3.selectAll(&quot;g.x-axis g.tick&quot;)
            .append(&quot;line&quot;) 
            .classed(&quot;grid-line&quot;, true)

    lines.attr(&quot;x1&quot;, 0) 
            .attr(&quot;y1&quot;, 0)
            .attr(&quot;x2&quot;, 0)
            .attr(&quot;y2&quot;, - yAxisLength); 
}

function renderYGridlines(){
    var lines = d3.selectAll(&quot;g.y-axis g.tick&quot;)
            .select(&quot;line.grid-line&quot;).remove(); 

    lines = d3.selectAll(&quot;g.y-axis g.tick&quot;)
            .append(&quot;line&quot;) 
            .classed(&quot;grid-line&quot;, true)

    lines.attr(&quot;x1&quot;, 0)
        .attr(&quot;y1&quot;, 0)
        .attr(&quot;x2&quot;, xAxisLength)
        .attr(&quot;y2&quot;, 0);
}

renderYAxis();
renderXAxis();
renderXGridlines();
renderYGridlines();
window.rescale = rescale;
</code></pre><p>#####单元素动画</p><pre><code>var body = d3.select(&quot;body&quot;), 
    duration = 5000;

body.append(&quot;div&quot;) 
        .classed(&quot;box&quot;, true)
        .style(&quot;background-color&quot;, &quot;#e9967a&quot;) 
    .transition()
    .duration(duration) 
        .style(&quot;background-color&quot;, &quot;#add8e6&quot;) 
        .style(&quot;margin-left&quot;, &quot;600px&quot;) 
        .style(&quot;width&quot;, &quot;100px&quot;)
        .style(&quot;height&quot;, &quot;100px&quot;);
</code></pre><p>#####多元素动画</p><pre><code>var id= 0, 
    data = [], 
    duration = 500, 
    chartHeight = 100, 
    chartWidth = 680;

for(var i = 0; i &lt; 20; i++) push(data);   

function render(data) {
    var selection = d3.select(&quot;body&quot;)
            .selectAll(&quot;div.v-bar&quot;)
            .data(data, function(d){return d.id;}); 

    // enter
    selection.enter()
            .append(&quot;div&quot;)
                .attr(&quot;class&quot;, &quot;v-bar&quot;)
                .style(&quot;position&quot;, &quot;fixed&quot;)
                .style(&quot;top&quot;, chartHeight + &quot;px&quot;)
                .style(&quot;left&quot;, function(d, i){
                    return barLeft(i+1) + &quot;px&quot;; 
                })
                .style(&quot;height&quot;, &quot;0px&quot;) 
            .append(&quot;span&quot;);

    // update
    selection
        .transition().duration(duration) 
            .style(&quot;top&quot;, function (d) { 
                return chartHeight - barHeight(d) + &quot;px&quot;; 
            })
            .style(&quot;left&quot;, function(d, i){
                return barLeft(i) + &quot;px&quot;;
            })
            .style(&quot;height&quot;, function (d) { 
                return barHeight(d) + &quot;px&quot;; 
            })
            .select(&quot;span&quot;)
                .text(function (d) {return d.value;});

    // exit
    selection.exit()
            .transition().duration(duration) 
            .style(&quot;left&quot;, function(d, i){
                return barLeft(-1) + &quot;px&quot;; 
            })
            .remove(); 
}

function push(data) {
    data.push({
        id: ++id, 
        value: Math.round(Math.random() * chartHeight)
    });
}

function barLeft(i) {
    return i * (30 + 2);
}

function barHeight(d) {
    return d.value;
}

setInterval(function () {
    data.shift();
    push(data);
    render(data);
}, 2000);

render(data);

d3.select(&quot;body&quot;)
   .append(&quot;div&quot;)
       .attr(&quot;class&quot;, &quot;baseline&quot;)
       .style(&quot;position&quot;, &quot;fixed&quot;)
       .style(&quot;top&quot;, chartHeight + &quot;px&quot;)
       .style(&quot;left&quot;, &quot;0px&quot;)
       .style(&quot;width&quot;, chartWidth + &quot;px&quot;);
</code></pre><p>#####使用缓动函数</p><pre><code>var data = [ 
        &quot;easeLinear&quot;, &quot;easeCubic&quot;, &quot;easeCubicInOut&quot;, 
        &quot;easeSin&quot;, &quot;easeSinOut&quot;, &quot;easeExp&quot;, &quot;easeCircle&quot;, &quot;easeBack&quot;, 
        &quot;easeBounce&quot;,
        function(t){ 
            return t * t;
        }
    ],
  colors = d3.scaleLinear().domain([0,10]).range([&apos;pink&apos;,&apos;blue&apos;]);

d3.select(&quot;body&quot;).selectAll(&quot;div&quot;)
        .data(data) 
    .enter()
    .append(&quot;div&quot;)
        .attr(&quot;class&quot;, &quot;fixed-cell&quot;)
        .style(&quot;top&quot;, function (d, i) {
            return i * 40 + &quot;px&quot;;
        })
        .style(&quot;background-color&quot;, function (d, i) {
            return colors(i);
        })
        .style(&quot;color&quot;, &quot;white&quot;)
        .style(&quot;left&quot;, &quot;500px&quot;)
        .text(function (d) {
            if(typeof d === &apos;function&apos;) return &quot;custom&quot;;
            return d;
        });

setTimeout(function(){
        d3.selectAll(&quot;div.fixed-cell&quot;).each(function(d){
            if(typeof d === &apos;function&apos;) {
                    d3.select(this)
                            .transition()
                            .ease(d)
                            .duration(1500)
                            .style(&quot;left&quot;, &quot;10px&quot;);
            } else {
                    d3.select(this)
                            .transition()
                            .ease(d3[d])
                            .duration(1500)
                            .style(&quot;left&quot;, &quot;10px&quot;);
            }
        });
},3000);
</code></pre><p>#####使用中间帧计算</p><pre><code>var body = d3.select(&quot;body&quot;), duration = 5000;

body.append(&quot;div&quot;).append(&quot;input&quot;)
    .attr(&quot;type&quot;, &quot;button&quot;)
    .attr(&quot;class&quot;, &quot;countdown&quot;)
    .attr(&quot;value&quot;, &quot;0&quot;)
    .style(&quot;width&quot;, &quot;150px&quot;)
    .transition().duration(duration).ease(d3.easeLinear)
        .style(&quot;width&quot;, &quot;400px&quot;)
        .attr(&quot;value&quot;, &quot;9&quot;);

body.append(&quot;div&quot;).append(&quot;input&quot;)
    .attr(&quot;type&quot;, &quot;button&quot;)
    .attr(&quot;class&quot;, &quot;countdown&quot;)
    .attr(&quot;value&quot;, &quot;0&quot;)
    .transition().duration(duration).ease(d3.easeLinear)
        .styleTween(&quot;width&quot;, widthTween) 
        .attrTween(&quot;value&quot;, valueTween);


function widthTween(a){
    var interpolate = d3.scaleQuantize()
        .domain([0, 1])
        .range([150, 200, 250, 350, 400]);

    return function(t){
        return interpolate(t) + &quot;px&quot;;
    };
}

function valueTween(){
    var interpolate = d3.scaleQuantize() 
        .domain([0, 1])
        .range([1, 2, 3, 4, 5, 6, 7, 8, 9]);

    return function(t){ 
        return interpolate(t);
    };
}        
</code></pre><p>#####级联过渡</p><pre><code>var body = d3.select(&quot;body&quot;);

function teleport(s){
    s.transition().duration(300) 
        .style(&quot;width&quot;, &quot;200px&quot;)
        .style(&quot;height&quot;, &quot;1px&quot;)
    .transition().duration(100) 
        .style(&quot;left&quot;, &quot;600px&quot;)
    .transition().duration(300) 
        .style(&quot;left&quot;, &quot;800px&quot;)
        .style(&quot;height&quot;, &quot;80px&quot;)
        .style(&quot;width&quot;, &quot;80px&quot;);
}

body.append(&quot;div&quot;)    
        .style(&quot;position&quot;, &quot;fixed&quot;)
        .style(&quot;background-color&quot;, &quot;steelblue&quot;)
        .style(&quot;left&quot;, &quot;10px&quot;)
        .style(&quot;width&quot;, &quot;80px&quot;)
        .style(&quot;height&quot;, &quot;80px&quot;)
        .call(teleport); 
</code></pre><p>#####选择性过渡</p><pre><code>var data = [&quot;Cat&quot;, &quot;Dog&quot;, &quot;Cat&quot;, &quot;Dog&quot;, &quot;Cat&quot;, &quot;Dog&quot;, &quot;Cat&quot;, &quot;Dog&quot;],
    duration = 1500;

d3.select(&quot;body&quot;).selectAll(&quot;div&quot;)
        .data(data)
    .enter()
    .append(&quot;div&quot;)
        .attr(&quot;class&quot;, &quot;fixed-cell&quot;)
        .style(&quot;top&quot;, function (d, i) {
            return i * 40 + &quot;px&quot;;
        })
        .style(&quot;background-color&quot;, &quot;steelblue&quot;)
        .style(&quot;color&quot;, &quot;white&quot;)
        .style(&quot;left&quot;, &quot;500px&quot;)
        .text(function (d) {
            return d;
        })
        .transition() 
            .duration(duration)
                .style(&quot;left&quot;, &quot;10px&quot;)
        .filter(function(d){return d == &quot;Cat&quot;;}) 
            .transition() 
            .duration(duration)
                .style(&quot;left&quot;, &quot;500px&quot;);
</code></pre><p>#####监听过渡事件</p><pre><code>var body = d3.select(&quot;body&quot;), duration = 3000;

var div = body.append(&quot;div&quot;)
        .classed(&quot;box&quot;, true)
        .style(&quot;background-color&quot;, &quot;steelblue&quot;)
        .style(&quot;color&quot;, &quot;white&quot;)
        .text(&quot;waiting&quot;) 
    .transition().duration(duration) 
            .delay(1000) 
            .on(&quot;start&quot;, function(){ 
                console.log(arguments);
                d3.select(this).text(function (d, i) {
                    return &quot;transitioning&quot;;
                });
            })
            .on(&quot;end&quot;, function(){ 
                d3.select(this).text(function (d, i) {
                    return &quot;done&quot;;
                });
            })
        .style(&quot;margin-left&quot;, &quot;600px&quot;);
</code></pre><p>#####自定义插值器</p><pre><code>function customInterpolator(a, b) { 
  var re = /^([a-z])$/, ma, mb;
  if ((ma = re.exec(a)) &amp;&amp; (mb = re.exec(b))) {
    a = a.charCodeAt(0);
    var delta = a - b.charCodeAt(0);
    return function(t) {
      return String.fromCharCode(Math.ceil(a - delta * t));
    };
  }
}
var customScale = d3.scaleLinear()
        .domain([0, 1])
        .range([&quot;a&quot;, &quot;z&quot;])
        .interpolate(customInterpolator);

var body = d3.select(&quot;body&quot;);

var countdown = body.append(&quot;div&quot;).append(&quot;input&quot;);

countdown.attr(&quot;type&quot;, &quot;button&quot;)
    .attr(&quot;class&quot;, &quot;countdown&quot;)
    .attr(&quot;value&quot;, &quot;a&quot;) 
    .transition().ease(d3.easeLinear) 
    .duration(4000).delay(300)
    .attrTween(&quot;value&quot;,function(d) {
        return function(t) {
            return customScale(t);
        }
    }); 
</code></pre><p>#####定时器</p><pre><code>&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;countup(100)&quot;&gt;
        Start
    &lt;/button&gt;
    &lt;button onclick=&quot;reset()&quot;&gt;
        Clear
    &lt;/button&gt;
&lt;/div&gt;
var body = d3.select(&quot;body&quot;);

var countdown = body.append(&quot;div&quot;).append(&quot;input&quot;);

countdown.attr(&quot;type&quot;, &quot;button&quot;)
    .attr(&quot;class&quot;, &quot;countdown&quot;)
    .attr(&quot;value&quot;, &quot;0&quot;);

function countup(target){ 
    d3.timer(function(){ 
        var value = countdown.attr(&quot;value&quot;);
        if(value == target) return true;  
        countdown.attr(&quot;value&quot;, ++value);          
    });
}
window.countup = countup;

function reset(){
    countdown.attr(&quot;value&quot;, 0);
}
window.reset = reset;
</code></pre><p>#####svg简单图形</p><pre><code>&lt;style&gt;
  svg line{
      stroke: grey;
      stroke-width: 2;
  }

  svg circle{
      stroke: red;
      fill: none;
      stroke-width: 2;
  }

  svg rect{
      stroke: steelblue;
      fill: none;
      stroke-width: 2;
  }

  svg polygon{
      stroke: green;
      fill: none;
      stroke-width: 2;
  }
  &lt;/style&gt;
  var width = 600,
    height = 500;

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;);

svg.attr(&quot;height&quot;, height)
    .attr(&quot;width&quot;, width);    

svg.append(&quot;line&quot;) 
    .attr(&quot;x1&quot;, 0)
    .attr(&quot;y1&quot;, 200)
    .attr(&quot;x2&quot;, 100)
    .attr(&quot;y2&quot;, 100);

svg.append(&quot;circle&quot;) 
    .attr(&quot;cx&quot;, 200)
    .attr(&quot;cy&quot;, 150)
    .attr(&quot;r&quot;, 50);

svg.append(&quot;rect&quot;)
    .attr(&quot;x&quot;, 300) 
    .attr(&quot;y&quot;, 100)
    .attr(&quot;width&quot;, 100) 
    .attr(&quot;height&quot;, 100)
    .attr(&quot;rx&quot;, 5); 

svg.append(&quot;polygon&quot;)
    .attr(&quot;points&quot;, &quot;450,200 500,100 550,200&quot;); 
</code></pre><p>#####线条生成器</p><pre><code>var width = 500,
    height = 500,
    margin = 50,
    x = d3.scaleLinear() 
        .domain([0, 10])
        .range([margin, width - margin]),
    y = d3.scaleLinear()
        .domain([0, 10])
        .range([height - margin, margin]);

var data = [ 
    [
        {x: 0, y: 5},{x: 1, y: 9},{x: 2, y: 7},
        {x: 3, y: 5},{x: 4, y: 3},{x: 6, y: 4},
        {x: 7, y: 2},{x: 8, y: 3},{x: 9, y: 2}
    ],

    d3.range(10).map(function(i){
        return {x: i, y: Math.sin(i) + 5};
    })
];

var line = d3.line() 
        .x(function(d){return x(d.x);})
        .y(function(d){return y(d.y);});

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;);

svg.attr(&quot;height&quot;, height)
    .attr(&quot;width&quot;, width);

 svg.selectAll(&quot;path&quot;)
        .data(data)
    .enter()
        .append(&quot;path&quot;) 
        .attr(&quot;class&quot;, &quot;line&quot;)            
        .attr(&quot;d&quot;, function(d){return line(d);});

renderAxes(svg);

function renderAxes(svg){ 
    var xAxis = d3.axisBottom()
            .scale(x.range([0, quadrantWidth()]));            

    var yAxis = d3.axisLeft()
            .scale(y.range([quadrantHeight(), 0]));

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() 
                + &quot;,&quot; + yStart() + &quot;)&quot;;
        })
        .call(xAxis);

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() 
                + &quot;,&quot; + yEnd() + &quot;)&quot;;
        })
        .call(yAxis);
}

function xStart(){
    return margin;
}        

function yStart(){
    return height - margin;
}

function xEnd(){
    return width - margin;
}

function yEnd(){
    return margin;
}

function quadrantWidth(){
    return width - 2 * margin;
}

function quadrantHeight(){
    return height - 2 * margin;
}  
</code></pre><p>#####线条插值</p><pre><code>&lt;h4&gt;Interpolation Mode:&lt;/h4&gt;
&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;render(d3.curveLinear)&quot;&gt;d3.curveLinear&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveLinearClosed)&quot;&gt;d3.curveLinearClosed&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveStepBefore)&quot;&gt;d3.curveStepBefore&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveStepAfter)&quot;&gt;d3.curveStepAfter&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveBasis)&quot;&gt;d3.curveBasis&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveBasisOpen)&quot;&gt;d3.curveBasisOpen&lt;/button&gt;
&lt;/div&gt;
&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;render(d3.curveBasisClosed)&quot;&gt;d3.curveBasisClosed&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveBundle)&quot;&gt;d3.curveBundle&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveCardinal)&quot;&gt;d3.curveCardinal&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveCardinalOpen)&quot;&gt;d3.curveCardinalOpen&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveCardinalClosed)&quot;&gt;d3.curveCardinalClosed&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveMonotoneX)&quot;&gt;d3.curveMonotoneX&lt;/button&gt;    
&lt;/div&gt;

var width = 500,
    height = 500,
    margin = 30,
    x = d3.scaleLinear()
        .domain([0, 10])
        .range([margin, width - margin]),
    y = d3.scaleLinear()
        .domain([0, 10])
        .range([height - margin, margin]);

var data = [
    [
        {x: 0, y: 5},{x: 1, y: 9},{x: 2, y: 7},
        {x: 3, y: 5},{x: 4, y: 3},{x: 6, y: 4},
        {x: 7, y: 2},{x: 8, y: 3},{x: 9, y: 2}
    ],  
    d3.range(10).map(function(i){
        return {x: i, y: Math.sin(i) + 5};
    })
];

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;);

svg.attr(&quot;height&quot;, height)
    .attr(&quot;width&quot;, width);        

renderAxes(svg);

render(d3.curveLinear);    

renderDots(svg);

function render(mode){
    var line = d3.line()
            .curve(mode)
            .x(function(d){return x(d.x);})
            .y(function(d){return y(d.y);});

    svg.selectAll(&quot;path.line&quot;)
            .data(data)
        .enter()
            .append(&quot;path&quot;)
            .attr(&quot;class&quot;, &quot;line&quot;);                

    svg.selectAll(&quot;path.line&quot;)
            .data(data)       
        .attr(&quot;d&quot;, function(d){return line(d);});        
}
window.render = render;
window.d3 = d3;

function renderDots(svg){ 
    data.forEach(function(list){
         svg.append(&quot;g&quot;).selectAll(&quot;circle&quot;)
            .data(list)
          .enter().append(&quot;circle&quot;) 
            .attr(&quot;class&quot;, &quot;dot&quot;)
            .attr(&quot;cx&quot;, function(d) { return x(d.x); })
            .attr(&quot;cy&quot;, function(d) { return y(d.y); })
            .attr(&quot;r&quot;, 4.5);
    });
}

function renderAxes(svg){            
    var xAxis = d3.axisBottom()
            .scale(d3.scaleLinear().range([0, quadrantWidth()]));            

    var yAxis = d3.axisLeft()
            .scale(d3.scaleLinear().range([quadrantHeight(), 0]));

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() + &quot;,&quot; + yStart() + &quot;)&quot;;
        })
        .call(xAxis);

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() + &quot;,&quot; + yEnd() + &quot;)&quot;;
        })
        .call(yAxis);
}

function xStart(){
    return margin;
}        

function yStart(){
    return height - margin;
}

function xEnd(){
    return width - margin;
}

function yEnd(){
    return margin;
}

function quadrantWidth(){
    return width - 2 * margin;
}

function quadrantHeight(){
    return height - 2 * margin;
}
</code></pre><p>#####更改线条张力</p><p>只有d3.curveCardinal, d3.curveCardinalOpen, d3.curveCardinalClosed可以设置张力</p><pre><code>var width = 500,
    height = 500,
    margin = 30,
    duration = 500,    
    x = d3.scaleLinear()
        .domain([0, 10])
        .range([margin, width - margin]),
    y = d3.scaleLinear()
        .domain([0, 1])
        .range([height - margin, margin]);

var data = d3.range(10).map(function(i){
        return {x: i, y: (Math.sin(i * 3) + 1) / 2};
    });

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;);

svg.attr(&quot;height&quot;, height)
    .attr(&quot;width&quot;, width);

renderAxes(svg);

render([1]);    

function render(tension){
    var line = d3.line()
            .curve(d3.curveCardinal.tension(tension[0]))
            .x(function(d){return x(d.x);})
            .y(function(d){return y(d.y);});

    svg.selectAll(&quot;path.line&quot;)
            .data(tension)
        .enter()
            .append(&quot;path&quot;)
            .attr(&quot;class&quot;, &quot;line&quot;);            

    svg.selectAll(&quot;path.line&quot;)
            .data(tension)                
        .transition().duration(duration).ease(d3.easeLinear)
        .attr(&quot;d&quot;, function(d){
                // attention : line接受数组
            return line(data);
        });

    svg.selectAll(&quot;circle&quot;)
        .data(data)
      .enter().append(&quot;circle&quot;)
        .attr(&quot;class&quot;, &quot;dot&quot;)
        .attr(&quot;cx&quot;, function(d) { return x(d.x); })
        .attr(&quot;cy&quot;, function(d) { return y(d.y); })
        .attr(&quot;r&quot;, 4.5);
}
window.render = render;

function renderAxes(svg){            
    var xAxis = d3.axisBottom()                
            .scale(d3.scaleLinear().domain([0, 10]).range([0, quadrantWidth()]));            

    var yAxis = d3.axisLeft()
            .scale(d3.scaleLinear().domain([0,1]).range([quadrantHeight(), 0]));

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() + &quot;,&quot; + yStart() + &quot;)&quot;;
        })
        .call(xAxis);

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() + &quot;,&quot; + yEnd() + &quot;)&quot;;
        })
        .call(yAxis);
}

function xStart(){
    return margin;
}        

function yStart(){
    return height - margin;
}

function xEnd(){
    return width - margin;
}

function yEnd(){
    return margin;
}

function quadrantWidth(){
    return width - 2 * margin;
}

function quadrantHeight(){
    return height - 2 * margin;
}
</code></pre><p>#####区域生成器</p><pre><code>    var width = 500,
    height = 500,
    margin = 30,
    duration = 500,
    x = d3.scaleLinear()
        .domain([0, 10])
        .range([margin, width - margin]),
    y = d3.scaleLinear()
        .domain([0, 10])
        .range([height - margin, margin]);

var data = d3.range(11).map(function(i){
        return {x: i, y: Math.sin(i)*3 + 5};
    });

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;);

svg.attr(&quot;height&quot;, height)
    .attr(&quot;width&quot;, width);        

renderAxes(svg);

render();    

renderDots(svg);

function render(){
    var line = d3.line()
            .x(function(d){return x(d.x);})
            .y(function(d){return y(d.y);});

    svg.selectAll(&quot;path.line&quot;)
            .data([data])
        .enter()
            .append(&quot;path&quot;)
            .attr(&quot;class&quot;, &quot;line&quot;);                

    svg.selectAll(&quot;path.line&quot;)
            .data([data])       
        .attr(&quot;d&quot;, function(d){return line(d);});        

    var area = d3.area() 
        .x(function(d) { return x(d.x); }) 
        .y0(y(0)) 
        .y1(function(d) { return y(d.y); }); 

    svg.selectAll(&quot;path.area&quot;) 
            .data([data])
        .enter()
            .append(&quot;path&quot;)
            .attr(&quot;class&quot;, &quot;area&quot;)
            .attr(&quot;d&quot;, function(d){return area(d);}); 
}

function renderDots(svg){        
     svg.append(&quot;g&quot;).selectAll(&quot;circle&quot;)
        .data(data)
      .enter().append(&quot;circle&quot;)
        .attr(&quot;class&quot;, &quot;dot&quot;)
        .attr(&quot;cx&quot;, function(d) { return x(d.x); })
        .attr(&quot;cy&quot;, function(d) { return y(d.y); })
        .attr(&quot;r&quot;, 4.5);
}

function renderAxes(svg){            
    var xAxis = d3.axisBottom()
            .scale(d3.scaleLinear().range([0, quadrantWidth()]));            

    var yAxis = d3.axisLeft()
            .scale(d3.scaleLinear().range([quadrantHeight(), 0]));

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() + &quot;,&quot; + yStart() + &quot;)&quot;;
        })
        .call(xAxis);

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() + &quot;,&quot; + yEnd() + &quot;)&quot;;
        })
        .call(yAxis);
}

function xStart(){
    return margin;
}        

function yStart(){
    return height - margin;
}

function xEnd(){
    return width - margin;
}

function yEnd(){
    return margin;
}

function quadrantWidth(){
    return width - 2 * margin;
}

function quadrantHeight(){
    return height - 2 * margin;
}
</code></pre><p>#####区域插值</p><pre><code>&lt;h4&gt;Interpolation Mode:&lt;/h4&gt;
&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;render(d3.curveLinear)&quot;&gt;d3.curveLinear&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveLinearClosed)&quot;&gt;d3.curveLinearClosed&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveStepBefore)&quot;&gt;d3.curveStepBefore&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveStepAfter)&quot;&gt;d3.curveStepAfter&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveBasis)&quot;&gt;d3.curveBasis&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveBasisOpen)&quot;&gt;d3.curveBasisOpen&lt;/button&gt;
&lt;/div&gt;
&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;render(d3.curveBasisClosed)&quot;&gt;d3.curveBasisClosed&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveCardinal)&quot;&gt;d3.curveCardinal&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveCardinalOpen)&quot;&gt;d3.curveCardinalOpen&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveCardinalClosed)&quot;&gt;d3.curveCardinalClosed&lt;/button&gt;
    &lt;button onclick=&quot;render(d3.curveMonotoneX)&quot;&gt;d3.curveMonotoneX&lt;/button&gt;    
&lt;/div&gt;
var width = 500,
    height = 500,
    margin = 30,
    x = d3.scaleLinear()
        .domain([0, 10])
        .range([margin, width - margin]),
    y = d3.scaleLinear()
        .domain([0, 10])
        .range([height - margin, margin]);

var data = d3.range(11).map(function(i){
    return {x: i, y: Math.sin(i)*3 + 5};
});

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;);

svg.attr(&quot;height&quot;, height)
    .attr(&quot;width&quot;, width);        

renderAxes(svg);

render(d3.curveLinear);    

renderDots(svg);

function render(mode){
    var line = d3.line()
            .curve(mode)
            .x(function(d){return x(d.x);})
            .y(function(d){return y(d.y);});

    svg.selectAll(&quot;path.line&quot;)
            .data([data])
        .enter()
            .append(&quot;path&quot;)
            .attr(&quot;class&quot;, &quot;line&quot;);                

    svg.selectAll(&quot;path.line&quot;)
            .data([data])       
        .attr(&quot;d&quot;, function(d){return line(d);});        

    var area = d3.area()
        .curve(mode) 
        .x(function(d) { return x(d.x); })
        .y0(y(0))
        .y1(function(d) { return y(d.y); });

    svg.selectAll(&quot;path.area&quot;)
            .data([data])
        .enter()
            .append(&quot;path&quot;)
            .attr(&quot;class&quot;, &quot;area&quot;)

    svg.selectAll(&quot;path.area&quot;)
        .data([data])
        .attr(&quot;d&quot;, function(d){return area(d);});        
}
window.render = render;
window.d3 = d3;

function renderDots(svg){        
     svg.append(&quot;g&quot;).selectAll(&quot;circle&quot;)
        .data(data)
      .enter().append(&quot;circle&quot;)
        .attr(&quot;class&quot;, &quot;dot&quot;)
        .attr(&quot;cx&quot;, function(d) { return x(d.x); })
        .attr(&quot;cy&quot;, function(d) { return y(d.y); })
        .attr(&quot;r&quot;, 4.5);
}

function renderAxes(svg){            
    var xAxis = d3.axisBottom()
            .scale(d3.scaleLinear().range([0, quadrantWidth()]));            

    var yAxis = d3.axisLeft()
            .scale(d3.scaleLinear().range([quadrantHeight(), 0]));

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() + &quot;,&quot; + yStart() + &quot;)&quot;;
        })
        .call(xAxis);

    svg.append(&quot;g&quot;)        
        .attr(&quot;class&quot;, &quot;axis&quot;)
        .attr(&quot;transform&quot;, function(){
            return &quot;translate(&quot; + xStart() + &quot;,&quot; + yEnd() + &quot;)&quot;;
        })
        .call(yAxis);
}

function xStart(){
    return margin;
}        

function yStart(){
    return height - margin;
}

function xEnd(){
    return width - margin;
}

function yEnd(){
    return margin;
}

function quadrantWidth(){
    return width - 2 * margin;
}

function quadrantHeight(){
    return height - 2 * margin;
}
</code></pre><p>#####圆弧生成器</p><pre><code>&lt;div class=&quot;control-group&quot;&gt;
    &lt;button onclick=&quot;render(0)&quot;&gt;Circle&lt;/button&gt;
    &lt;button onclick=&quot;render(100)&quot;&gt;Annulus(Donut)&lt;/button&gt;
    &lt;button onclick=&quot;render(0, Math.PI)&quot;&gt;Circular Sector&lt;/button&gt;
    &lt;button onclick=&quot;render(100, Math.PI)&quot;&gt;Annulus Sector&lt;/button&gt;
&lt;/div&gt;
var width = 400,
    height = 400,
    fullAngle = 2 * Math.PI, 
    colors = d3.scaleLinear().domain([0,9]).range([&quot;pink&quot;,&quot;blue&quot;]);

    var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
                .attr(&quot;class&quot;, &quot;pie&quot;)
                .attr(&quot;height&quot;, height)
                .attr(&quot;width&quot;, width);    

    function render(innerRadius, endAngle){
        if(!endAngle) endAngle = fullAngle;

        var data = [ 
            {startAngle: 0, endAngle: 0.1 * endAngle},
            {startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle},
            {startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle},
            {startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle},        
            {startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle},        
            {startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle},        
            {startAngle: 0.9 * endAngle, endAngle: endAngle}
        ];

        var arc = d3.arc().outerRadius(200) 
                        .innerRadius(innerRadius);

        svg.select(&quot;g&quot;).remove();

        svg.append(&quot;g&quot;)
                .attr(&quot;transform&quot;, &quot;translate(200,200)&quot;)
        .selectAll(&quot;path.arc&quot;)
                .data(data)
            .enter()
                .append(&quot;path&quot;)
                    .attr(&quot;class&quot;, &quot;arc&quot;)
                    .attr(&quot;fill&quot;, function(d, i){return colors(i);})
                    .attr(&quot;d&quot;, function(d, i){
                        return arc(d, i); 
                    });
    }
    window.render = render;

    render(0);
</code></pre><p>#####圆弧过渡器</p><pre><code>        var width = 400,
        height = 400,
        endAngle = 2 * Math.PI,
        colors = d3.scaleLinear().domain([0,9]).range([&quot;pink&quot;,&quot;blue&quot;]);

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
        .attr(&quot;class&quot;, &quot;pie&quot;)
        .attr(&quot;height&quot;, height)
        .attr(&quot;width&quot;, width);

function render(innerRadius) {

    var data = [
        {startAngle: 0, endAngle: 0.1 * endAngle},
        {startAngle: 0.1 * endAngle, endAngle: 0.2 * endAngle},
        {startAngle: 0.2 * endAngle, endAngle: 0.4 * endAngle},
        {startAngle: 0.4 * endAngle, endAngle: 0.6 * endAngle},
        {startAngle: 0.6 * endAngle, endAngle: 0.7 * endAngle},
        {startAngle: 0.7 * endAngle, endAngle: 0.9 * endAngle},
        {startAngle: 0.9 * endAngle, endAngle: endAngle}
    ];

    var arc = d3.arc().outerRadius(200).innerRadius(innerRadius);

    svg.select(&quot;g&quot;).remove();

    svg.append(&quot;g&quot;)
        .attr(&quot;transform&quot;, &quot;translate(200,200)&quot;)
        .selectAll(&quot;path.arc&quot;)
            .data(data)
        .enter()
            .append(&quot;path&quot;)
            .attr(&quot;class&quot;, &quot;arc&quot;)
            .attr(&quot;fill&quot;, function (d, i) {
                return colors(i);
            })
            .transition().duration(2000)
            .attrTween(&quot;d&quot;, function (d) { 
                var start = {startAngle: 0, endAngle: 0}; 
                var interpolate = d3.interpolate(start, d); 
                return function (t) {
                    return arc(interpolate(t)); 
                };
            });
}

render(100);
</code></pre><p>#####线图</p><pre><code>function lineChart() { 
        var _chart = {};

        var _width = 600, _height = 300, 
                _margins = {top: 30, left: 30, right: 30, bottom: 30},
                _x, _y,
                _data = [],
                _colors = d3.scaleLinear().domain([0,9]).range([&quot;pink&quot;,&quot;blue&quot;]),
                _svg,
                _bodyG,
                _line;

        _chart.render = function () { 
            if (!_svg) {
                _svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;) 
                        .attr(&quot;height&quot;, _height)
                        .attr(&quot;width&quot;, _width);

                renderAxes(_svg);

                defineBodyClip(_svg);
            }

            renderBody(_svg);
        };

        function renderAxes(svg) {
            var axesG = svg.append(&quot;g&quot;)
                    .attr(&quot;class&quot;, &quot;axes&quot;);

            renderXAxis(axesG);

            renderYAxis(axesG);
        }

        function renderXAxis(axesG){
            var xAxis = d3.axisBottom()
                    .scale(_x.range([0, quadrantWidth()]));        

            axesG.append(&quot;g&quot;)
                    .attr(&quot;class&quot;, &quot;x axis&quot;)
                    .attr(&quot;transform&quot;, function () {
                        return &quot;translate(&quot; + xStart() + &quot;,&quot; + yStart() + &quot;)&quot;;
                    })
                    .call(xAxis);

            d3.selectAll(&quot;g.x g.tick&quot;)
                .append(&quot;line&quot;)
                    .classed(&quot;grid-line&quot;, true)
                    .attr(&quot;x1&quot;, 0)
                    .attr(&quot;y1&quot;, 0)
                    .attr(&quot;x2&quot;, 0)
                    .attr(&quot;y2&quot;, - quadrantHeight());
        }

        function renderYAxis(axesG){
            var yAxis = d3.axisLeft()
                    .scale(_y.range([quadrantHeight(), 0]));

            axesG.append(&quot;g&quot;)
                    .attr(&quot;class&quot;, &quot;y axis&quot;)
                    .attr(&quot;transform&quot;, function () {
                        return &quot;translate(&quot; + xStart() + &quot;,&quot; + yEnd() + &quot;)&quot;;
                    })
                    .call(yAxis);

             d3.selectAll(&quot;g.y g.tick&quot;)
                .append(&quot;line&quot;)
                    .classed(&quot;grid-line&quot;, true)
                    .attr(&quot;x1&quot;, 0)
                    .attr(&quot;y1&quot;, 0)
                    .attr(&quot;x2&quot;, quadrantWidth())
                    .attr(&quot;y2&quot;, 0);
        }

        function defineBodyClip(svg) { 
            var padding = 5;

            svg.append(&quot;defs&quot;)
                    .append(&quot;clipPath&quot;)
                    .attr(&quot;id&quot;, &quot;body-clip&quot;)
                    .append(&quot;rect&quot;)
                    .attr(&quot;x&quot;, 0 - padding)
                    .attr(&quot;y&quot;, 0)
                    .attr(&quot;width&quot;, quadrantWidth() + 2 * padding)
                    .attr(&quot;height&quot;, quadrantHeight());
        }

        function renderBody(svg) { 
            if (!_bodyG)
                _bodyG = svg.append(&quot;g&quot;)
                        .attr(&quot;class&quot;, &quot;body&quot;)
                        .attr(&quot;transform&quot;, &quot;translate(&quot; 
                            + xStart() + &quot;,&quot; 
                            + yEnd() + &quot;)&quot;) 
                        .attr(&quot;clip-path&quot;, &quot;url(#body-clip)&quot;);        

            renderLines();

            renderDots();
        }

        function renderLines() {
            _line = d3.line() 
                  .x(function (d) { return _x(d.x); })
                  .y(function (d) { return _y(d.y); });

            _bodyG.selectAll(&quot;path.line&quot;)
                        .data(_data)
                    .enter() 
                    .append(&quot;path&quot;)                
                    .style(&quot;stroke&quot;, function (d, i) { 
                        return _colors(i); 
                    })
                    .attr(&quot;class&quot;, &quot;line&quot;);

            _bodyG.selectAll(&quot;path.line&quot;)
                    .data(_data)
                    .transition() 
                    .attr(&quot;d&quot;, function (d) { return _line(d); });
        }

        function renderDots() {
            _data.forEach(function (list, i) {
                _bodyG.selectAll(&quot;circle._&quot; + i) 
                            .data(list)
                        .enter()
                        .append(&quot;circle&quot;)
                        .attr(&quot;class&quot;, &quot;dot _&quot; + i);

                _bodyG.selectAll(&quot;circle._&quot; + i)
                        .data(list)                    
                        .style(&quot;stroke&quot;, function (d) { 
                            return _colors(i); 
                        })
                        .transition() 
                        .attr(&quot;cx&quot;, function (d) { return _x(d.x); })
                        .attr(&quot;cy&quot;, function (d) { return _y(d.y); })
                        .attr(&quot;r&quot;, 4.5);
            });
        }

        function xStart() {
            return _margins.left;
        }

        function yStart() {
            return _height - _margins.bottom;
        }

        function xEnd() {
            return _width - _margins.right;
        }

        function yEnd() {
            return _margins.top;
        }

        function quadrantWidth() {
            return _width - _margins.left - _margins.right;
        }

        function quadrantHeight() {
            return _height - _margins.top - _margins.bottom;
        }

        _chart.width = function (w) {
            if (!arguments.length) return _width;
            _width = w;
            return _chart;
        };

        _chart.height = function (h) { 
            if (!arguments.length) return _height;
            _height = h;
            return _chart;
        };

        _chart.margins = function (m) {
            if (!arguments.length) return _margins;
            _margins = m;
            return _chart;
        };

        _chart.colors = function (c) {
            if (!arguments.length) return _colors;
            _colors = c;
            return _chart;
        };

        _chart.x = function (x) {
            if (!arguments.length) return _x;
            _x = x;
            return _chart;
        };

        _chart.y = function (y) {
            if (!arguments.length) return _y;
            _y = y;
            return _chart;
        };

        _chart.addSeries = function (series) { 
            _data.push(series);
            return _chart;
        };

        return _chart; 
    }

    function randomData() {
        return Math.random() * 9;
    }

    function update() {
        for (var i = 0; i &lt; data.length; ++i) {
            var series = data[i];
            series.length = 0;
            for (var j = 0; j &lt; numberOfDataPoint; ++j)
                series.push({x: j, y: randomData()});
        }

        chart.render();
    }
    window.update = update;

    var numberOfSeries = 2,
        numberOfDataPoint = 11,
        data = [];

    for (var i = 0; i &lt; numberOfSeries; ++i)
        data.push(d3.range(numberOfDataPoint).map(function (i) {
            return {x: i, y: randomData()};
        }));

    var chart = lineChart()
            .x(d3.scaleLinear().domain([0, 10]))
            .y(d3.scaleLinear().domain([0, 10]));

    data.forEach(function (series) {
        chart.addSeries(series);
    });

    chart.render();
</code></pre><p>#####面积图</p><pre><code>function renderAreas() {
            var area = d3.area()
                                     .x(function(d){ return _x(d.x)})
                                     .y0(yStart())
                                     .y1(function(d){ return _y(d.y)});
            _bodyG.selectAll(&quot;path.area&quot;)
                        .data(_data)
                        .enter()
                            .append(&quot;path&quot;)
                            .style(&quot;fill&quot;,function(d,i){
                                return _colors(i);
                            })
                            .attr(&quot;class&quot;,&quot;area&quot;);

            _bodyG.selectAll(&quot;path.area&quot;)
                        .data(_data)
                        .transition()
                        .attr(&quot;d&quot;,function(d){
                            return area(d);
                        });
        }
</code></pre><p>#####散点图</p><pre><code>function renderSymbols() { 
    _data.forEach(function (list, i) {
        _bodyG.selectAll(&quot;path._&quot; + i)
                    .data(list)
                .enter()
                .append(&quot;path&quot;)
                .attr(&quot;class&quot;, &quot;symbol _&quot; + i);

        _bodyG.selectAll(&quot;path._&quot; + i)
                .data(list)
                    .classed(_symbolTypes(i), true)
                .transition() 
                    .attr(&quot;transform&quot;, function(d){
                        return &quot;translate(&quot; 
                                + _x(d.x) 
                                + &quot;,&quot; 
                                + _y(d.y) 
                                + &quot;)&quot;;
                    })
                    .attr(&quot;d&quot;, 
                        d3.symbol() 
                            .type(d3[_symbolTypes(i)])
                    ); 
    });
}
</code></pre><p>#####气泡图</p><pre><code>function renderBubbles() {
    _r.range([0,50]);

    _data.forEach(function(list,i){
        _bodyG.selectAll(&quot;circle._&quot;+i)
            .data(list)
            .enter()
                .append(&quot;circle&quot;)
                .attr(&quot;class&quot;,&quot;bubble _&quot;+i);

        _bodyG.selectAll(&quot;circle._&quot;+i)
            .data(list)
            .style(&quot;stroke&quot;,function(d,j) {
                return _colors(j);
            })
            .style(&quot;fill&quot;,function(d,j) {
                return _colors(j);
            })
            .transition()
            .attr(&quot;cx&quot;,function(d) {
                return _x(d.x);
            })
            .attr(&quot;cy&quot;,function(d) {
                return _y(d.y);
            })
            .attr(&quot;r&quot;,function(d) {
                return _r(d.r);
            })
    });
}
</code></pre><p>#####条形图</p><pre><code>function lineChart() { 
        var _chart = {};

        var _width = 600, _height = 300, 
                _margins = {top: 30, left: 30, right: 30, bottom: 30},
                _x, _y, _r,
                _data = [],
                _colors = d3.scaleLinear().domain([0,9]).range([&quot;pink&quot;,&quot;blue&quot;]),
                _svg,
                _bodyG,
                _line;

        var _symbolTypes = d3.scaleOrdinal()
                                                    .range([&quot;symbolCircle&quot;,&quot;symbolCross&quot;,&quot;symbolDiamond&quot;,&quot;symbolSquare&quot;,&quot;symbolStar&quot;,&quot;symbolTriangle&quot;,&quot;symbolWye&quot;]);

        _chart.render = function () { 
            if (!_svg) {
                _svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;) 
                        .attr(&quot;height&quot;, _height)
                        .attr(&quot;width&quot;, _width);

                renderAxes(_svg);

                defineBodyClip(_svg);
            }

            renderBody(_svg);
        };

        function renderAxes(svg) {
            var axesG = svg.append(&quot;g&quot;)
                    .attr(&quot;class&quot;, &quot;axes&quot;);

            renderXAxis(axesG);

            renderYAxis(axesG);
        }

        function renderXAxis(axesG){
            var xAxis = d3.axisBottom()
                    .scale(_x.range([0, quadrantWidth()]));        

            axesG.append(&quot;g&quot;)
                    .attr(&quot;class&quot;, &quot;x axis&quot;)
                    .attr(&quot;transform&quot;, function () {
                        return &quot;translate(&quot; + xStart() + &quot;,&quot; + yStart() + &quot;)&quot;;
                    })
                    .call(xAxis);

            d3.selectAll(&quot;g.x g.tick&quot;)
                .append(&quot;line&quot;)
                    .classed(&quot;grid-line&quot;, true)
                    .attr(&quot;x1&quot;, 0)
                    .attr(&quot;y1&quot;, 0)
                    .attr(&quot;x2&quot;, 0)
                    .attr(&quot;y2&quot;, - quadrantHeight());
        }

        function renderYAxis(axesG){
            var yAxis = d3.axisLeft()
                    .scale(_y.range([quadrantHeight(), 0]));

            axesG.append(&quot;g&quot;)
                    .attr(&quot;class&quot;, &quot;y axis&quot;)
                    .attr(&quot;transform&quot;, function () {
                        return &quot;translate(&quot; + xStart() + &quot;,&quot; + yEnd() + &quot;)&quot;;
                    })
                    .call(yAxis);

             d3.selectAll(&quot;g.y g.tick&quot;)
                .append(&quot;line&quot;)
                    .classed(&quot;grid-line&quot;, true)
                    .attr(&quot;x1&quot;, 0)
                    .attr(&quot;y1&quot;, 0)
                    .attr(&quot;x2&quot;, quadrantWidth())
                    .attr(&quot;y2&quot;, 0);
        }

        function defineBodyClip(svg) { 
            var padding = 5;

            svg.append(&quot;defs&quot;)
                    .append(&quot;clipPath&quot;)
                    .attr(&quot;id&quot;, &quot;body-clip&quot;)
                    .append(&quot;rect&quot;)
                    .attr(&quot;x&quot;, 0 - padding)
                    .attr(&quot;y&quot;, 0)
                    .attr(&quot;width&quot;, quadrantWidth() + 2 * padding)
                    .attr(&quot;height&quot;, quadrantHeight());
        }

        function renderBody(svg) { 
            if (!_bodyG)
                _bodyG = svg.append(&quot;g&quot;)
                        .attr(&quot;class&quot;, &quot;body&quot;)
                        .attr(&quot;transform&quot;, &quot;translate(&quot; 
                            + xStart() + &quot;,&quot; 
                            + yEnd() + &quot;)&quot;) 
                        .attr(&quot;clip-path&quot;, &quot;url(#body-clip)&quot;);        

            // renderLines();

            // renderAreas();

            // renderDots();

            // renderSymbols();

            // renderBubbles();

            renderBars();
        }

        function renderLines() {
            _line = d3.line() 
                  .x(function (d) { return _x(d.x); })
                  .y(function (d) { return _y(d.y); });

            _bodyG.selectAll(&quot;path.line&quot;)
                        .data(_data)
                    .enter() 
                    .append(&quot;path&quot;)                
                    .style(&quot;stroke&quot;, function (d, i) { 
                        return _colors(i); 
                    })
                    .attr(&quot;class&quot;, &quot;line&quot;);

            _bodyG.selectAll(&quot;path.line&quot;)
                    .data(_data)
                    .transition() 
                    .attr(&quot;d&quot;, function (d) { return _line(d); });
        }

        function renderDots() {
            _data.forEach(function (list, i) {
                _bodyG.selectAll(&quot;circle._&quot; + i) 
                            .data(list)
                        .enter()
                        .append(&quot;circle&quot;)
                        .attr(&quot;class&quot;, &quot;dot _&quot; + i);

                _bodyG.selectAll(&quot;circle._&quot; + i)
                        .data(list)                    
                        .style(&quot;stroke&quot;, function (d) { 
                            return _colors(i); 
                        })
                        .transition() 
                        .attr(&quot;cx&quot;, function (d) { return _x(d.x); })
                        .attr(&quot;cy&quot;, function (d) { return _y(d.y); })
                        .attr(&quot;r&quot;, 4.5);
            });
        }

        function renderAreas() {
            var area = d3.area()
                                     .x(function(d){ return _x(d.x)})
                                     .y0(yStart())
                                     .y1(function(d){ return _y(d.y)});
            _bodyG.selectAll(&quot;path.area&quot;)
                        .data(_data)
                        .enter()
                            .append(&quot;path&quot;)
                            .style(&quot;fill&quot;,function(d,i){
                                return _colors(i);
                            })
                            .attr(&quot;class&quot;,&quot;area&quot;);

            _bodyG.selectAll(&quot;path.area&quot;)
                        .data(_data)
                        .transition()
                        .attr(&quot;d&quot;,function(d){
                            return area(d);
                        });
        }

        function renderSymbols() { 
            _data.forEach(function (list, i) {
                _bodyG.selectAll(&quot;path._&quot; + i)
                            .data(list)
                        .enter()
                        .append(&quot;path&quot;)
                        .attr(&quot;class&quot;, &quot;symbol _&quot; + i);

                _bodyG.selectAll(&quot;path._&quot; + i)
                        .data(list)
                            .classed(_symbolTypes(i), true)
                        .transition() 
                            .attr(&quot;transform&quot;, function(d){
                                return &quot;translate(&quot; 
                                        + _x(d.x) 
                                        + &quot;,&quot; 
                                        + _y(d.y) 
                                        + &quot;)&quot;;
                            })
                            .attr(&quot;d&quot;, 
                                d3.symbol() 
                                    .type(d3[_symbolTypes(i)])
                            ); 
            });
        }

        function renderBubbles() {
            _r.range([0,50]);

            _data.forEach(function(list,i){
                _bodyG.selectAll(&quot;circle._&quot;+i)
                    .data(list)
                    .enter()
                        .append(&quot;circle&quot;)
                        .attr(&quot;class&quot;,&quot;bubble _&quot;+i);

                _bodyG.selectAll(&quot;circle._&quot;+i)
                    .data(list)
                    .style(&quot;stroke&quot;,function(d,j) {
                        return _colors(j);
                    })
                    .style(&quot;fill&quot;,function(d,j) {
                        return _colors(j);
                    })
                    .transition()
                    .attr(&quot;cx&quot;,function(d) {
                        return _x(d.x);
                    })
                    .attr(&quot;cy&quot;,function(d) {
                        return _y(d.y);
                    })
                    .attr(&quot;r&quot;,function(d) {
                        return _r(d.r);
                    })
            });
        }

        function renderBars() {
            var padding = 2;

            _bodyG.selectAll(&quot;rect.bar&quot;)
                .data(_data)
                .enter()
                    .append(&quot;rect&quot;)
                    .attr(&quot;class&quot;,&quot;bar&quot;);

            _bodyG.selectAll(&quot;rect.bar&quot;)
                .data(_data)
                .transition()
                .attr(&quot;x&quot;,function(d){
                    return _x(d.x);
                })
                .attr(&quot;y&quot;,function(d){
                    return _y(d.y);
                })
                .attr(&quot;height&quot;,function(d){
                    return yStart() - _y(d.y);
                })
                .attr(&quot;width&quot;,function(d){
                    return Math.floor(quadrantWidth() / _data.length) - padding;
                });
        }

        function xStart() {
            return _margins.left;
        }

        function yStart() {
            return _height - _margins.bottom;
        }

        function xEnd() {
            return _width - _margins.right;
        }

        function yEnd() {
            return _margins.top;
        }

        function quadrantWidth() {
            return _width - _margins.left - _margins.right;
        }

        function quadrantHeight() {
            return _height - _margins.top - _margins.bottom;
        }

        _chart.width = function (w) {
            if (!arguments.length) return _width;
            _width = w;
            return _chart;
        };

        _chart.height = function (h) { 
            if (!arguments.length) return _height;
            _height = h;
            return _chart;
        };

        _chart.margins = function (m) {
            if (!arguments.length) return _margins;
            _margins = m;
            return _chart;
        };

        _chart.colors = function (c) {
            if (!arguments.length) return _colors;
            _colors = c;
            return _chart;
        };

        _chart.x = function (x) {
            if (!arguments.length) return _x;
            _x = x;
            return _chart;
        };

        _chart.y = function (y) {
            if (!arguments.length) return _y;
            _y = y;
            return _chart;
        };

        _chart.r = function (r) {
            if (!arguments.length) return _r;
            _r = r;
            return _chart;
        };

        _chart.addSeries = function (series) { 
            _data.push(series);
            return _chart;
        };

        _chart.setSeries = function (series) {
            _data = series;
            return _chart;
        };

        return _chart; 
    }

    function randomData() {
        return Math.random() * 9;
    }

    // function update() {
    //     for (var i = 0; i &lt; data.length; ++i) {
    //         var series = data[i];
    //         series.length = 0;
    //         for (var j = 0; j &lt; numberOfDataPoint; ++j)
    //             series.push({x: j, y: randomData() , r:randomData()});
    //     }

    //     chart.render();
    // }
    function update() {
            data.length = 0;
    for (var j = 0; j &lt; numberOfDataPoint; ++j)
        data.push({x: j, y: randomData()});
        chart.render();
    }
    window.update = update;

    var numberOfSeries = 2,
        numberOfDataPoint = 31,
        data = [];

    // for (var i = 0; i &lt; numberOfSeries; ++i)
    //     data.push(d3.range(numberOfDataPoint).map(function (i) {
    //         return {x: i, y: randomData() , r:randomData()};
    //     }));
    data = d3.range(numberOfDataPoint).map(function(i) {
        return {x: i , y :randomData()};
    });

    var chart = lineChart()
            .x(d3.scaleLinear().domain([0, 33]))
            .y(d3.scaleLinear().domain([0, 10]))
            .r(d3.scalePow().exponent(2).domain([0, 10]));

    // data.forEach(function (series) {
    //     chart.addSeries(series);
    // });
    chart.setSeries(data);

    chart.render();
</code></pre><p>#####饼图</p><pre><code>function pieChart() {
    var _chart = {};

    var _width = 500, _height = 500,
            _data = [],
            _colors = d3.scaleLinear().domain([0,9]).range([&quot;pink&quot;,&quot;blue&quot;]),
            _svg,
            _bodyG,
            _pieG,
            _radius = 200,
            _innerRadius = 100;

    _chart.render = function () {
        if (!_svg) {
            _svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
                    .attr(&quot;height&quot;, _height)
                    .attr(&quot;width&quot;, _width);
        }

        renderBody(_svg);
    };

    function renderBody(svg) {
        if (!_bodyG)
            _bodyG = svg.append(&quot;g&quot;)
                    .attr(&quot;class&quot;, &quot;body&quot;);

        renderPie();
    }

    function renderPie() {
        var pie = d3.pie() 
                .sort(function (d) {
                    return d.id;
                })
                .value(function (d) {
                    return d.value;
                });

        var arc = d3.arc()
                .outerRadius(_radius)
                .innerRadius(_innerRadius);

        if (!_pieG)
            _pieG = _bodyG.append(&quot;g&quot;)
                    .attr(&quot;class&quot;, &quot;pie&quot;)
                    .attr(&quot;transform&quot;, &quot;translate(&quot; 
                        + _radius 
                        + &quot;,&quot; 
                        + _radius + &quot;)&quot;);

        renderSlices(pie, arc);

        renderLabels(pie, arc);
    }

    function renderSlices(pie, arc) {
        var slices = _pieG.selectAll(&quot;path.arc&quot;)
                .data(pie(_data)); 

        slices.enter()
                .append(&quot;path&quot;)
                .attr(&quot;class&quot;, &quot;arc&quot;)
                .attr(&quot;fill&quot;, function (d, i) {
                    return _colors(i);
                });

        slices.transition()
                .attrTween(&quot;d&quot;, function (d) {
                    var currentArc = this.__current__; 

                    if (!currentArc)
                        currentArc = {startAngle: 0, 
                                        endAngle: 0};

                    var interpolate = d3.interpolate(
                                        currentArc, d);

                    this.__current__ = interpolate(1);

                    return function (t) {
                        return arc(interpolate(t));
                    };
                });
    }

    function renderLabels(pie, arc) {
        var labels = _pieG.selectAll(&quot;text.label&quot;)
                .data(pie(_data)); 

        labels.enter()
                .append(&quot;text&quot;)
                .attr(&quot;class&quot;, &quot;label&quot;);

        labels.transition()
                .attr(&quot;transform&quot;, function (d) {
                    return &quot;translate(&quot; 
                        + arc.centroid(d) + &quot;)&quot;; 
                })
                .attr(&quot;dy&quot;, &quot;.35em&quot;)
                .attr(&quot;text-anchor&quot;, &quot;middle&quot;)
                .text(function (d) {
                    return d.data.id;
                });
    }

    _chart.width = function (w) {
        if (!arguments.length) return _width;
        _width = w;
        return _chart;
    };

    _chart.height = function (h) {
        if (!arguments.length) return _height;
        _height = h;
        return _chart;
    };

    _chart.colors = function (c) {
        if (!arguments.length) return _colors;
        _colors = c;
        return _chart;
    };

    _chart.radius = function (r) {
        if (!arguments.length) return _radius;
        _radius = r;
        return _chart;
    };

    _chart.innerRadius = function (r) {
        if (!arguments.length) return _innerRadius;
        _innerRadius = r;
        return _chart;
    };

    _chart.data = function (d) {
        if (!arguments.length) return _data;
        _data = d;
        return _chart;
    };

    return _chart;
}

function randomData() {
    return Math.random() * 9 + 1;
}

function update() {
    for (var j = 0; j &lt; data.length; ++j)
        data[j].value = randomData();

    chart.render();
}
window.update = update;

var numberOfDataPoint = 6,
        data = [];

data = d3.range(numberOfDataPoint).map(function (i) {
    return {id: i, value: randomData()};
});

var chart = pieChart()
        .radius(200)
        .innerRadius(100)
        .data(data);

chart.render();
</code></pre><p>#####堆叠面积图</p><p>#####矩形式树状结构图</p><p>#####鼠标事件</p><pre><code>var r = 400;

var svg = d3.select(&quot;body&quot;)
        .append(&quot;svg&quot;);

var positionLabel = svg.append(&quot;text&quot;)
        .attr(&quot;x&quot;, 10)
        .attr(&quot;y&quot;, 30);

svg.on(&quot;mousemove&quot;, function () {
    printPosition();
});

function printPosition() { 
    var position = d3.mouse(svg.node()); 
    positionLabel.text(position);
}  

svg.on(&quot;click&quot;, function () { 
    for (var i = 1; i &lt; 5; ++i) {
        var position = d3.mouse(svg.node());

        var circle = svg.append(&quot;circle&quot;)
                .attr(&quot;cx&quot;, position[0])
                .attr(&quot;cy&quot;, position[1])
                .attr(&quot;r&quot;, 0)
                .style(&quot;stroke-width&quot;, 5 / (i))
                .transition()
                    .delay(Math.pow(i, 2.5) * 50)
                    .duration(2000)
                    .ease(d3.easeQuadIn)
                .attr(&quot;r&quot;, r)
                .style(&quot;stroke-opacity&quot;, 0)
                .on(&quot;end&quot;, function () {
                    d3.select(this).remove();
                });
    }
});
</code></pre><p>#####多点触摸设备交互</p><pre><code>var initR = 100, 
    r = 400, 
    thickness = 20;

var svg = d3.select(&quot;body&quot;)
        .append(&quot;svg&quot;);

d3.select(&quot;body&quot;)
        .on(&quot;touchstart&quot;, touch)
        .on(&quot;touchend&quot;, touch);

function touch() {
    d3.event.preventDefault();

    var arc = d3.arc()
            .outerRadius(initR)
            .innerRadius(initR - thickness);

    var g = svg.selectAll(&quot;g.touch&quot;)
            .data(d3.touches(svg.node()));

    g.enter()
        .append(&quot;g&quot;)
        .attr(&quot;class&quot;, &quot;touch&quot;)
        .attr(&quot;transform&quot;, function (d) {
            return &quot;translate(&quot; + d[0] + &quot;,&quot; + d[1] + &quot;)&quot;;
        })
        .append(&quot;path&quot;)
            .attr(&quot;class&quot;, &quot;arc&quot;)
            .transition().duration(2000).ease(d3.easeLinear)
            .attrTween(&quot;d&quot;, function (d) {
                var interpolate = d3.interpolate(
                        {startAngle: 0, endAngle: 0},
                        {startAngle: 0, endAngle: 2 * Math.PI}
                    );
                return function (t) {
                    return arc(interpolate(t));
                };
            })
            .on(&quot;end&quot;, function (d) {
                if (complete(d))
                    ripples(d);
                g.remove();
            });

    g.exit().remove().each(function (d) {
        d.__stopped__ = true;
    });
}

function complete(d) {
    return d.__stopped__ != true;
}

function ripples(position) {
    for (var i = 1; i &lt; 5; ++i) {
        var circle = svg.append(&quot;circle&quot;)
                .attr(&quot;cx&quot;, position[0])
                .attr(&quot;cy&quot;, position[1])
                .attr(&quot;r&quot;, initR - (thickness / 2))
                .style(&quot;stroke-width&quot;, thickness / (i))
            .transition()
                .delay(Math.pow(i, 2.5) * 50)
                .duration(2000).ease(d3.easeQuadIn)
                .attr(&quot;r&quot;, r)
                .style(&quot;stroke-opacity&quot;, 0)
                .on(&quot;end&quot;, function () {
                    d3.select(this).remove();
                });
    }
}
</code></pre><p>#####实现缩放和平移</p><pre><code>var width = 600, height = 350, r = 50;

var data = [
    [width / 2 - r, height / 2 - r],
    [width / 2 - r, height / 2 + r],
    [width / 2 + r, height / 2 - r],
    [width / 2 + r, height / 2 + r]
];

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
        .attr(&quot;style&quot;, &quot;1px solid black&quot;)
        .attr(&quot;width&quot;, width)
        .attr(&quot;height&quot;, height)
        .call( 
            d3.zoom() 
                .scaleExtent([1, 10]) 
                .on(&quot;zoom&quot;, zoom) 
        )
        .append(&quot;g&quot;);

svg.selectAll(&quot;circle&quot;)
        .data(data)
        .enter().append(&quot;circle&quot;)
        .attr(&quot;r&quot;, r)
        .attr(&quot;transform&quot;, function (d) {
            return &quot;translate(&quot; + d + &quot;)&quot;;
        });

function zoom() {
    svg.attr(&quot;transform&quot;, &quot;translate(&quot; 
        + d3.event.transform.x+&quot;,&quot;+d3.event.transform.y 
        + &quot;)scale(&quot; + d3.event.transform.k + &quot;)&quot;);
}
</code></pre><p>#####拖曳</p><pre><code>var width = 960, height = 500, r = 50;

var data = [
    [width / 2 - r, height / 2 - r],
    [width / 2 - r, height / 2 + r],
    [width / 2 + r, height / 2 - r],
    [width / 2 + r, height / 2 + r]
];

var svg = d3.select(&quot;body&quot;).append(&quot;svg&quot;)
        .attr(&quot;width&quot;, width)
        .attr(&quot;height&quot;, height)
        .append(&quot;g&quot;);

var drag = d3.drag() 
        .on(&quot;drag&quot;, move);

svg.selectAll(&quot;circle&quot;)
        .data(data)
        .enter().append(&quot;circle&quot;)
        .attr(&quot;r&quot;, r)
        .attr(&quot;transform&quot;, function (d) {
            return &quot;translate(&quot; + d + &quot;)&quot;;
        })
        .call(drag); 

function move(d) {
        console.log(d3.event)
    var x = d3.event.x, 
        y = d3.event.y;

    if(inBoundaries(x, y))
        d3.select(this) 
            .attr(&quot;transform&quot;, function (d) { 
                return &quot;translate(&quot; + x + &quot;, &quot; + y + &quot;)&quot;;
            });
}

function inBoundaries(x, y){
    return (x &gt;= (0 + r) &amp;&amp; x &lt;= (width - r)) 
        &amp;&amp; (y &gt;= (0 + r) &amp;&amp; y &lt;= (height - r));
}
</code></pre><p>#####使用引力和相互作用力</p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://molly2molly.github.io/2018/05/09/d3-js/" title="d3.js" target="_blank" rel="external">https://molly2molly.github.io/2018/05/09/d3-js/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/molly2molly" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/molly2molly" target="_blank"><span class="text-dark">张英姿</span><small class="ml-1x">前端工程师</small></a></h3><div>梦里寻他千百度 蓦然回首 那人却在灯火阑珊处</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom=""><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2018/05/10/D3.js阅读笔记/" title="D3.js阅读笔记"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a></li><li class="next"><a href="/2017/12/20/ES6-尾调用/" title="ES6 - 尾调用"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>Maybe you could buy me a cup of coffee.</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>!function(T){var n={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"};T.INSIGHT_CONFIG=n}(window)</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta="nick,mail,link";meta=meta.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({model:{jsonPath:"/null"},display:{position:"right",width:150,height:300},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html><!-- rebuild by neat -->