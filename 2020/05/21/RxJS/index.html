<!-- build time:Wed Jun 17 2020 14:21:57 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>Hexo</title><meta name="description" content="title: RxJSdate: 2020-05-21 16:42:08tags:RxJS指引在前端，我们通常有这么一些方式来处理异步的东西：回调事件PromiseGenerator其中，存在两种处理问题的方式，因为需求也是两种：分发流程在处理分发的需求的时候，回调、事件或者类似订阅发布这种模式是比较合适的；而在处理流程性质的需求时，Promise和Generator比较合适。RxJS的优势在于结"><meta property="og:type" content="article"><meta property="og:title" content="张英姿的博客"><meta property="og:url" content="https://molly2molly.github.io/2020/05/21/RxJS/index.html"><meta property="og:site_name" content="张英姿的博客"><meta property="og:description" content="title: RxJSdate: 2020-05-21 16:42:08tags:RxJS指引在前端，我们通常有这么一些方式来处理异步的东西：回调事件PromiseGenerator其中，存在两种处理问题的方式，因为需求也是两种：分发流程在处理分发的需求的时候，回调、事件或者类似订阅发布这种模式是比较合适的；而在处理流程性质的需求时，Promise和Generator比较合适。RxJS的优势在于结"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2020-06-03T08:38:48.909Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="张英姿的博客"><meta name="twitter:description" content="title: RxJSdate: 2020-05-21 16:42:08tags:RxJS指引在前端，我们通常有这么一些方式来处理异步的东西：回调事件PromiseGenerator其中，存在两种处理问题的方式，因为需求也是两种：分发流程在处理分发的需求的时候，回调、事件或者类似订阅发布这种模式是比较合适的；而在处理流程性质的需求时，Promise和Generator比较合适。RxJS的优势在于结"><link rel="canonical" href="https://molly2molly.github.io/2020/05/21/RxJS/index.html"><link rel="alternate" href="/atom.xml" title="张英姿的博客" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"></head><body class="main-center theme-green" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/molly2molly" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">张英姿</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">前端工程师</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> 苏州, 中国</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech=""> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">Categories</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">Tags</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">Repository</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">Books</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">Links</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">About</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Board</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">Categories</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/D3-js/">D3.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tags</h3><div class="widget-body"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6-javascript/">es6 javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tag Cloud</h3><div class="widget-body tagcloud"><a href="/tags/React/" style="font-size:13px">React</a> <a href="/tags/TCP/" style="font-size:13px">TCP</a> <a href="/tags/es6-javascript/" style="font-size:13px">es6 javascript</a> <a href="/tags/javascript/" style="font-size:14px">javascript</a> <a href="/tags/markdown/" style="font-size:13px">markdown</a> <a href="/tags/webpack/" style="font-size:13px">webpack</a> <a href="/tags/前端/" style="font-size:13px">前端</a></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2020/06/16/svg/" class="title">svg</a></p><p class="item-date"><time datetime="2020-06-16T02:20:11.000Z" itemprop="datePublished">2020-06-16</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2020/06/11/类与对象/" class="title">类与对象</a></p><p class="item-date"><time datetime="2020-06-11T06:08:23.000Z" itemprop="datePublished">2020-06-11</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2020/06/01/JS异步/" class="title">JS异步</a></p><p class="item-date"><time datetime="2020-06-01T02:38:57.000Z" itemprop="datePublished">2020-06-01</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2020/05/21/RxJS/" class="title">(no title)</a></p><p class="item-date"><time datetime="2020-05-21T08:42:08.997Z" itemprop="datePublished">2020-05-21</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2020/05/07/Decorators/" class="title">Decorators</a></p><p class="item-date"><time datetime="2020-05-07T05:54:48.000Z" itemprop="datePublished">2020-05-07</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-RxJS" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2020/05/21/RxJS/" class="article-date"><time datetime="2020-05-21T08:42:08.997Z" itemprop="datePublished">2020-05-21</time></a></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2020/05/21/RxJS/#comments" class="article-comment-link">Comments</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><hr><p>title: RxJS<br>date: 2020-05-21 16:42:08</p><h2 id="tags"><a href="#tags" class="headerlink" title="tags:  "></a>tags:</h2><h3 id="RxJS指引"><a href="#RxJS指引" class="headerlink" title="RxJS指引"></a>RxJS指引</h3><p>在前端，我们通常有这么一些方式来处理异步的东西：</p><ul><li>回调</li><li>事件</li><li>Promise</li><li>Generator</li></ul><p>其中，存在两种处理问题的方式，因为需求也是两种：</p><ul><li>分发</li><li>流程</li></ul><p>在处理分发的需求的时候，回调、事件或者类似订阅发布这种模式是比较合适的；<br>而在处理流程性质的需求时，Promise和Generator比较合适。</p><p>RxJS的优势在于结合了两种模式，它的每个Observable上都能够订阅，而Observable之间的关系，则能够体现流程（注意，RxJS里面的流程的控制和处理，其直观性略强于Promise，但弱于Generator）。</p><p>我们可以把一切输入都当做数据流来处理，比如说：</p><ul><li>用户操作</li><li>网络响应</li><li>定时器</li><li>Worker</li></ul><p>RxJS提供了各种API来创建数据流：</p><ul><li>单值：of, empty, never</li><li>多值：from</li><li>定时：interval, timer</li><li>从事件创建：fromEvent</li><li>从Promise创建：fromPromise</li><li>自定义创建：create</li></ul><p>创建出来的数据流是一种可观察的序列，可以被订阅，也可以被用来做一些转换操作，比如：</p><ul><li>改变数据形态：map, mapTo, pluck</li><li>过滤一些值：filter, skip, first, last, take</li><li>时间轴上的操作：delay, timeout, throttle, debounce, audit, bufferTime</li><li>累加：reduce, scan</li><li>异常处理：throw, catch, retry, finally</li><li>条件执行：takeUntil, delayWhen, retryWhen, subscribeOn, ObserveOn</li><li>转接：switch</li></ul><p>也可以对若干个数据流进行组合：</p><ul><li>concat，保持原来的序列顺序连接两个数据流</li><li>merge，合并序列</li><li>race，预设条件为其中一个数据流完成</li><li>forkJoin，预设条件为所有数据流都完成</li><li>zip，取各来源数据流最后一个值合并为对象</li><li>combineLatest，取各来源数据流最后一个值合并为数组</li></ul><p>这时候回头看，其实RxJS在事件处理的路上已经走得太远了，从事件到流，它被称为lodash for events，倒不如说是lodash for stream更贴切，它提供的这些操作符也确实可以跟lodash媲美。</p><p>那么，数据的管道是什么形状的？</p><p>在RxJS中，存在这么几种东西：</p><ul><li>Observable 可观察序列，只出不进</li><li>Observer 观察者，只进不出</li><li>Subject 可出可进的可观察序列，可作为观察者</li><li>ReplaySubject 带回放</li><li>Subscription 订阅关系</li></ul><p>基于RxJS编程，就好像是在组装管道，依赖关系其实是定义在管道上，而不是在数据上。所以，不存在命令式的那些问题，只要管道能够接起来，再放进去数据就可以了。所以，我们可以先定义管道之间的依赖关系，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#赚钱是为了买房，买房是为了赚钱</span><br><span class="line"></span><br><span class="line">            工资周期  ———&gt;  工资</span><br><span class="line">                            ↓</span><br><span class="line">房租周期  ———&gt;  租金  ———&gt;  收入  ———&gt;  现金 </span><br><span class="line">                ↑           ↓ </span><br><span class="line">             房子数量 &lt;——— 新购房</span><br><span class="line">             </span><br><span class="line"></span><br><span class="line">import &#123;interval, Subject, merge&#125; from &quot;rxjs&quot;;</span><br><span class="line">import &#123;mapTo, scan, startWith, withLatestFrom, map&#125; from &quot;rxjs/operators&quot;;</span><br><span class="line"></span><br><span class="line">// 工资：每1个月工资收入为2</span><br><span class="line">const salary$ = interval(1000).pipe(</span><br><span class="line">  mapTo(2),</span><br><span class="line">  map(s =&gt; &#123;</span><br><span class="line">    console.log(&quot;salary : &quot;+ (s))</span><br><span class="line">    return s;</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">// 房子</span><br><span class="line">const house$ = new Subject();</span><br><span class="line">// 房子数量</span><br><span class="line">const houseCount$ = house$.pipe(</span><br><span class="line">  scan((acc, num)=&gt; &#123;</span><br><span class="line">    console.log(&quot;house count : &quot;+ (acc+num))</span><br><span class="line">    return acc+num</span><br><span class="line">  &#125;,0), </span><br><span class="line">  startWith(0)</span><br><span class="line">);</span><br><span class="line">// 房租：每3个月房子数量*5</span><br><span class="line">const rent$ = interval(3000).pipe(</span><br><span class="line">  withLatestFrom(houseCount$),</span><br><span class="line">  map(arr =&gt; &#123;</span><br><span class="line">    console.log(&quot;rent : &quot;+ (arr[1] * 5))</span><br><span class="line">    return arr[1] * 5</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">// 收入：工资+房租</span><br><span class="line">const income$ = merge(salary$, rent$);</span><br><span class="line">// 现金流：一旦现金流够买房，就去买</span><br><span class="line">const cash$ = income$.pipe(</span><br><span class="line">  scan((acc,num) =&gt;&#123;</span><br><span class="line">    const newSum = acc+num;</span><br><span class="line">    const newHouse = Math.floor(newSum / 100);</span><br><span class="line">    console.log(&quot;cash : &quot;+ newSum )</span><br><span class="line">    if(newHouse &gt; 0) &#123;</span><br><span class="line">      console.log(&quot;** BUY HOUSE ** &quot;, newHouse)</span><br><span class="line">      house$.next(newHouse);</span><br><span class="line">      console.log(&quot;left : &quot;+ newSum % 100 )</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&quot;------ &quot;)</span><br><span class="line">    return newSum % 100;</span><br><span class="line">  &#125;, 0)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">cash$.subscribe()</span><br></pre></td></tr></table></figure><p>大部分业务系统前端不太适合用RxJS，大部分是中后台CRUD系统，因为两个原因：整体性、实时性的要求不高。</p><p>什么是整体性？这是一种系统设计的理念，系统中的很多业务模块不是孤立的，比如说，从展示上，GUI与命令行的差异在于什么？在于数据的冗余展示。我们可以把同一份业务数据以不同形态展示在不同视图上，甚至在PC端，由于屏幕大，可以允许同一份数据以不同形态同时展现，这时候，为了整体协调，对此数据的更新就会要产生很多分发和联动关系。</p><p>什么是实时性？这个其实有多个含义，一个比较重要的因素是服务端是否会主动向推送一些业务更新信息，如果用得比较多，也会产生不少的分发关系。</p><p>在分发和联动关系多的时候，RxJS才能更加体现出它比Generator、Promise的优势。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">let count = 0;</span><br><span class="line">const rate = 1000;</span><br><span class="line">let lastClick = Date.now() - rate;</span><br><span class="line">document.addEventListener(&apos;click&apos;, event =&gt; &#123;</span><br><span class="line">  if (Date.now() - lastClick &gt;= rate) &#123;</span><br><span class="line">    count += event.clientX;</span><br><span class="line">    console.log(count);</span><br><span class="line">    lastClick = Date.now();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import &#123; fromEvent &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; throttleTime, map, scan &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line">fromEvent(document, &apos;click&apos;)</span><br><span class="line">  .pipe(</span><br><span class="line">    throttleTime(1000),</span><br><span class="line">    map(event =&gt; event.clientX),</span><br><span class="line">    scan((count, clientX) =&gt; count + clientX, 0)</span><br><span class="line">  )</span><br><span class="line">  .subscribe(console.log);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Observable &#125; from &quot;rxjs&quot;;</span><br><span class="line"></span><br><span class="line">const observable = new Observable((subscriber) =&gt; &#123;</span><br><span class="line">  subscriber.next(1);</span><br><span class="line">  subscriber.next(2);</span><br><span class="line">  subscriber.next(3);</span><br><span class="line">  setTimeout(() =&gt; &#123;</span><br><span class="line">    subscriber.next(4); // happens asynchronously</span><br><span class="line">    subscriber.complete();</span><br><span class="line">  &#125;, 1000);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">console.log(&quot;just before subscribe&quot;);</span><br><span class="line">observable.subscribe(&#123;</span><br><span class="line">  next(x) &#123;</span><br><span class="line">    console.log(&quot;got value &quot; + x);</span><br><span class="line">  &#125;,</span><br><span class="line">  error(err) &#123;</span><br><span class="line">    console.error(&quot;something wrong occurred: &quot; + err);</span><br><span class="line">  &#125;,</span><br><span class="line">  complete() &#123;</span><br><span class="line">    console.log(&quot;done&quot;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">console.log(&quot;just after subscribe&quot;);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">&apos;just before subscribe&apos;</span><br><span class="line">&apos;got value 1&apos;</span><br><span class="line">&apos;got value 2&apos;</span><br><span class="line">&apos;got value 3&apos;</span><br><span class="line">&apos;just after subscribe&apos;</span><br><span class="line">&apos;got value 4&apos;</span><br><span class="line">&apos;done&apos;</span><br><span class="line">**/</span><br></pre></td></tr></table></figure><h3 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable</h3><p>represents the idea of an invokable collection of future values or events</p><table><thead><tr><th></th><th>SINGLE</th><th>MULTIPLE</th></tr></thead><tbody><tr><td>Pull</td><td>Function</td><td>Iterator</td></tr><tr><td>Push</td><td>Promise</td><td>Observable</td></tr></tbody></table><p>Pull and Push are two different protocols that describe how a data Producer can communicate with a data Consumer.</p><p>What is Pull? In Pull systems, the Consumer determines when it receives data from the data Producer. The Producer itself is unaware of when the data will be delivered to the Consumer.</p><p>Every JavaScript Function is a Pull system. The function is a Producer of data, and the code that calls the function is consuming it by “pulling” out a single return value from its call.</p><p>ES2015 introduced generator functions and iterators (function*), another type of Pull system. Code that calls iterator.next() is the Consumer, “pulling” out multiple values from the iterator (the Producer).</p><p>What is Push? In Push systems, the Producer determines when to send data to the Consumer. The Consumer is unaware of when it will receive that data.</p><p>Promises are the most common type of Push system in JavaScript today. A Promise (the Producer) delivers a resolved value to registered callbacks (the Consumers), but unlike functions, it is the Promise which is in charge of determining precisely when that value is “pushed” to the callbacks.</p><p>RxJS introduces Observables, a new Push system for JavaScript. An Observable is a Producer of multiple values, “pushing” them to Observers (Consumers).</p><ul><li>A Function is a lazily evaluated computation that synchronously returns a single value on invocation.</li><li>A generator is a lazily evaluated computation that synchronously returns zero to (potentially) infinite values on iteration.</li><li>A Promise is a computation that may (or may not) eventually return a single value.</li><li>An Observable is a lazily evaluated computation that can synchronously or asynchronously return zero to (potentially) infinite values from the time it’s invoked onwards.</li></ul><p>With observable.subscribe, the given Observer is not registered as a listener in the Observable. The Observable does not even maintain a list of attached Observers.</p><p>A subscribe call is simply a way to start an “Observable execution” and deliver values or events to an Observer of that execution.</p><p>In an Observable Execution, zero to infinite Next notifications may be delivered. If either an Error or Complete notification is delivered, then nothing else can be delivered afterwards.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const observable = new Observable(function subscribe(subscriber) &#123;</span><br><span class="line">	...</span><br><span class="line">	return function unsubscribe() &#123;&#125;;</span><br><span class="line">&#125;);</span><br><span class="line">const subscription = observable.subscribe(Observer&lt;T&gt;)</span><br><span class="line">subscription.unsubscribe();</span><br><span class="line"></span><br><span class="line">export interface Observer&lt;T&gt; &#123;</span><br><span class="line">  closed?: boolean;</span><br><span class="line">  next: (value: T) =&gt; void;</span><br><span class="line">  error: (err: any) =&gt; void;</span><br><span class="line">  complete: () =&gt; void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h3><p>is a collection of callbacks that knows how to listen to values delivered by the Observable</p><h3 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a>Subscription</h3><p>represents the execution of an Observable, is primarily useful for cancelling the execution</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import &#123; interval &#125; from &apos;rxjs&apos;;</span><br><span class="line"></span><br><span class="line">const observable1 = interval(400);</span><br><span class="line">const observable2 = interval(300);</span><br><span class="line"></span><br><span class="line">const subscription = observable1.subscribe(x =&gt; console.log(&apos;first: &apos; + x));</span><br><span class="line">const childSubscription = observable2.subscribe(x =&gt; console.log(&apos;second: &apos; + x));</span><br><span class="line"></span><br><span class="line">subscription.add(childSubscription);</span><br><span class="line">// subscription.remove(childSubscription);</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  // Unsubscribes BOTH subscription and childSubscription</span><br><span class="line">  subscription.unsubscribe();</span><br><span class="line">&#125;, 1000);</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">&apos;second: 0&apos;</span><br><span class="line">&apos;first: 0&apos;</span><br><span class="line">&apos;second: 1&apos;</span><br><span class="line">&apos;first: 1&apos;</span><br><span class="line">&apos;second: 2&apos;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a>Subject</h3><p>An RxJS Subject is a special type of Observable that allows values to be multicasted to many Observers. While plain Observables are unicast (each subscribed Observer owns an independent execution of the Observable), Subjects are multicast.<br>Subjects are like EventEmitters: they maintain a registry of many listeners.</p><ul><li>Every Subject is an Observable</li><li>Every Subject is an Observer</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Subject &#125; from &apos;rxjs&apos;;</span><br><span class="line"></span><br><span class="line">const subject = new Subject&lt;number&gt;();</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerA: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerB: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(1);</span><br><span class="line">subject.next(2);</span><br><span class="line"></span><br><span class="line">// Logs:</span><br><span class="line">// observerA: 1</span><br><span class="line">// observerB: 1</span><br><span class="line">// observerA: 2</span><br><span class="line">// observerB: 2</span><br></pre></td></tr></table></figure><h5 id="converted-a-unicast-Observable-execution-to-multicast-through-the-Subject"><a href="#converted-a-unicast-Observable-execution-to-multicast-through-the-Subject" class="headerlink" title="converted a unicast Observable execution to multicast through the Subject"></a>converted a unicast Observable execution to multicast through the Subject</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Subject, from &#125; from &apos;rxjs&apos;;</span><br><span class="line"></span><br><span class="line">const subject = new Subject&lt;number&gt;();</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerA: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerB: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const observable = from([1, 2, 3]);</span><br><span class="line"></span><br><span class="line">observable.subscribe(subject); // You can subscribe providing a Subject</span><br><span class="line"></span><br><span class="line">// Logs:</span><br><span class="line">// observerA: 1</span><br><span class="line">// observerB: 1</span><br><span class="line">// observerA: 2</span><br><span class="line">// observerB: 2</span><br><span class="line">// observerA: 3</span><br><span class="line">// observerB: 3</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import &#123; from, Subject &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; multicast &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">const source = from([1, 2, 3]);</span><br><span class="line">const subject = new Subject();</span><br><span class="line">const multicasted = source.pipe(multicast(subject));</span><br><span class="line"></span><br><span class="line">// These are, under the hood, `subject.subscribe(&#123;...&#125;)`:</span><br><span class="line">multicasted.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerA: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line">multicasted.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerB: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// This is, under the hood, `source.subscribe(subject)`:</span><br><span class="line">multicasted.connect();</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import &#123; interval, Subject &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; multicast, refCount &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">const source = interval(500);</span><br><span class="line">const subject = new Subject();</span><br><span class="line">const refCounted = source.pipe(multicast(subject), refCount());</span><br><span class="line">let subscription1, subscription2;</span><br><span class="line"></span><br><span class="line">// This calls `connect()`, because</span><br><span class="line">// it is the first subscriber to `refCounted`</span><br><span class="line">console.log(&apos;observerA subscribed&apos;);</span><br><span class="line">subscription1 = refCounted.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerA: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  console.log(&apos;observerB subscribed&apos;);</span><br><span class="line">  subscription2 = refCounted.subscribe(&#123;</span><br><span class="line">    next: (v) =&gt; console.log(`observerB: $&#123;v&#125;`)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, 600);</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  console.log(&apos;observerA unsubscribed&apos;);</span><br><span class="line">  subscription1.unsubscribe();</span><br><span class="line">&#125;, 1200);</span><br><span class="line"></span><br><span class="line">// This is when the shared Observable execution will stop, because</span><br><span class="line">// `refCounted` would have no more subscribers after this</span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  console.log(&apos;observerB unsubscribed&apos;);</span><br><span class="line">  subscription2.unsubscribe();</span><br><span class="line">&#125;, 2000);</span><br><span class="line"></span><br><span class="line">// Logs</span><br><span class="line">// observerA subscribed</span><br><span class="line">// observerA: 0</span><br><span class="line">// observerB subscribed</span><br><span class="line">// observerA: 1</span><br><span class="line">// observerB: 1</span><br><span class="line">// observerA unsubscribed</span><br><span class="line">// observerB: 2</span><br><span class="line">// observerB unsubscribed</span><br></pre></td></tr></table></figure><h5 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h5><p>A variant of Subject that requires an initial value and emits its current value whenever it is subscribed to<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import &#123; BehaviorSubject &#125; from &apos;rxjs&apos;;</span><br><span class="line">const subject = new BehaviorSubject(0); // 0 is the initial value</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerA: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(1);</span><br><span class="line">subject.next(2);</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerB: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(3);</span><br><span class="line"></span><br><span class="line">// Logs</span><br><span class="line">// observerA: 0</span><br><span class="line">// observerA: 1</span><br><span class="line">// observerA: 2</span><br><span class="line">// observerB: 2</span><br><span class="line">// observerA: 3</span><br><span class="line">// observerB: 3</span><br></pre></td></tr></table></figure><p></p><h5 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h5><p>A variant of Subject that “replays” or emits old values to new subscribers. It buffers a set number of values and will emit those values immediately to any new subscribers in addition to emitting new values to existing subscribers.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ReplaySubject &#125; from &apos;rxjs&apos;;</span><br><span class="line">const subject = new ReplaySubject(3); // buffer 3 values for new subscribers</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerA: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(1);</span><br><span class="line">subject.next(2);</span><br><span class="line">subject.next(3);</span><br><span class="line">subject.next(4);</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerB: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(5);</span><br><span class="line"></span><br><span class="line">// Logs:</span><br><span class="line">// observerA: 1</span><br><span class="line">// observerA: 2</span><br><span class="line">// observerA: 3</span><br><span class="line">// observerA: 4</span><br><span class="line">// observerB: 2</span><br><span class="line">// observerB: 3</span><br><span class="line">// observerB: 4</span><br><span class="line">// observerA: 5</span><br><span class="line">// observerB: 5</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ReplaySubject &#125; from &apos;rxjs&apos;;</span><br><span class="line">const subject = new ReplaySubject(100, 500 /* windowTime */);</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerA: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">let i = 1;</span><br><span class="line">setInterval(() =&gt; subject.next(i++), 200);</span><br><span class="line"></span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">  subject.subscribe(&#123;</span><br><span class="line">    next: (v) =&gt; console.log(`observerB: $&#123;v&#125;`)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, 1000);</span><br><span class="line"></span><br><span class="line">// Logs</span><br><span class="line">// observerA: 1</span><br><span class="line">// observerA: 2</span><br><span class="line">// observerA: 3</span><br><span class="line">// observerA: 4</span><br><span class="line">// observerA: 5</span><br><span class="line">// observerB: 3</span><br><span class="line">// observerB: 4</span><br><span class="line">// observerB: 5</span><br><span class="line">// observerA: 6</span><br><span class="line">// observerB: 6</span><br><span class="line">// ...</span><br></pre></td></tr></table></figure><h5 id="AsyncSubject"><a href="#AsyncSubject" class="headerlink" title="AsyncSubject"></a>AsyncSubject</h5><p>A variant of Subject that only emits a value when it completes. It will emit its latest value to all its observers on completion.<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import &#123; AsyncSubject &#125; from &apos;rxjs&apos;;</span><br><span class="line">const subject = new AsyncSubject();</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerA: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(1);</span><br><span class="line">subject.next(2);</span><br><span class="line">subject.next(3);</span><br><span class="line">subject.next(4);</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: (v) =&gt; console.log(`observerB: $&#123;v&#125;`)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(5);</span><br><span class="line">subject.complete();</span><br><span class="line"></span><br><span class="line">// Logs:</span><br><span class="line">// observerA: 5</span><br><span class="line">// observerB: 5</span><br></pre></td></tr></table></figure><p></p><h3 id="operators"><a href="#operators" class="headerlink" title="operators"></a>operators</h3><p>are pure functions that enable a functional programming style of dealing with collections with operations like map, filter, concat, reduce, etc</p><ul><li><strong>Pipeable Operators</strong>. When called, they do not change the existing Observable instance. Instead, they return a new Observable, whose subscription logic is based on the first Observable.</li><li><strong>Creation Operators</strong>. can be called as standalone functions to create a new Observable. Distinct from pipeable operators, creation operators are functions that can be used to create an Observable with some common predefined behavior or by joining other Observables.</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; of &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; map &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">map(x =&gt; x * x)(of(1, 2, 3)).subscribe((v) =&gt; console.log(`value: $&#123;v&#125;`));</span><br><span class="line"></span><br><span class="line">// Logs:</span><br><span class="line">// value: 1 </span><br><span class="line">// value: 4</span><br><span class="line">// value: 9</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123; of &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; first &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">first()(of(1, 2, 3)).subscribe((v) =&gt; console.log(`value: $&#123;v&#125;`));</span><br><span class="line"></span><br><span class="line">// Logs:</span><br><span class="line">// value: 1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">obs.pipe(</span><br><span class="line">  op1(),</span><br><span class="line">  op2(),</span><br><span class="line">  op3(),</span><br><span class="line">  op4(),</span><br><span class="line">)</span><br><span class="line">// op4()(op3()(op2()(op1()(obs))))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import &#123; interval &#125; from &apos;rxjs&apos;;</span><br><span class="line"></span><br><span class="line">const observable = interval(1000 /* number of milliseconds */);</span><br></pre></td></tr></table></figure><p><strong>Higher-order Observables</strong><br>Observables most commonly emit ordinary values like strings and numbers, but surprisingly often, it is necessary to handle Observables of Observables, so-called higher-order Observables.</p><p>But how do you work with a higher-order Observable? Typically, by flattening: by (somehow) converting a higher-order Observable into an ordinary Observable. For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const fileObservable = urlObservable.pipe(</span><br><span class="line">   map(url =&gt; http.get(url)),</span><br><span class="line">   concatAll(),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h5 id="Creation-Operators"><a href="#Creation-Operators" class="headerlink" title="Creation Operators"></a>Creation Operators</h5><h5 id="Join-Creation-Operators"><a href="#Join-Creation-Operators" class="headerlink" title="Join Creation Operators"></a>Join Creation Operators</h5><h5 id="Transformation-Operators"><a href="#Transformation-Operators" class="headerlink" title="Transformation Operators"></a>Transformation Operators</h5><h5 id="Filtering-Operators"><a href="#Filtering-Operators" class="headerlink" title="Filtering Operators"></a>Filtering Operators</h5><h5 id="Join-Operators"><a href="#Join-Operators" class="headerlink" title="Join Operators"></a>Join Operators</h5><h5 id="Multicasting-Operators"><a href="#Multicasting-Operators" class="headerlink" title="Multicasting Operators"></a>Multicasting Operators</h5><h5 id="Error-Handling-Operators"><a href="#Error-Handling-Operators" class="headerlink" title="Error Handling Operators"></a>Error Handling Operators</h5><h5 id="Utility-Operators"><a href="#Utility-Operators" class="headerlink" title="Utility Operators"></a>Utility Operators</h5><h5 id="Conditional-and-Boolean-Operators"><a href="#Conditional-and-Boolean-Operators" class="headerlink" title="Conditional and Boolean Operators"></a>Conditional and Boolean Operators</h5><h5 id="Mathematical-and-Aggregate-Operators"><a href="#Mathematical-and-Aggregate-Operators" class="headerlink" title="Mathematical and Aggregate Operators"></a>Mathematical and Aggregate Operators</h5><h5 id="use-the-pipe-function-to-make-new-operators"><a href="#use-the-pipe-function-to-make-new-operators" class="headerlink" title="use the pipe() function to make new operators"></a>use the pipe() function to make new operators</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; pipe &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; filter, map &#125; from &apos;rxjs&apos;;</span><br><span class="line"></span><br><span class="line">function discardOddDoubleEven() &#123;</span><br><span class="line">  return pipe(</span><br><span class="line">    filter(v =&gt; ! (v % 2)),</span><br><span class="line">    map(v =&gt; v + v),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="creating-new-operators-from-scratch"><a href="#creating-new-operators-from-scratch" class="headerlink" title="creating new operators from scratch"></a>creating new operators from scratch</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Observable &#125; from &apos;rxjs&apos;;</span><br><span class="line"></span><br><span class="line">function delay(delayInMillis) &#123;</span><br><span class="line">  return (observable) =&gt; new Observable(observer =&gt; &#123;</span><br><span class="line">    // this function will called each time this</span><br><span class="line">    // Observable is subscribed to.</span><br><span class="line">    const allTimerIDs = new Set();</span><br><span class="line">    const subscription = observable.subscribe(&#123;</span><br><span class="line">      next(value) &#123;</span><br><span class="line">        const timerID = setTimeout(() =&gt; &#123;</span><br><span class="line">          observer.next(value);</span><br><span class="line">          allTimerIDs.delete(timerID);</span><br><span class="line">        &#125;, delayInMillis);</span><br><span class="line">        allTimerIDs.add(timerID);</span><br><span class="line">      &#125;,</span><br><span class="line">      error(err) &#123;</span><br><span class="line">        observer.error(err);</span><br><span class="line">      &#125;,</span><br><span class="line">      complete() &#123;</span><br><span class="line">        observer.complete();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    // the return value is the teardown function,</span><br><span class="line">    // which will be invoked when the new</span><br><span class="line">    // Observable is unsubscribed from.</span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      subscription.unsubscribe();</span><br><span class="line">      allTimerIDs.forEach(timerID =&gt; &#123;</span><br><span class="line">        clearTimeout(timerID);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Schedulers"><a href="#Schedulers" class="headerlink" title="Schedulers"></a>Schedulers</h3><p>A scheduler controls when a subscription starts and when notifications are delivered. It consists of three components.</p><ul><li><strong>A Scheduler is a data structure</strong>. It knows how to store and queue tasks based on priority or other criteria.</li><li><strong>A Scheduler is an execution context</strong>. It denotes where and when the task is executed (e.g. immediately, or in another callback mechanism such as setTimeout or process.nextTick, or the animation frame).</li><li><strong>A Scheduler has a (virtual) clock</strong>. It provides a notion of “time” by a getter method now() on the scheduler. Tasks being scheduled on a particular scheduler will adhere only to the time denoted by that clock.</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Observable, asyncScheduler &#125; from &apos;rxjs&apos;;</span><br><span class="line">import &#123; observeOn &#125; from &apos;rxjs/operators&apos;;</span><br><span class="line"></span><br><span class="line">const observable = new Observable((observer) =&gt; &#123;</span><br><span class="line">  observer.next(1);</span><br><span class="line">  observer.next(2);</span><br><span class="line">  observer.next(3);</span><br><span class="line">  observer.complete();</span><br><span class="line">&#125;).pipe(</span><br><span class="line">  observeOn(asyncScheduler)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">console.log(&apos;just before subscribe&apos;);</span><br><span class="line">observable.subscribe(&#123;</span><br><span class="line">  next(x) &#123;</span><br><span class="line">    console.log(&apos;got value &apos; + x)</span><br><span class="line">  &#125;,</span><br><span class="line">  error(err) &#123;</span><br><span class="line">    console.error(&apos;something wrong occurred: &apos; + err);</span><br><span class="line">  &#125;,</span><br><span class="line">  complete() &#123;</span><br><span class="line">     console.log(&apos;done&apos;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">console.log(&apos;just after subscribe&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line">just before subscribe</span><br><span class="line">just after subscribe</span><br><span class="line">got value 1</span><br><span class="line">got value 2</span><br><span class="line">got value 3</span><br><span class="line">done</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><h5 id="scheduler-types"><a href="#scheduler-types" class="headerlink" title="scheduler types"></a>scheduler types</h5><ul><li><strong>null</strong> By not passing any scheduler, notifications are delivered synchronously and recursively. Use this for constant-time operations or tail recursive operations.</li><li><strong>queueScheduler</strong> Schedules on a queue in the current event frame (trampoline scheduler). Use this for iteration operations.</li><li><strong>asapScheduler</strong> Schedules on the micro task queue, which is the same queue used for promises. Basically after the current job, but before the next job. Use this for asynchronous conversions.</li><li><strong>asyncScheduler</strong> Schedules work with setInterval. Use this for time-based operations.</li><li><strong>animationFrameScheduler</strong> Schedules task that will happen just before next browser content repaint. Can be used to create smooth browser animations.</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface SchedulerLike &#123;</span><br><span class="line">  now(): number</span><br><span class="line">  schedule&lt;T&gt;(work: (this: SchedulerAction&lt;T&gt;, state?: T) =&gt; void, delay?: number, state?: T): Subscription</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Use <code>subscribeOn</code> to schedule in what context will the subscribe() call happen<br>Use <code>observeOn</code> to schedule in what context will notifications be delivered.</p><h3 id="QUESTION"><a href="#QUESTION" class="headerlink" title="QUESTION"></a>QUESTION</h3><ol><li>查询同一种数据，可能是同步的（缓存中获取 sync），可能是异步的（AJAX获取 async），业务代码编写需要考虑两种情况。</li><li>获取数据(pull)和数据的更新通知(push)，写法是不同的，会加大业务代码编写的复杂度。</li><li>每个渲染数据，都是通过若干个查询过程（刚才提到的组合同步异步）组合而成，如何清晰地定义这种组合关系？</li><li>对于已有数据和未来数据，如何简化它们应用同样规则的代码复杂度。</li></ol><h5 id="同步和异步"><a href="#同步和异步" class="headerlink" title="同步和异步"></a>同步和异步</h5><p>无论Promise还是Observable，都可以实现同步和异步的封装</p><h5 id="获取和订阅"><a href="#获取和订阅" class="headerlink" title="获取和订阅"></a>获取和订阅</h5><p>从视图的角度来说，数据哪里来的并不重要，只管显示<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># promise</span><br><span class="line">service.on(&apos;task&apos;, data =&gt; &#123; // 订阅</span><br><span class="line">  // render</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">service.getData()   // 需要主动加一句来触发初始化请求</span><br></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># observable</span><br><span class="line">getDataO().subscribe(data =&gt; &#123; // 获取和订阅这两件事情合并到了一起</span><br><span class="line">  // render</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="可组合的数据管道"><a href="#可组合的数据管道" class="headerlink" title="可组合的数据管道"></a>可组合的数据管道</h5><p>一个视图所需要的数据可能是这样的：（data1,data2,data3都是包含了同步和异步封装的一个过程）</p><ul><li>data1跟data2通过某种组合，得到一个结果</li><li>这个结果再去跟data3组合，得到最终结果</li></ul><p>抽象这个过程： 可以把每个Observable视为一节数据流的管道，我们所要做的，是根据它们之间的关系，把这些管道组装起来，这样，从管道的某个入口传入数据，在末端就可以得到最终的结果。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const A$ = Observable.interval(1000)</span><br><span class="line">const B$ = Observable.of(3)</span><br><span class="line">const C$ = Observable.from([5, 6, 7])</span><br><span class="line"></span><br><span class="line">const D$ = C$.toArray()</span><br><span class="line">  .map(arr =&gt; arr.reduce((a, b) =&gt; a + b), 0)</span><br><span class="line">const E$ = Observable.combineLatest(A$, B$, D$)</span><br><span class="line">   .map(arr =&gt; arr.reduce((a, b) =&gt; a + b), 0)</span><br></pre></td></tr></table></figure><h5 id="现在和未来"><a href="#现在和未来" class="headerlink" title="现在和未来"></a>现在和未来</h5><p>我们编写业务程序的时候，往往会把现在和未来分开考虑，而忽略了他们之间存在的深层次的一致性。<br>合适的业务抽象应该是如下规则</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 来源等于初始数据与新增数据的合并</span><br><span class="line">const source$ = start$.merge(patch$) // 例如start是查询，patch是推送</span><br><span class="line"></span><br><span class="line"># 进入本列表的数据都应当经过某种过滤规则和某种排序规则</span><br><span class="line">const final$ = source$.map(filterA).map(sorterA)</span><br><span class="line"></span><br><span class="line"># 最后在final上添加订阅，整个过程就完美的映射到了界面上</span><br></pre></td></tr></table></figure><p>很多时候，我们编写代码都会考虑进行合适的抽象，但这两个字代表的含义在很多场景下并不相同。</p><p>很多人会懂得把代码划分为若干方法，若干类型，若干组件，以为这样就能够把整套业务的运转过程抽象出来，其实不然。</p><p>业务逻辑的抽象是与业务单元不同的方式，前者是血脉和神经，后者是肢体和器官，两者需要结合在一起，才能够成为鲜活的整体。</p><p>一般场景下，业务单元的抽象难度相对较低，很容易理解，也容易获得关注，所以通常都能做得还不错，比如最近两年，对于组件化之类的话题，都能够谈得起来了，但对于业务逻辑的抽象，大部分项目是做得很不够的，值得深思。</p><h5 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h5><ol><li><a href="https://github.com/xufei/blog/issues/38" target="_blank" rel="noopener">https://github.com/xufei/blog/issues/38</a></li></ol></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://molly2molly.github.io/2020/05/21/RxJS/" target="_blank" rel="external">https://molly2molly.github.io/2020/05/21/RxJS/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/molly2molly" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/molly2molly" target="_blank"><span class="text-dark">张英姿</span><small class="ml-1x">前端工程师</small></a></h3><div>梦里寻他千百度 蓦然回首 那人却在灯火阑珊处</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom=""><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2020/06/01/JS异步/" title="JS异步"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a></li><li class="next"><a href="/2020/05/07/Decorators/" title="Decorators"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>Maybe you could buy me a cup of coffee.</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>!function(T){var n={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"};T.INSIGHT_CONFIG=n}(window)</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta="nick,mail,link";meta=meta.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({model:{jsonPath:"/null"},display:{position:"left",width:150,height:300},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body></html><!-- rebuild by neat -->