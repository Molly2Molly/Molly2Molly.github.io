<!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>WebRTC | Hexo</title><meta name="description" content="WebRTC is an open source project to enable realtime communication of audio, video and data in Web and native apps.WebRTC has several JavaScript APIsgetUserMedia(): capture audio and video.MediaRecorde"><meta property="og:type" content="article"><meta property="og:title" content="WebRTC"><meta property="og:url" content="https://molly2molly.github.io/WebRTC/index.html"><meta property="og:site_name" content="张英姿的博客"><meta property="og:description" content="WebRTC is an open source project to enable realtime communication of audio, video and data in Web and native apps.WebRTC has several JavaScript APIsgetUserMedia(): capture audio and video.MediaRecorde"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2021-03-19T02:08:38.506Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="WebRTC"><meta name="twitter:description" content="WebRTC is an open source project to enable realtime communication of audio, video and data in Web and native apps.WebRTC has several JavaScript APIsgetUserMedia(): capture audio and video.MediaRecorde"><link rel="canonical" href="https://molly2molly.github.io/WebRTC/index.html"><link rel="alternate" href="/atom.xml" title="张英姿的博客" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"></head><body class="main-center theme-green" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/molly2molly" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">张英姿</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">前端工程师</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> 苏州, 中国</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech=""> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">Categories</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">Tags</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">Repository</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">Books</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">Links</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">About</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Board</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">Categories</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/D3-js/">D3.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tags</h3><div class="widget-body"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/">Webpack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6-javascript/">es6 javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tag Cloud</h3><div class="widget-body tagcloud"><a href="/tags/React/" style="font-size:13px">React</a> <a href="/tags/TCP/" style="font-size:13px">TCP</a> <a href="/tags/Webpack/" style="font-size:13px">Webpack</a> <a href="/tags/es6-javascript/" style="font-size:13px">es6 javascript</a> <a href="/tags/javascript/" style="font-size:14px">javascript</a> <a href="/tags/markdown/" style="font-size:13px">markdown</a> <a href="/tags/数据结构/" style="font-size:14px">数据结构</a></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">16</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/Babel/" class="title">Babel</a></p><p class="item-date"><time datetime="2021-03-26T07:05:01.000Z" itemprop="datePublished">2021-03-26</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/Yeoman/" class="title">Yeoman</a></p><p class="item-date"><time datetime="2021-03-23T06:56:23.000Z" itemprop="datePublished">2021-03-23</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/FreeOnlineProgrammingCSCourses/" class="title">FreeOnlineProgrammingCSCourses</a></p><p class="item-date"><time datetime="2021-01-13T01:18:08.000Z" itemprop="datePublished">2021-01-13</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/Question/" class="title">Question</a></p><p class="item-date"><time datetime="2021-01-12T05:38:46.000Z" itemprop="datePublished">2021-01-12</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/URL/" class="title">URL</a></p><p class="item-date"><time datetime="2021-01-11T06:39:46.000Z" itemprop="datePublished">2021-01-11</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-WebRTC" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">WebRTC</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/WebRTC/" class="article-date"><time datetime="2019-12-16T02:36:51.000Z" itemprop="datePublished">2019-12-16</time></a></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/WebRTC/#comments" class="article-comment-link">Comments</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><p>WebRTC is an open source project to enable realtime communication of audio, video and data in Web and native apps.</p><h2 id="WebRTC-has-several-JavaScript-APIs"><a href="#WebRTC-has-several-JavaScript-APIs" class="headerlink" title="WebRTC has several JavaScript APIs"></a>WebRTC has several JavaScript APIs</h2><ul><li><a href="https://webrtc.github.io/samples/src/content/getusermedia/gum/" target="_blank" rel="noopener"><code>getUserMedia()</code></a>: capture audio and video.</li><li><a href="https://webrtc.github.io/samples/src/content/getusermedia/record/" target="_blank" rel="noopener"><code>MediaRecorder</code></a>: record audio and video.</li><li><a href="https://webrtc.github.io/samples/src/content/peerconnection/pc1/" target="_blank" rel="noopener"><code>RTCPeerConnection</code></a>: stream audio and video between users.</li><li><a href="https://webrtc.github.io/samples/src/content/datachannel/basic/" target="_blank" rel="noopener"><code>RTCDataChannel</code></a>: stream data between users.</li></ul><h2 id="Where-can-I-use-WebRTC"><a href="#Where-can-I-use-WebRTC" class="headerlink" title="Where can I use WebRTC?"></a>Where can I use WebRTC?</h2><p>In Firefox, Opera and in Chrome on desktop and Android. WebRTC is also available for native apps on iOS and Android.</p><h2 id="What-is-signaling"><a href="#What-is-signaling" class="headerlink" title="What is signaling?"></a>What is signaling?</h2><p>WebRTC uses RTCPeerConnection to communicate streaming data between browsers, but also needs a mechanism to coordinate communication and to send control messages, a process known as signaling. Signaling methods and protocols are not specified by WebRTC. In this codelab you will use Socket.IO for messaging, but there are <a href="https://github.com/muaz-khan/WebRTC-Experiment/blob/master/Signaling.md" target="_blank" rel="noopener">many alternatives</a>.</p><p>Signaling is the process of coordinating communication. In order for a WebRTC app to set up a call, its clients need to exchange the following information:</p><ul><li>Session-control messages used to open or close communication</li><li>Error messages</li><li>Media metadata, such as codecs, codec settings, bandwidth, and media types</li><li>Key data used to establish secure connections</li><li>Network data, such as a host’s IP address and port as seen by the outside world</li></ul><p>This signaling process needs a way for clients to pass messages back and forth. That mechanism is not implemented by the WebRTC APIs. You need to build it yourself.</p><p>To avoid redundancy and to maximize compatibility with established technologies, signaling methods and protocols are not specified by WebRTC standards. This approach is outlined by the <a href="https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-03#section-1.1" target="_blank" rel="noopener">JavaScript Session Establishment Protocol (JSEP)</a></p><h2 id="What-are-STUN-and-TURN"><a href="#What-are-STUN-and-TURN" class="headerlink" title="What are STUN and TURN?"></a>What are STUN and TURN?</h2><p>WebRTC is designed to work peer-to-peer, so users can connect by the most direct route possible. However, WebRTC is built to cope with real-world networking: client applications need to traverse <a href="http://en.wikipedia.org/wiki/NAT_traversal" target="_blank" rel="noopener">NAT gateways</a> and firewalls, and peer to peer networking needs fallbacks in case direct connection fails. As part of this process, the WebRTC APIs use STUN servers to get the IP address of your computer, and TURN servers to function as relay servers in case peer-to-peer communication fails. (<a href="http://www.html5rocks.com/en/tutorials/webrtc/infrastructure/" target="_blank" rel="noopener">WebRTC in the real world</a> explains in more detail.)</p><h2 id="RTCPeerConnection-API-and-signaling-Offer-answer-and-candidate"><a href="#RTCPeerConnection-API-and-signaling-Offer-answer-and-candidate" class="headerlink" title="RTCPeerConnection API and signaling: Offer, answer, and candidate"></a><code>RTCPeerConnection</code> API and signaling: Offer, answer, and candidate</h2><p><code>RTCPeerConnection</code> is the API used by WebRTC apps to create a connection between peers, and communicate audio and video.</p><p>To initialize this process, <code>RTCPeerConnection</code> has two tasks:</p><ul><li>Ascertain local media conditions, such as resolution and codec capabilities. This is the metadata used for the offer-and-answer mechanism.</li><li>Get potential network addresses for the app’s host, known as <em>candidates</em>.</li></ul><p>Once this local data has been ascertained, it must be exchanged through a signaling mechanism with the remote peer.</p><p>Imagine <a href="https://xkcd.com/177/" target="_blank" rel="noopener">Alice is trying to call Eve</a>. Here’s the full offer/answer mechanism in all its gory detail:</p><ol><li>Alice creates an <code>RTCPeerConnection</code> object.</li><li>Alice creates an offer (an SDP session description) with the <code>RTCPeerConnection</code> <code>createOffer()</code> method.</li><li>Alice calls <code>setLocalDescription()</code> with her offer.</li><li>Alice stringifies the offer and uses a signaling mechanism to send it to Eve.</li><li>Eve calls <code>setRemoteDescription()</code> with Alice’s offer, so that her <code>RTCPeerConnection</code> knows about Alice’s setup.</li><li>Eve calls <code>createAnswer()</code> and the success callback for this is passed a local session description—Eve’s answer.</li><li>Eve sets her answer as the local description by calling <code>setLocalDescription()</code>.</li><li>Eve then uses the signaling mechanism to send her stringified answer to Alice.</li><li>Alice sets Eve’s answer as the remote session description using <code>setRemoteDescription()</code>.</li></ol><p>Alice and Eve also need to exchange network information. The expression “finding candidates” refers to the process of finding network interfaces and ports using the <a href="https://en.wikipedia.org/wiki/Interactive_Connectivity_Establishment" target="_blank" rel="noopener">ICE framework</a>.</p><ol><li>Alice creates an <code>RTCPeerConnection</code> object with an <code>onicecandidate</code> handler.</li><li>The handler is called when network candidates become available.</li><li>In the handler, Alice sends stringified candidate data to Eve through their signaling channel.</li><li>When Eve gets a candidate message from Alice, she calls <code>addIceCandidate()</code> to add the candidate to the remote peer description.</li></ol><p>JSEP supports <a href="https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-03#section-3.4.1" target="_blank" rel="noopener">ICE Candidate Trickling</a>, which allows the caller to incrementally provide candidates to the callee after the initial offer, and for the callee to begin acting on the call and set up a connection without waiting for all candidates to arrive.</p><h2 id="Code-WebRTC-for-signaling"><a href="#Code-WebRTC-for-signaling" class="headerlink" title="Code WebRTC for signaling"></a>Code WebRTC for signaling</h2><p>The following code snippet is a <a href="https://w3c.github.io/webrtc-pc/#simple-peer-to-peer-example" target="_blank" rel="noopener">W3C code example</a> that summarizes the complete signaling process. The code assumes the existence of some signaling mechanism, <code>SignalingChannel</code>. Signaling is discussed in greater detail later.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// handles JSON.stringify/parse</span></span><br><span class="line"><span class="keyword">const</span> signaling = <span class="keyword">new</span> SignalingChannel();</span><br><span class="line"><span class="keyword">const</span> constraints = &#123;<span class="attr">audio</span>: <span class="literal">true</span>, <span class="attr">video</span>: <span class="literal">true</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> configuration = &#123;<span class="attr">iceServers</span>: [&#123;<span class="attr">urls</span>: <span class="string">'stuns:stun.example.org'</span>&#125;]&#125;;</span><br><span class="line"><span class="keyword">const</span> pc = <span class="keyword">new</span> RTCPeerConnection(configuration);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send any ice candidates to the other peer.</span></span><br><span class="line">pc.onicecandidate = <span class="function">(<span class="params">&#123;candidate&#125;</span>) =&gt;</span> signaling.send(&#123;candidate&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Let the "negotiationneeded" event trigger offer generation.</span></span><br><span class="line">pc.onnegotiationneeded = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> pc.setLocalDescription(<span class="keyword">await</span> pc.createOffer());</span><br><span class="line">    <span class="comment">// send the offer to the other peer</span></span><br><span class="line">    signaling.send(&#123;<span class="attr">desc</span>: pc.localDescription&#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// After remote track media arrives, show it in remote video element.</span></span><br><span class="line">pc.ontrack = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Don't set srcObject again if it is already set.</span></span><br><span class="line">  <span class="keyword">if</span> (remoteView.srcObject) <span class="keyword">return</span>;</span><br><span class="line">  remoteView.srcObject = event.streams[<span class="number">0</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Call start() to initiate.</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// Get local stream, show it in self-view, and add it to be sent.</span></span><br><span class="line">    <span class="keyword">const</span> stream =</span><br><span class="line">      <span class="keyword">await</span> navigator.mediaDevices.getUserMedia(constraints);</span><br><span class="line">    stream.getTracks().forEach(<span class="function">(<span class="params">track</span>) =&gt;</span></span><br><span class="line">      pc.addTrack(track, stream));</span><br><span class="line">    selfView.srcObject = stream;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signaling.onmessage = <span class="keyword">async</span> (&#123;desc, candidate&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (desc) &#123;</span><br><span class="line">      <span class="comment">// If you get an offer, you need to reply with an answer.</span></span><br><span class="line">      <span class="keyword">if</span> (desc.type === <span class="string">'offer'</span>) &#123;</span><br><span class="line">        <span class="keyword">await</span> pc.setRemoteDescription(desc);</span><br><span class="line">        <span class="keyword">const</span> stream =</span><br><span class="line">          <span class="keyword">await</span> navigator.mediaDevices.getUserMedia(constraints);</span><br><span class="line">        stream.getTracks().forEach(<span class="function">(<span class="params">track</span>) =&gt;</span></span><br><span class="line">          pc.addTrack(track, stream));</span><br><span class="line">        <span class="keyword">await</span> pc.setLocalDescription(<span class="keyword">await</span> pc.createAnswer());</span><br><span class="line">        signaling.send(&#123;<span class="attr">desc</span>: pc.localDescription&#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (desc.type === <span class="string">'answer'</span>) &#123;</span><br><span class="line">        <span class="keyword">await</span> pc.setRemoteDescription(desc);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Unsupported SDP type.'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (candidate) &#123;</span><br><span class="line">      <span class="keyword">await</span> pc.addIceCandidate(candidate);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>To see the offer/answer and candidate-exchange processes in action, see <a href="https://simpl.info/rtcpeerconnection/" target="_blank" rel="noopener">simpl.info RTCPeerConnection</a> and look at the console log for a single-page video chat example. If you want more, download a complete dump of WebRTC signaling and stats from the chrome://webrtc-internals page in Google Chrome or the opera://webrtc-internals page in Opera.</p><h2 id="Peer-discovery"><a href="#Peer-discovery" class="headerlink" title="Peer discovery"></a>Peer discovery</h2><p>Peer discovery mechanisms are not defined by WebRTC and you don’t go into the options here. The process can be as simple as emailing or messaging a URL. For video chat apps, such as <a href="https://talky.io/" target="_blank" rel="noopener">Talky</a>, <a href="https://tawk.com/" target="_blank" rel="noopener">tawk.to</a> and <a href="https://browsermeeting.com/" target="_blank" rel="noopener">Browser Meeting</a>, you invite people to a call by sharing a custom link. Developer Chris Ball built an intriguing <a href="https://blog.printf.net/articles/2013/05/17/webrtc-without-a-signaling-server/" target="_blank" rel="noopener">serverless-webrtc</a> experiment that enables WebRTC call participants to exchange metadata by any messaging service they like, such as IM, email, or homing pigeon.</p><h2 id="Is-WebRTC-secure"><a href="#Is-WebRTC-secure" class="headerlink" title="Is WebRTC secure?"></a>Is WebRTC secure?</h2><p>Encryption is mandatory for all WebRTC components, and its JavaScript APIs can only be used from secure origins (HTTPS or localhost). Signaling mechanisms aren’t defined by WebRTC standards, so it’s up to you make sure to use secure protocols.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;video autoplay playsinline&gt;<span class="xml"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mediaStreamConstraints = &#123;</span><br><span class="line">  video: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> hdConstraints = &#123;</span><br><span class="line">  video: &#123;</span><br><span class="line">    width: &#123;</span><br><span class="line">      min: <span class="number">1280</span></span><br><span class="line">    &#125;,</span><br><span class="line">    height: &#123;</span><br><span class="line">      min: <span class="number">720</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Video element where stream will be placed.</span></span><br><span class="line"><span class="keyword">const</span> localVideo = <span class="built_in">document</span>.querySelector(<span class="string">'video'</span>);</span><br><span class="line"><span class="comment">// Local stream that will be reproduced on the video.</span></span><br><span class="line"><span class="keyword">let</span> localStream;</span><br><span class="line"><span class="comment">// Handles success by adding the MediaStream to the video element.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gotLocalMediaStream</span>(<span class="params">mediaStream</span>) </span>&#123;</span><br><span class="line">  localStream = mediaStream;</span><br><span class="line">  localVideo.srcObject = mediaStream;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Handles error by logging a message to the console with the error message.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleLocalMediaStreamError</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'navigator.getUserMedia error: '</span>, error);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Initializes media stream.</span></span><br><span class="line">navigator.mediaDevices.getUserMedia(mediaStreamConstraints)</span><br><span class="line">  .then(gotLocalMediaStream)</span><br><span class="line">  .catch(handleLocalMediaStreamError);</span><br></pre></td></tr></table></figure><h5 id="HTML-Media-Capture"><a href="#HTML-Media-Capture" class="headerlink" title="HTML Media Capture"></a>HTML Media Capture</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;file&quot; accept=&quot;image/*;capture=camera&quot;&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; accept=&quot;video/*;capture=camcorder&quot;&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; accept=&quot;audio/*;capture=microphone&quot;&gt;</span><br></pre></td></tr></table></figure><h5 id="device-element-browser-not-support"><a href="#device-element-browser-not-support" class="headerlink" title="device element ( browser not support )"></a>device element ( browser not support )</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;device type=&quot;media&quot; onchange=&quot;update(this.data)&quot;&gt;&lt;/device&gt;</span><br><span class="line">&lt;video autoplay&gt;&lt;/video&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  function update(stream) &#123;</span><br><span class="line">    document.querySelector(&apos;video&apos;).src = stream.url;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h5 id="getUserMedia"><a href="#getUserMedia" class="headerlink" title="getUserMedia"></a>getUserMedia</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">function hasGetUserMedia() &#123;</span><br><span class="line">  return !!(navigator.mediaDevices &amp;&amp;</span><br><span class="line">    navigator.mediaDevices.getUserMedia);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (hasGetUserMedia()) &#123;</span><br><span class="line">  // Good to go!</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  alert(&apos;getUserMedia() is not supported by your browser&apos;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;video autoplay&gt;&lt;/video&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const constraints = &#123;</span><br><span class="line">  video: true</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const video = document.querySelector(&apos;video&apos;);</span><br><span class="line"></span><br><span class="line">navigator.mediaDevices.getUserMedia(constraints).</span><br><span class="line">  then((stream) =&gt; &#123;video.srcObject = stream&#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">const hdConstraints = &#123;</span><br><span class="line">  video: &#123;width: &#123;min: 1280&#125;, height: &#123;min: 720&#125;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">navigator.mediaDevices.getUserMedia(hdConstraints).</span><br><span class="line">  then((stream) =&gt; &#123;video.srcObject = stream&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const vgaConstraints = &#123;</span><br><span class="line">  video: &#123;width: &#123;exact: 640&#125;, height: &#123;exact: 480&#125;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">navigator.mediaDevices.getUserMedia(vgaConstraints).</span><br><span class="line">  then((stream) =&gt; &#123;video.srcObject = stream&#125;);</span><br></pre></td></tr></table></figure><h5 id="select-a-media-source"><a href="#select-a-media-source" class="headerlink" title="select a media source"></a>select a media source</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">var videoElement = document.querySelector(&apos;video&apos;);</span><br><span class="line">var audioSelect = document.querySelector(&apos;select#audioSource&apos;);</span><br><span class="line">var videoSelect = document.querySelector(&apos;select#videoSource&apos;);</span><br><span class="line"></span><br><span class="line">audioSelect.onchange = getStream;</span><br><span class="line">videoSelect.onchange = getStream;</span><br><span class="line"></span><br><span class="line">getStream().then(getDevices).then(gotDevices);</span><br><span class="line"></span><br><span class="line">function getDevices() &#123;</span><br><span class="line">  // AFAICT in Safari this only gets default devices until gUM is called :/</span><br><span class="line">  return navigator.mediaDevices.enumerateDevices();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function gotDevices(deviceInfos) &#123;</span><br><span class="line">  window.deviceInfos = deviceInfos; // make available to console</span><br><span class="line">  console.log(&apos;Available input and output devices:&apos;, deviceInfos);</span><br><span class="line">  for (const deviceInfo of deviceInfos) &#123;</span><br><span class="line">    const option = document.createElement(&apos;option&apos;);</span><br><span class="line">    option.value = deviceInfo.deviceId;</span><br><span class="line">    if (deviceInfo.kind === &apos;audioinput&apos;) &#123;</span><br><span class="line">      option.text = deviceInfo.label || `Microphone $&#123;audioSelect.length + 1&#125;`;</span><br><span class="line">      audioSelect.appendChild(option);</span><br><span class="line">    &#125; else if (deviceInfo.kind === &apos;videoinput&apos;) &#123;</span><br><span class="line">      option.text = deviceInfo.label || `Camera $&#123;videoSelect.length + 1&#125;`;</span><br><span class="line">      videoSelect.appendChild(option);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getStream() &#123;</span><br><span class="line">  if (window.stream) &#123;</span><br><span class="line">    window.stream.getTracks().forEach(track =&gt; &#123;</span><br><span class="line">      track.stop();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  const audioSource = audioSelect.value;</span><br><span class="line">  const videoSource = videoSelect.value;</span><br><span class="line">  const constraints = &#123;</span><br><span class="line">    audio: &#123;deviceId: audioSource ? &#123;exact: audioSource&#125; : undefined&#125;,</span><br><span class="line">    video: &#123;deviceId: videoSource ? &#123;exact: videoSource&#125; : undefined&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  return navigator.mediaDevices.getUserMedia(constraints).</span><br><span class="line">    then(gotStream).catch(handleError);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function gotStream(stream) &#123;</span><br><span class="line">  window.stream = stream; // make stream available to console</span><br><span class="line">  audioSelect.selectedIndex = [...audioSelect.options].</span><br><span class="line">    findIndex(option =&gt; option.text === stream.getAudioTracks()[0].label);</span><br><span class="line">  videoSelect.selectedIndex = [...videoSelect.options].</span><br><span class="line">    findIndex(option =&gt; option.text === stream.getVideoTracks()[0].label);</span><br><span class="line">  videoElement.srcObject = stream;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleError(error) &#123;</span><br><span class="line">  console.error(&apos;Error: &apos;, error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Taking-screenshots"><a href="#Taking-screenshots" class="headerlink" title="Taking screenshots"></a>Taking screenshots</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;video autoplay&gt;&lt;/video&gt;</span><br><span class="line">&lt;img src=&quot;&quot;&gt;</span><br><span class="line">&lt;canvas style=&quot;display:none;&quot;&gt;&lt;/canvas&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const captureVideoButton =</span><br><span class="line">  document.querySelector(&apos;#screenshot .capture-button&apos;);</span><br><span class="line">const screenshotButton = document.querySelector(&apos;#screenshot-button&apos;);</span><br><span class="line">const img = document.querySelector(&apos;#screenshot img&apos;);</span><br><span class="line">const video = document.querySelector(&apos;#screenshot video&apos;);</span><br><span class="line"></span><br><span class="line">const canvas = document.createElement(&apos;canvas&apos;);</span><br><span class="line"></span><br><span class="line">captureVideoButton.onclick = function() &#123;</span><br><span class="line">  navigator.mediaDevices.getUserMedia(constraints).</span><br><span class="line">    then(handleSuccess).catch(handleError);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">screenshotButton.onclick = video.onclick = function() &#123;</span><br><span class="line">  canvas.width = video.videoWidth;</span><br><span class="line">  canvas.height = video.videoHeight;</span><br><span class="line">  canvas.getContext(&apos;2d&apos;).drawImage(video, 0, 0);</span><br><span class="line">  // Other browsers will fall back to image/png</span><br><span class="line">  img.src = canvas.toDataURL(&apos;image/webp&apos;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function handleSuccess(stream) &#123;</span><br><span class="line">  screenshotButton.disabled = false;</span><br><span class="line">  video.srcObject = stream;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h5 id="CSS-Filters"><a href="#CSS-Filters" class="headerlink" title="CSS Filters"></a>CSS Filters</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;video autoplay&gt;&lt;/video&gt;</span><br><span class="line">&lt;p&gt;&lt;button class=&quot;capture-button&quot;&gt;Capture video&lt;/button&gt;</span><br><span class="line">&lt;p&gt;&lt;button id=&quot;cssfilters-apply&quot;&gt;Apply CSS filter&lt;/button&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">const captureVideoButton =</span><br><span class="line">  document.querySelector(&apos;#cssfilters .capture-button&apos;);</span><br><span class="line">const cssFiltersButton =</span><br><span class="line">  document.querySelector(&apos;#cssfilters-apply&apos;);</span><br><span class="line">const video =</span><br><span class="line">  document.querySelector(&apos;#cssfilters video&apos;);</span><br><span class="line"></span><br><span class="line">let filterIndex = 0;</span><br><span class="line">const filters = [</span><br><span class="line">  &apos;grayscale&apos;,</span><br><span class="line">  &apos;sepia&apos;,</span><br><span class="line">  &apos;blur&apos;,</span><br><span class="line">  &apos;brightness&apos;,</span><br><span class="line">  &apos;contrast&apos;,</span><br><span class="line">  &apos;hue-rotate&apos;,</span><br><span class="line">  &apos;hue-rotate2&apos;,</span><br><span class="line">  &apos;hue-rotate3&apos;,</span><br><span class="line">  &apos;saturate&apos;,</span><br><span class="line">  &apos;invert&apos;,</span><br><span class="line">  &apos;&apos;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">captureVideoButton.onclick = function() &#123;</span><br><span class="line">  navigator.mediaDevices.getUserMedia(constraints).</span><br><span class="line">    then(handleSuccess).catch(handleError);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">cssFiltersButton.onclick = video.onclick = function() &#123;</span><br><span class="line">  video.className = filters[filterIndex++ % filters.length];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">function handleSuccess(stream) &#123;</span><br><span class="line">  video.srcObject = stream;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="Build-a-signaling-service-with-Socket-io-on-Node"><a href="#Build-a-signaling-service-with-Socket-io-on-Node" class="headerlink" title="Build a signaling service with Socket.io on Node"></a>Build a signaling service with Socket.io on Node</h2><p>Socket.io uses WebSocket with fallbacks: AJAX long polling, AJAX multipart streaming, Forever Iframe, and JSONP polling. It has been ported to various backends, but is perhaps best known for its Node version used in this example.</p><p>There’s no WebRTC in this example. It’s designed only to show how to build signaling into a web app. View the console log to see what’s happening as clients join a room and exchange messages. This <a href="https://codelabs.developers.google.com/codelabs/webrtc-web/#0" target="_blank" rel="noopener">WebRTC codelab</a> gives step-by-step instructions for how to integrate this into a complete WebRTC video chat app.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// index.html</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>WebRTC client<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'/socket.io/socket.io.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'js/main.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> isInitiator;</span><br><span class="line"></span><br><span class="line">room = prompt(<span class="string">'Enter room name:'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> socket = io.connect();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (room !== <span class="string">''</span>) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Joining room '</span> + room);</span><br><span class="line">  socket.emit(<span class="string">'create or join'</span>, room);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'full'</span>, (room) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Room '</span> + room + <span class="string">' is full'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'empty'</span>, (room) =&gt; &#123;</span><br><span class="line">  isInitiator = <span class="literal">true</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Room '</span> + room + <span class="string">' is empty'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'join'</span>, (room) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Making request to join room '</span> + room);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'You are the initiator!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">socket.on(<span class="string">'log'</span>, (array) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log.apply(<span class="built_in">console</span>, array);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">'node-static'</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> file = <span class="keyword">new</span>(<span class="keyword">static</span>.Server)();</span><br><span class="line"><span class="keyword">const</span> app = http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  file.serve(req, res);</span><br><span class="line">&#125;).listen(<span class="number">2013</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>).listen(app);</span><br><span class="line"></span><br><span class="line">io.sockets.on(<span class="string">'connection'</span>, (socket) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Convenience function to log server messages to the client</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> array = [<span class="string">'&gt;&gt;&gt; Message from server: '</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123;</span><br><span class="line">      array.push(<span class="built_in">arguments</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">      socket.emit(<span class="string">'log'</span>, array);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">'message'</span>, (message) =&gt; &#123;</span><br><span class="line">    log(<span class="string">'Got message:'</span>, message);</span><br><span class="line">    <span class="comment">// For a real app, would be room only (not broadcast)</span></span><br><span class="line">    socket.broadcast.emit(<span class="string">'message'</span>, message);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  socket.on(<span class="string">'create or join'</span>, (room) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> numClients = io.sockets.clients(room).length;</span><br><span class="line"></span><br><span class="line">    log(<span class="string">'Room '</span> + room + <span class="string">' has '</span> + numClients + <span class="string">' client(s)'</span>);</span><br><span class="line">    log(<span class="string">'Request to create or join room '</span> + room);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (numClients === <span class="number">0</span>)&#123;</span><br><span class="line">      socket.join(room);</span><br><span class="line">      socket.emit(<span class="string">'created'</span>, room);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numClients === <span class="number">1</span>) &#123;</span><br><span class="line">      io.sockets.in(room).emit(<span class="string">'join'</span>, room);</span><br><span class="line">      socket.join(room);</span><br><span class="line">      socket.emit(<span class="string">'joined'</span>, room);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// max two clients</span></span><br><span class="line">      socket.emit(<span class="string">'full'</span>, room);</span><br><span class="line">    &#125;</span><br><span class="line">    socket.emit(<span class="string">'emit(): client '</span> + socket.id +</span><br><span class="line">      <span class="string">' joined room '</span> + room);</span><br><span class="line">    socket.broadcast.emit(<span class="string">'broadcast(): client '</span> + socket.id +</span><br><span class="line">      <span class="string">' joined room '</span> + room);</span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Readymade-signaling-servers"><a href="#Readymade-signaling-servers" class="headerlink" title="Readymade signaling servers"></a>Readymade signaling servers</h3><p>If you don’t want to roll your own, there are several WebRTC signaling servers available, which use Socket.IO like the previous example and are integrated with WebRTC client JavaScript libraries:</p><ul><li><a href="https://github.com/webRTC/webRTC.io" target="_blank" rel="noopener">webRTC.io</a> is one of the first abstraction libraries for WebRTC.</li><li><a href="https://github.com/andyet/signalmaster" target="_blank" rel="noopener">Signalmaster</a> is a signaling server created for use with the <a href="https://github.com/HenrikJoreteg/SimpleWebRTC" target="_blank" rel="noopener">SimpleWebRTC</a> JavaScript client library.</li></ul><p>If you don’t want to write any code at all, complete commercial WebRTC platforms are available from companies, such as <a href="https://www.vline.com/" target="_blank" rel="noopener">vLine</a>, <a href="https://tokbox.com/opentok" target="_blank" rel="noopener">OpenTok</a>, and <a href="https://wiki.asterisk.org/wiki/display/AST/Asterisk+WebRTC+Support" target="_blank" rel="noopener">Asterisk</a>.</p><p>For the record, Ericsson built a <a href="https://labs.ericsson.com/blog/a-web-rtc-tutorial" target="_blank" rel="noopener">signaling server using PHP on Apache</a> in the early days of WebRTC. This is now somewhat obsolete, but it’s worth looking at the code if you’re considering something similar.</p><p>WebRTC apps can use the <a href="https://en.wikipedia.org/wiki/Interactive_Connectivity_Establishment" target="_blank" rel="noopener">ICE</a> framework to overcome the complexities of real-world networking. To enable this to happen, your app must pass ICE server URLs to <code>RTCPeerConnection</code>, as described in this article.</p><p>ICE tries to find the best path to connect peers. It tries all possibilities in parallel and chooses the most efficient option that works. ICE first tries to make a connection using the host address obtained from a device’s operating system and network card. If that fails (which it will for devices behind NATs), ICE obtains an external address using a STUN server and, if that fails, traffic is routed through a TURN relay server.</p><p>In other words, a STUN server is used to get an external network address and TURN servers are used to relay traffic if direct (peer-to-peer) connection fails.</p><p>Every TURN server supports STUN. A TURN server is a STUN server with additional built-in relaying functionality. ICE also copes with the complexities of NAT setups. In reality, NAT hole-punching may require more than just a public IP:port address.</p><p>URLs for STUN and/or TURN servers are (optionally) specified by a WebRTC app in the <code>iceServers</code> configuration object that is the first argument to the <code>RTCPeerConnection</code> constructor. For <a href="https://appr.tc/" target="_blank" rel="noopener">appr.tc</a>, that value looks like this:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  'iceServers': [</span><br><span class="line">    &#123;</span><br><span class="line">      'urls': 'stun:stun.l.google.com:19302'</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      'urls': 'turn:192.158.29.39:3478?transport=udp',</span><br><span class="line">      'credential': 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',</span><br><span class="line">      'username': '28224511:1379330808'</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      'urls': 'turn:192.158.29.39:3478?transport=tcp',</span><br><span class="line">      'credential': 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',</span><br><span class="line">      'username': '28224511:1379330808'</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="STUN"><a href="#STUN" class="headerlink" title="STUN"></a>STUN</h3><p><a href="https://www.howstuffworks.com/nat.htm" target="_blank" rel="noopener">NATs</a> provide a device with an IP address for use within a private local network, but this address can’t be used externally. Without a public address, there’s no way for WebRTC peers to communicate. To get around this problem, WebRTC uses <a href="https://en.wikipedia.org/wiki/STUN" target="_blank" rel="noopener">STUN</a>.</p><p>STUN servers live on the public internet and have one simple task—check the IP:port address of an incoming request (from an app running behind a NAT) and send that address back as a response. In other words, the app uses a STUN server to discover its IP:port from a public perspective. This process enables a WebRTC peer to get a publicly accessible address for itself and then pass it to another peer through a signaling mechanism in order to set up a direct link. (In practice, different NATs work in different ways and there may be multiple NAT layers, but the principle is still the same.)</p><p>STUN servers don’t have to do much or remember much, so relatively low-spec STUN servers can handle a large number of requests.</p><p>Most WebRTC calls successfully make a connection using STUN—86% according to <a href="https://webrtcstats.com/" target="_blank" rel="noopener">Webrtcstats.com</a>, though this can be less for calls between peers behind firewalls and complex NAT configurations.</p><h3 id="TURN"><a href="#TURN" class="headerlink" title="TURN"></a>TURN</h3><p><code>RTCPeerConnection</code> tries to set up direct communication between peers over UDP. If that fails, <code>RTCPeerConnection</code> resorts to TCP. If that fails, TURN servers can be used as a fallback, relaying data between endpoints.</p><p>Just to reiterate, TURN is used to relay audio, video, and data streaming between peers, not signaling data!</p><p>TURN servers have public addresses, so they can be contacted by peers even if the peers are behind firewalls or proxies. TURN servers have a conceptually simple task—to relay a stream. However, unlike STUN servers, they inherently consume a lot of bandwidth. In other words, TURN servers need to be beefier.</p><h3 id="Deploying-STUN-and-TURN-servers"><a href="#Deploying-STUN-and-TURN-servers" class="headerlink" title="Deploying STUN and TURN servers"></a>Deploying STUN and TURN servers</h3><p>For testing, Google runs a public STUN server, stun.l.google.com:19302, as used by <a href="https://appr.tc/" target="_blank" rel="noopener">appr.tc</a>. For a production STUN/TURN service, use the rfc5766-turn-server. Source code for STUN and TURN servers is available on <a href="https://github.com/coturn/rfc5766-turn-server/" target="_blank" rel="noopener">GitHub</a>, where you can also find links to several sources of information about server installation. A <a href="https://groups.google.com/forum/#!msg/discuss-webrtc/X-OeIUC0efs/XW5Wf7Tt1vMJ" target="_blank" rel="noopener">VM image for Amazon Web Services</a> is also available.</p><p>An alternative TURN server is restund, available as <a href="https://www.creytiv.com/restund.html" target="_blank" rel="noopener">source code</a> and also for AWS. Here are instructions for how to set up restund on Compute Engine.</p><ol><li>Open firewall as necessary for tcp=443, udp/tcp=3478.</li><li>Create four instances, one for each public IP, Standard Ubuntu 12.06 image.</li><li>Set up local firewall config (allow ANY from ANY).</li><li>Install tools:<br><code>sudo apt-get install makesudo apt-get install gcc</code></li><li>Install libre from <a href="https://creytiv.com/re.html" target="_blank" rel="noopener">creytiv.com/re.html</a>.</li><li>Fetch restund from <a href="https://creytiv.com/restund.html" target="_blank" rel="noopener">creytiv.com/restund.html</a> and unpack.</li><li><code>wget</code> <a href="https://hancke.name/restund-auth.patch" target="_blank" rel="noopener">hancke.name/restund-auth.patch</a> and apply with <code>patch -p1 &lt; restund-auth.patch</code>.</li><li>Run <code>make</code>, <code>sudo make install</code> for libre and restund.</li><li>Adapt <code>restund.conf</code> to your needs (replace IP addresses and make sure it contains the same shared secret) and copy to <code>/etc</code>.</li><li>Copy <code>restund/etc/restund</code> to <code>/etc/init.d/</code>.</li><li>Configure restund:<br>a. Set <code>LD_LIBRARY_PATH</code>.<br>b. Copy <code>restund.conf</code> to <code>/etc/restund.conf</code>.<br>c. Set <code>restund.conf</code> to use the right 10. IP address.</li><li>Run restund</li><li>Test using stund client from remote machine: <code>./client IP:port</code></li></ol><h2 id="Find-out-more"><a href="#Find-out-more" class="headerlink" title="Find out more"></a>Find out more</h2><p>The <a href="https://bitbucket.org/webrtc/codelab" target="_blank" rel="noopener">WebRTC codelab</a> provides step-by-step instructions for how to build a video and text chat app using a Socket.io signaling service running on Node.</p><p><a href="https://www.youtube.com/watch?v=p2HzZkd2A40" target="_blank" rel="noopener">Google I/O WebRTC presentation from 2013</a> with WebRTC tech lead, Justin Uberti</p><p>Chris Wilson’s SFHTML5 presentation—<a href="https://www.youtube.com/watch?v=3Ifbqaw5l_I" target="_blank" rel="noopener">Introduction to WebRTC Apps</a></p><p>The 350-page book <a href="https://webrtcbook.com/" target="_blank" rel="noopener">WebRTC: APIs and RTCWEB Protocols of the HTML5 Real-Time Web</a> provides a lot of detail about data and signaling pathways, and includes a number of detailed network topology diagrams.</p><p><a href="https://www.tokbox.com/blog/webrtc-and-signaling-what-two-years-has-taught-us/" target="_blank" rel="noopener">WebRTC and Signaling: What Two Years Has Taught Us</a>—TokBox blog post about why leaving signaling out of the spec was a good idea</p><p><a href="https://www.linkedin.com/in/strongben" target="_blank" rel="noopener">Ben Strong’s</a> <a href="https://thenewcircle.com/s/post/1548/a_practical_guide_to_building_webrtc_apps_ben_strong_video" target="_blank" rel="noopener">A Practical Guide to Building WebRTC Apps</a> provides a lot of information about WebRTC topologies and infrastructure.</p><p>The <a href="https://chimera.labs.oreilly.com/books/1230000000545/ch18.html" target="_blank" rel="noopener">WebRTC chapter</a> in <a href="https://www.igvita.com/" target="_blank" rel="noopener">Ilya Grigorik’s</a> <em>High Performance Browser Networking</em> goes deep into WebRTC architecture, use cases, and performance.</p><h5 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h5><ol><li><a href="https://codelabs.developers.google.com/codelabs/webrtc-web#0" target="_blank" rel="noopener">https://codelabs.developers.google.com/codelabs/webrtc-web#0</a></li><li><a href="https://www.html5rocks.com/en/tutorials/webrtc/infrastructure/" target="_blank" rel="noopener">https://www.html5rocks.com/en/tutorials/webrtc/infrastructure/</a></li></ol></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://molly2molly.github.io/WebRTC/" title="WebRTC" target="_blank" rel="external">https://molly2molly.github.io/WebRTC/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/molly2molly" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/molly2molly" target="_blank"><span class="text-dark">张英姿</span><small class="ml-1x">前端工程师</small></a></h3><div>梦里寻他千百度 蓦然回首 那人却在灯火阑珊处</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom=""><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/ModernWebApp/" title="ModernWebApp"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a></li><li class="next"><a href="/TypeScript/" title="TypeScript"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>Maybe you could buy me a cup of coffee.</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script></body></html>