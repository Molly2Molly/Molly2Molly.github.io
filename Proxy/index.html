<!-- build time:Thu Dec 24 2020 15:32:29 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>Proxy | Hexo</title><meta name="description" content="A property descriptor encodes the attributes of a property as a JavaScript object. Their TypeScript interfaces look as follows.12345678910111213interface DataPropertyDescriptor &amp;#123;  value?: any;  w"><meta property="og:type" content="article"><meta property="og:title" content="Proxy"><meta property="og:url" content="https://molly2molly.github.io/Proxy/index.html"><meta property="og:site_name" content="张英姿的博客"><meta property="og:description" content="A property descriptor encodes the attributes of a property as a JavaScript object. Their TypeScript interfaces look as follows.12345678910111213interface DataPropertyDescriptor &amp;#123;  value?: any;  w"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2020-08-26T05:51:54.559Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Proxy"><meta name="twitter:description" content="A property descriptor encodes the attributes of a property as a JavaScript object. Their TypeScript interfaces look as follows.12345678910111213interface DataPropertyDescriptor &amp;#123;  value?: any;  w"><link rel="canonical" href="https://molly2molly.github.io/Proxy/index.html"><link rel="alternate" href="/atom.xml" title="张英姿的博客" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"></head><body class="main-center theme-green" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/molly2molly" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">张英姿</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">前端工程师</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> 苏州, 中国</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech=""> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">Categories</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">Tags</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">Repository</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">Books</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">Links</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">About</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Board</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">Categories</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/D3-js/">D3.js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tags</h3><div class="widget-body"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP/">TCP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es6-javascript/">es6 javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/">webpack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a><span class="tag-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tag Cloud</h3><div class="widget-body tagcloud"><a href="/tags/React/" style="font-size:13px">React</a> <a href="/tags/TCP/" style="font-size:13px">TCP</a> <a href="/tags/es6-javascript/" style="font-size:13px">es6 javascript</a> <a href="/tags/javascript/" style="font-size:14px">javascript</a> <a href="/tags/markdown/" style="font-size:13px">markdown</a> <a href="/tags/webpack/" style="font-size:13px">webpack</a> <a href="/tags/数据结构/" style="font-size:14px">数据结构</a></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/GridLayout/" class="title">GridLayout</a></p><p class="item-date"><time datetime="2020-12-24T07:13:47.000Z" itemprop="datePublished">2020-12-24</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/Flexbox/" class="title">Flexbox</a></p><p class="item-date"><time datetime="2020-12-24T06:01:50.000Z" itemprop="datePublished">2020-12-24</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/快速排序/" class="title">快速排序</a></p><p class="item-date"><time datetime="2020-12-14T06:10:04.000Z" itemprop="datePublished">2020-12-14</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/快速选择/" class="title">快速选择</a></p><p class="item-date"><time datetime="2020-12-14T06:10:04.000Z" itemprop="datePublished">2020-12-14</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/栈和队列/" class="title">栈和队列</a></p><p class="item-date"><time datetime="2020-12-07T08:13:41.000Z" itemprop="datePublished">2020-12-07</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-ES6/Proxy" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">Proxy</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/Proxy/" class="article-date"><time datetime="2020-08-25T05:34:04.000Z" itemprop="datePublished">2020-08-25</time></a></span> <span class="post-comment"><i class="icon icon-comment"></i> <a href="/Proxy/#comments" class="article-comment-link">Comments</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h5 id="A-property-descriptor-encodes-the-attributes-of-a-property-as-a-JavaScript-object-Their-TypeScript-interfaces-look-as-follows"><a href="#A-property-descriptor-encodes-the-attributes-of-a-property-as-a-JavaScript-object-Their-TypeScript-interfaces-look-as-follows" class="headerlink" title="A property descriptor encodes the attributes of a property as a JavaScript object. Their TypeScript interfaces look as follows."></a>A property descriptor encodes the attributes of a property as a JavaScript object. Their TypeScript interfaces look as follows.</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">interface DataPropertyDescriptor &#123;</span><br><span class="line">  value?: any;</span><br><span class="line">  writable?: boolean;</span><br><span class="line">  configurable?: boolean;</span><br><span class="line">  enumerable?: boolean;</span><br><span class="line">&#125;</span><br><span class="line">interface AccessorPropertyDescriptor &#123;</span><br><span class="line">  get?: (this: any) =&gt; any;</span><br><span class="line">  set?: (this: any, v: any) =&gt; void;</span><br><span class="line">  configurable?: boolean;</span><br><span class="line">  enumerable?: boolean;</span><br><span class="line">&#125;</span><br><span class="line">type PropertyDescriptor = DataPropertyDescriptor | AccessorPropertyDescriptor;</span><br></pre></td></tr></table></figure><h5 id="Proxy-支持的拦截操作-13-种"><a href="#Proxy-支持的拦截操作-13-种" class="headerlink" title="Proxy 支持的拦截操作 13 种"></a>Proxy 支持的拦截操作 13 种</h5><ul><li>get(target, propKey, receiver)：拦截对象属性的读取，比如proxy.foo和proxy[‘foo’]。</li><li>set(target, propKey, value, receiver)：拦截对象属性的设置，比如proxy.foo = v或proxy[‘foo’] = v，返回一个布尔值。</li><li>has(target, propKey)：拦截propKey in proxy的操作，返回一个布尔值。</li><li>deleteProperty(target, propKey)：拦截delete proxy[propKey]的操作，返回一个布尔值。</li><li>ownKeys(target)：拦截Object.getOwnPropertyNames(proxy)、Object.getOwnPropertySymbols(proxy)、Object.keys(proxy)、for…in循环，返回一个数组。该方法返回目标对象所有自身的属性的属性名，而Object.keys()的返回结果仅包括目标对象自身的可遍历属性。</li><li>getOwnPropertyDescriptor(target, propKey)：拦截Object.getOwnPropertyDescriptor(proxy, propKey)，返回属性的描述对象。</li><li>defineProperty(target, propKey, propDesc)：拦截Object.defineProperty(proxy, propKey, propDesc）、Object.defineProperties(proxy, propDescs)，返回一个布尔值。</li><li>preventExtensions(target)：拦截Object.preventExtensions(proxy)，返回一个布尔值。</li><li>getPrototypeOf(target)：拦截Object.getPrototypeOf(proxy)，返回一个对象。</li><li>isExtensible(target)：拦截Object.isExtensible(proxy)，返回一个布尔值。</li><li>setPrototypeOf(target, proto)：拦截Object.setPrototypeOf(proxy, proto)，返回一个布尔值。如果目标对象是函数，那么还有两种额外操作可以拦截。</li><li>apply(target, object, args)：拦截 Proxy 实例作为函数调用的操作，比如proxy(…args)、proxy.call(object, …args)、proxy.apply(…)。</li><li>construct(target, args)：拦截 Proxy 实例作为构造函数调用的操作，比如new proxy(…args)。</li></ul><h5 id="Function-specific-traps"><a href="#Function-specific-traps" class="headerlink" title="Function-specific traps"></a>Function-specific traps</h5><p>If the target is a function, two additional operations can be intercepted:</p><ul><li><p><code>apply</code>: Making a function call. Triggered via:</p><ul><li>proxy(···)</li><li>proxy.call(···)</li><li>proxy.apply(···)</li></ul></li><li><p><code>construct</code>: Making a constructor call. Triggered via:</p><ul><li>new proxy(···)</li></ul></li></ul><h5 id="Intercepting-method-calls"><a href="#Intercepting-method-calls" class="headerlink" title="Intercepting method calls"></a>Intercepting method calls</h5><p>If we want to intercept method calls via a Proxy, we are facing a challenge: There is no trap for method calls. Instead, a method call is viewed as a sequence of two operations:</p><ul><li>A <code>get</code> to retrieve a function</li><li>An <code>apply</code> to call that function</li></ul><p>Therefore, if we want to intercept method calls, we need to intercept two operations:</p><ul><li>First, we intercept the get and return a function.</li><li>Second, we intercept the invocation of that function.</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const traced = [];</span><br><span class="line"></span><br><span class="line">function traceMethodCalls(obj) &#123;</span><br><span class="line">  const handler = &#123;</span><br><span class="line">    get(target, propKey, receiver) &#123;</span><br><span class="line">      const origMethod = target[propKey];</span><br><span class="line">      // 这里 this 指向 proxy</span><br><span class="line">      return function (...args) &#123; // implicit parameter `this`!</span><br><span class="line">      	 // 这里 this 指向 target</span><br><span class="line">        const result = origMethod.apply(this, args);</span><br><span class="line">        traced.push(propKey + JSON.stringify(args)</span><br><span class="line">          + &apos; -&gt; &apos; + JSON.stringify(result));</span><br><span class="line">        return result;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  return new Proxy(obj, handler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const obj = &#123;</span><br><span class="line">  multiply(x, y) &#123;</span><br><span class="line">    return x * y;</span><br><span class="line">  &#125;,</span><br><span class="line">  squared(x) &#123;</span><br><span class="line">    return this.multiply(x, x);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">const tracedObj = traceMethodCalls(obj);</span><br><span class="line">console.log(tracedObj.squared(9)); // 81</span><br><span class="line">console.log(traced); // [ &apos;multiply[9,9] -&gt; 81&apos;, &apos;squared[9] -&gt; 81&apos; ]</span><br></pre></td></tr></table></figure><h5 id="Revocable-Proxies-可废除的代理"><a href="#Revocable-Proxies-可废除的代理" class="headerlink" title="Revocable Proxies 可废除的代理"></a>Revocable Proxies 可废除的代理</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const target = &#123;&#125;; // Start with an empty object</span><br><span class="line">const handler = &#123;&#125;; // Don’t intercept anything</span><br><span class="line">const &#123;proxy, revoke&#125; = Proxy.revocable(target, handler);</span><br><span class="line"></span><br><span class="line">// `proxy` works as if it were the object `target`:</span><br><span class="line">proxy.city = &apos;Paris&apos;;</span><br><span class="line">console.log(proxy.city); // Paris</span><br><span class="line"></span><br><span class="line">revoke();</span><br><span class="line"></span><br><span class="line">console.log(proxy.prop); // TypeError: Cannot perform &apos;get&apos; on a proxy that has been revoked</span><br></pre></td></tr></table></figure><h5 id="Proxies-as-prototypes"><a href="#Proxies-as-prototypes" class="headerlink" title="Proxies as prototypes"></a>Proxies as prototypes</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const proto = new Proxy(&#123;&#125;, &#123;</span><br><span class="line">  get(target, propertyKey, receiver) &#123;</span><br><span class="line">    console.log(&apos;GET &apos;+propertyKey);</span><br><span class="line">    return target[propertyKey];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const obj = Object.create(proto);</span><br><span class="line">obj.weight;</span><br><span class="line"></span><br><span class="line">// Output:</span><br><span class="line">// &apos;GET weight&apos;</span><br></pre></td></tr></table></figure><h5 id="Forwarding-intercepted-operations"><a href="#Forwarding-intercepted-operations" class="headerlink" title="Forwarding intercepted operations"></a>Forwarding intercepted operations</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const handler = &#123;</span><br><span class="line">  deleteProperty(target, propKey) &#123;</span><br><span class="line">    console.log(&apos;DELETE &apos; + propKey);</span><br><span class="line">    return delete target[propKey];</span><br><span class="line">  &#125;,</span><br><span class="line">  has(target, propKey) &#123;</span><br><span class="line">    console.log(&apos;HAS &apos; + propKey);</span><br><span class="line">    return propKey in target;</span><br><span class="line">  &#125;,</span><br><span class="line">  // Other traps: similar</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const handler = &#123;</span><br><span class="line">  deleteProperty(target, propKey) &#123;</span><br><span class="line">    console.log(&apos;DELETE &apos; + propKey);</span><br><span class="line">    return Reflect.deleteProperty(target, propKey);</span><br><span class="line">  &#125;,</span><br><span class="line">  has(target, propKey) &#123;</span><br><span class="line">    console.log(&apos;HAS &apos; + propKey);</span><br><span class="line">    return Reflect.has(target, propKey);</span><br><span class="line">  &#125;,</span><br><span class="line">  // Other traps: similar</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const handler = new Proxy(&#123;&#125;, &#123;</span><br><span class="line">  get(target, trapName, receiver) &#123;</span><br><span class="line">    // Return the handler method named trapName</span><br><span class="line">    return (...args) =&gt; &#123;</span><br><span class="line">      console.log(trapName.toUpperCase() + &apos; &apos; + args);</span><br><span class="line">      // Forward the operation</span><br><span class="line">      return Reflect[trapName](...args);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="proxy-affects-this"><a href="#proxy-affects-this" class="headerlink" title="proxy affects this"></a>proxy affects this</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const target = &#123;</span><br><span class="line">  myMethod() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      thisIsTarget: this === target,</span><br><span class="line">      thisIsProxy: this === proxy,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">const handler = &#123;&#125;;</span><br><span class="line">const proxy = new Proxy(target, handler);</span><br><span class="line"></span><br><span class="line">console.log(target.myMethod()); // &#123; thisIsTarget: true, thisIsProxy: false &#125;</span><br><span class="line">console.log(proxy.myMethod());  // &#123; thisIsTarget: false, thisIsProxy: true &#125;</span><br></pre></td></tr></table></figure><h5 id="Objects-that-can’t-be-wrapped-transparently"><a href="#Objects-that-can’t-be-wrapped-transparently" class="headerlink" title="Objects that can’t be wrapped transparently"></a>Objects that can’t be wrapped transparently</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const _name = new WeakMap();</span><br><span class="line">class Person &#123;</span><br><span class="line">  constructor(name) &#123;</span><br><span class="line">    _name.set(this, name);</span><br><span class="line">  &#125;</span><br><span class="line">  get name() &#123;</span><br><span class="line">    return _name.get(this);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const jane = new Person(&apos;Jane&apos;);</span><br><span class="line">console.log(jane.name); // Jane</span><br><span class="line"></span><br><span class="line">const proxy = new Proxy(jane, &#123;&#125;);</span><br><span class="line">console.log(proxy.name); // undefined</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class Person2 &#123;</span><br><span class="line">  constructor(name) &#123;</span><br><span class="line">    this._name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  get name() &#123;</span><br><span class="line">    return this._name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const jane2 = new Person2(&apos;Jane&apos;);</span><br><span class="line">console.log(jane2.name); // Jane</span><br><span class="line"></span><br><span class="line">const proxy2 = new Proxy(jane2, &#123;&#125;);</span><br><span class="line">console.log(proxy2.name); // Jane</span><br></pre></td></tr></table></figure><h5 id="Wrapping-instances-of-built-in-constructors"><a href="#Wrapping-instances-of-built-in-constructors" class="headerlink" title="Wrapping instances of built-in constructors"></a>Wrapping instances of built-in constructors</h5><p>Instances of most built-in constructors also use a mechanism that is not intercepted by Proxies. They therefore can’t be wrapped transparently</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const target = new Date();</span><br><span class="line">const handler = &#123;&#125;;</span><br><span class="line">const proxy = new Proxy(target, handler);</span><br><span class="line"></span><br><span class="line">console.log(proxy.getFullYear()); // TypeError: this is not a Date object.</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const handler = &#123;</span><br><span class="line">  get(target, propKey, receiver) &#123;</span><br><span class="line">    if (propKey === &apos;getFullYear&apos;) &#123;</span><br><span class="line">      return target.getFullYear.bind(target);</span><br><span class="line">    &#125;</span><br><span class="line">    return Reflect.get(target, propKey, receiver);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">const proxy = new Proxy(new Date(&apos;2030-12-24&apos;), handler);</span><br><span class="line">console.log(proxy.getFullYear()); // 2030</span><br></pre></td></tr></table></figure><h5 id="Arrays-can-be-wrapped-transparently"><a href="#Arrays-can-be-wrapped-transparently" class="headerlink" title="Arrays can be wrapped transparently"></a>Arrays can be wrapped transparently</h5><h3 id="Use-cases-for-Proxies"><a href="#Use-cases-for-Proxies" class="headerlink" title="Use cases for Proxies"></a>Use cases for Proxies</h3><h4 id="Tracing-property-accesses-get-set"><a href="#Tracing-property-accesses-get-set" class="headerlink" title="Tracing property accesses (get, set)"></a>Tracing property accesses (get, set)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">class Point &#123;</span><br><span class="line">  constructor(x, y) &#123;</span><br><span class="line">    this.x = x;</span><br><span class="line">    this.y = y;</span><br><span class="line">  &#125;</span><br><span class="line">  toString() &#123;</span><br><span class="line">    return `Point($&#123;this.x&#125;, $&#123;this.y&#125;)`;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function tracePropertyAccesses(target, propKeys) &#123;</span><br><span class="line">  return new Proxy(target, &#123;</span><br><span class="line">    get(target, propName, receiver) &#123;</span><br><span class="line">      if(propKeys.find(e =&gt; e === propName)) &#123;</span><br><span class="line">        console.log(&quot;GET &quot;+propName);</span><br><span class="line">      &#125;</span><br><span class="line">      Reflect.get(target, propName, receiver);</span><br><span class="line">    &#125;,</span><br><span class="line">    set(target, propName, propValue, receiver) &#123;</span><br><span class="line">      if(propKeys.find(e =&gt; e === propName)) &#123;</span><br><span class="line">        console.log(&quot;SET &quot;+propName+&quot;=&quot;+propValue);</span><br><span class="line">      &#125;</span><br><span class="line">      Reflect.set(target, propName, receiver);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Trace accesses to properties `x` and `y`</span><br><span class="line">const point = new Point(5, 7);</span><br><span class="line">const tracedPoint = tracePropertyAccesses(point, [&apos;x&apos;, &apos;y&apos;]);</span><br><span class="line"></span><br><span class="line">console.log(tracedPoint.x)</span><br><span class="line">tracedPoint.y = 10;</span><br><span class="line">tracedPoint.z = 15;</span><br><span class="line">tracedPoint.x = 8;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">&apos;GET x&apos;</span><br><span class="line">&apos;SET y=10&apos;</span><br><span class="line">&apos;SET x=8&apos;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const propertyCheckerHandler = &#123;</span><br><span class="line">  get(target, propKey, receiver) &#123;</span><br><span class="line">    // Only check string property keys</span><br><span class="line">    if (typeof propKey === &apos;string&apos; &amp;&amp; !(propKey in target)) &#123;</span><br><span class="line">      throw new ReferenceError(&apos;Unknown property: &apos; + propKey);</span><br><span class="line">    &#125;</span><br><span class="line">    return Reflect.get(target, propKey, receiver);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">const PropertyChecker = new Proxy(&#123;&#125;, propertyCheckerHandler);</span><br><span class="line"></span><br><span class="line">let jane = Object.create(PropertyChecker);</span><br><span class="line">jane.name = &quot;Jane&quot;;</span><br><span class="line"></span><br><span class="line">console.log(jane.name); // Jane</span><br><span class="line">console.log(jane.nmea); // ReferenceError: Unknown property: nmea</span><br><span class="line">console.log(jane.toString()); // [object Object]</span><br></pre></td></tr></table></figure><h4 id="Negative-Array-indices-get"><a href="#Negative-Array-indices-get" class="headerlink" title="Negative Array indices (get)"></a>Negative Array indices (get)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function createArray(...elements) &#123;</span><br><span class="line">  const handler = &#123;</span><br><span class="line">    get(target, propKey, receiver) &#123;</span><br><span class="line">      if (typeof propKey === &apos;string&apos;) &#123;</span><br><span class="line">        const index = Number(propKey);</span><br><span class="line">        if (index &lt; 0) &#123;</span><br><span class="line">          propKey = String(target.length + index);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      return Reflect.get(target, propKey, receiver);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  // Wrap a proxy around the Array</span><br><span class="line">  return new Proxy(elements, handler);</span><br><span class="line">&#125;</span><br><span class="line">const arr = createArray(&apos;a&apos;, &apos;b&apos;, &apos;c&apos;);</span><br><span class="line">console.log(arr[-1]); // c</span><br><span class="line">console.log(arr[0]); // a</span><br><span class="line">console.log(arr.length); // 3</span><br></pre></td></tr></table></figure><h4 id="Data-binding-set"><a href="#Data-binding-set" class="headerlink" title="Data binding (set)"></a>Data binding (set)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function createObservedArray(callback) &#123;</span><br><span class="line">  const array = [];</span><br><span class="line">  return new Proxy(array, &#123;</span><br><span class="line">    set(target, propertyKey, value, receiver) &#123;</span><br><span class="line">      callback(propertyKey, value);</span><br><span class="line">      return Reflect.set(target, propertyKey, value, receiver);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">const observedArray = createObservedArray(</span><br><span class="line">  (key, value) =&gt; console.log(</span><br><span class="line">    `$&#123;JSON.stringify(key)&#125; = $&#123;JSON.stringify(value)&#125;`));</span><br><span class="line">observedArray.push(&apos;a&apos;);</span><br><span class="line"></span><br><span class="line">// Output:</span><br><span class="line">// &apos;&quot;0&quot; = &quot;a&quot;&apos;</span><br><span class="line">// &apos;&quot;length&quot; = 1&apos;</span><br></pre></td></tr></table></figure><h4 id="Accessing-a-restful-web-service-method-calls"><a href="#Accessing-a-restful-web-service-method-calls" class="headerlink" title="Accessing a restful web service (method calls)"></a>Accessing a restful web service (method calls)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">function createWebService(baseUrl) &#123;</span><br><span class="line">  return new Proxy(&#123;&#125;, &#123;</span><br><span class="line">    get(target, propKey, receiver) &#123;</span><br><span class="line">      // Return the method to be called</span><br><span class="line">      return () =&gt; httpGet(baseUrl + &apos;/&apos; + propKey);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function httpGet(url) &#123;</span><br><span class="line">  return new Promise(</span><br><span class="line">    (resolve, reject) =&gt; &#123;</span><br><span class="line">      const xhr = new XMLHttpRequest();</span><br><span class="line">      xhr.onload = () =&gt; &#123;</span><br><span class="line">        if (xhr.status === 200) &#123;</span><br><span class="line">          resolve(xhr.responseText); // (A)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          // Something went wrong (404, etc.)</span><br><span class="line">          reject(new Error(xhr.statusText)); // (B)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      xhr.onerror = () =&gt; &#123;</span><br><span class="line">        reject(new Error(&apos;Network error&apos;)); // (C)</span><br><span class="line">      &#125;;</span><br><span class="line">      xhr.open(&apos;GET&apos;, url);</span><br><span class="line">      xhr.send();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const service = createWebService(&apos;http://example.com/data&apos;);</span><br><span class="line">// Read JSON data in http://example.com/data/employees</span><br><span class="line">service.employees().then((jsonStr) =&gt; &#123;</span><br><span class="line">  const employees = JSON.parse(jsonStr);</span><br><span class="line">  // ···</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="Revocable-references"><a href="#Revocable-references" class="headerlink" title="Revocable references"></a>Revocable references</h4><p>Revocable references work as follows: A client is not allowed to access an important resource (an object) directly, only via a reference (an intermediate object, a wrapper around the resource). Normally, every operation applied to the reference is forwarded to the resource. After the client is done, the resource is protected by revoking the reference, by switching it off. Henceforth, applying operations to the reference throws exceptions and nothing is forwarded, anymore.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">function createRevocableReference(target) &#123;</span><br><span class="line">  let enabled = true;</span><br><span class="line">  return &#123;</span><br><span class="line">    reference: new Proxy(target, &#123;</span><br><span class="line">      get(target, propKey, receiver) &#123;</span><br><span class="line">        if (!enabled) &#123;</span><br><span class="line">          throw new TypeError(</span><br><span class="line">            `Cannot perform &apos;get&apos; on a proxy that has been revoked`);</span><br><span class="line">        &#125;</span><br><span class="line">        return Reflect.get(target, propKey, receiver);</span><br><span class="line">      &#125;,</span><br><span class="line">      has(target, propKey) &#123;</span><br><span class="line">        if (!enabled) &#123;</span><br><span class="line">          throw new TypeError(</span><br><span class="line">            `Cannot perform &apos;has&apos; on a proxy that has been revoked`);</span><br><span class="line">        &#125;</span><br><span class="line">        return Reflect.has(target, propKey);</span><br><span class="line">      &#125;,</span><br><span class="line">      // (Remaining methods omitted)</span><br><span class="line">    &#125;),</span><br><span class="line">    revoke: () =&gt; &#123;</span><br><span class="line">      enabled = false;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function createRevocableReference(target) &#123;</span><br><span class="line">  let enabled = true;</span><br><span class="line">  const handler = new Proxy(&#123;&#125;, &#123;</span><br><span class="line">    get(_handlerTarget, trapName, receiver) &#123;</span><br><span class="line">      if (!enabled) &#123;</span><br><span class="line">        throw new TypeError(</span><br><span class="line">          `Cannot perform &apos;$&#123;trapName&#125;&apos; on a proxy`</span><br><span class="line">          + ` that has been revoked`);</span><br><span class="line">      &#125;</span><br><span class="line">      return Reflect[trapName];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  return &#123;</span><br><span class="line">    reference: new Proxy(target, handler),</span><br><span class="line">    revoke: () =&gt; &#123;</span><br><span class="line">      enabled = false;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function createRevocableReference(target) &#123;</span><br><span class="line">  const handler = &#123;&#125;; // forward everything</span><br><span class="line">  const &#123; proxy, revoke &#125; = Proxy.revocable(target, handler);</span><br><span class="line">  return &#123; reference: proxy, revoke &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Membranes"><a href="#Membranes" class="headerlink" title="Membranes"></a>Membranes</h4><p>Membranes build on the idea of revocable references: Libraries for safely running untrusted code wrap a membrane around that code to isolate it and to keep the rest of the system safe. Objects pass the membrane in two directions:</p><ul><li>The untrusted code may receive objects (“dry objects”) from the outside.</li><li>Or it may hand objects (“wet objects”) to the outside.</li></ul><p>In both cases, revocable references are wrapped around the objects. Objects returned by wrapped functions or methods are also wrapped. Additionally, if a wrapped wet object is passed back into a membrane, it is unwrapped.</p><p>Once the untrusted code is done, all of the revocable references are revoked. As a result, none of its code on the outside can be executed anymore and outside objects that it references, cease to work as well. The Caja Compiler is “a tool for making third party HTML, CSS and JavaScript safe to embed in your website”. It uses membranes to achieve this goal.</p><h3 id="Proxies-are-stratified-Base-level-the-Proxy-object-and-meta-level-the-handler-object-are-separate"><a href="#Proxies-are-stratified-Base-level-the-Proxy-object-and-meta-level-the-handler-object-are-separate" class="headerlink" title="Proxies are stratified: Base level (the Proxy object) and meta level (the handler object) are separate"></a>Proxies are stratified: Base level (the Proxy object) and meta level (the handler object) are separate</h3><h4 id="Proxies-are-used-in-two-roles"><a href="#Proxies-are-used-in-two-roles" class="headerlink" title="Proxies are used in two roles:"></a>Proxies are used in two roles:</h4><ul><li><p>As wrappers, they wrap their targets, they control access to them. Examples of wrappers are: revocable resources and tracing via Proxies.</p></li><li><p>As virtual objects, they are simply objects with special behavior and their targets don’t matter. An example is a Proxy that forwards method calls to a remote object.</p></li></ul><h4 id="Proxies-are-shielded-in-two-ways"><a href="#Proxies-are-shielded-in-two-ways" class="headerlink" title="Proxies are shielded in two ways:"></a>Proxies are shielded in two ways:</h4><ul><li>It is impossible to determine whether an object is a Proxy or not (transparent virtualization).</li><li>We can’t access a handler via its Proxy (handler encapsulation).</li></ul><h5 id="tell-Proxies-apart-from-non-Proxies"><a href="#tell-Proxies-apart-from-non-Proxies" class="headerlink" title="tell Proxies apart from non-Proxies"></a>tell Proxies apart from non-Proxies</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const proxies = new WeakSet();</span><br><span class="line"></span><br><span class="line">function createProxy(obj) &#123;</span><br><span class="line">  const handler = &#123;&#125;;</span><br><span class="line">  const proxy = new Proxy(obj, handler);</span><br><span class="line">  proxies.add(proxy);</span><br><span class="line">  return proxy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function isProxy(obj) &#123;</span><br><span class="line">  return proxies.has(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h5><ol><li><a href="https://exploringjs.com/deep-js/ch_proxies.html" target="_blank" rel="noopener">https://exploringjs.com/deep-js/ch_proxies.html</a></li></ol></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://molly2molly.github.io/Proxy/" title="Proxy" target="_blank" rel="external">https://molly2molly.github.io/Proxy/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/molly2molly" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/molly2molly" target="_blank"><span class="text-dark">张英姿</span><small class="ml-1x">前端工程师</small></a></h3><div>梦里寻他千百度 蓦然回首 那人却在灯火阑珊处</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom=""><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/PureFunction/" title="PureFunction"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a></li><li class="next"><a href="/单向用户接口结构-UNIDIRECTIONAL-USER-INTERFACE-ARCHITECHURES/" title="单向用户接口结构_UNIDIRECTIONAL_USER_INTERFACE_ARCHITECHURES"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>Maybe you could buy me a cup of coffee.</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="Scan Qrcode" title="Scan"></div><p class="text-muted mv">Scan this qrcode</p><p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/molly2molly" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>!function(T){var n={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"};T.INSIGHT_CONFIG=n}(window)</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta="nick,mail,link";meta=meta.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script></body></html><!-- rebuild by neat -->